(this["webpackJsonppuro-onto"]=this["webpackJsonppuro-onto"]||[]).push([[0],{380:function(e,t,n){e.exports=n(868)},387:function(e,t,n){},392:function(e,t){},394:function(e,t){},427:function(e,t){},428:function(e,t){},658:function(e,t,n){var r={"./locale":304,"./locale.js":304};function o(e){var t=l(e);return n(t)}function l(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=l,e.exports=o,o.id=658},676:function(e,t){},682:function(e,t){},695:function(e,t){},696:function(e,t){},709:function(e,t){},711:function(e,t){},753:function(e,t){},755:function(e,t){},794:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=794},822:function(e,t,n){var r={"./N3Lexer":196,"./N3Lexer.js":196,"./N3Parser":197,"./N3Parser.js":197,"./N3Store":359,"./N3Store.js":359,"./N3StreamParser":360,"./N3StreamParser.js":360,"./N3StreamWriter":361,"./N3StreamWriter.js":361,"./N3Util":198,"./N3Util.js":198,"./N3Writer":199,"./N3Writer.js":199};function o(e){var t=l(e);return n(t)}function l(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=l,e.exports=o,o.id=822},825:function(e,t){},868:function(e,t,n){"use strict";n.r(t);var r=n(378),o=n(0),l=n(1),i=n(5),a=n(6),s=n(7),u=n(2),h=n.n(u),c=n(373),d=n.n(c),y=(n(385),n(386),n(387),n(61)),f=n.n(y),p=n(374),v=n.n(p),m=n(203),g=n.n(m),T=n(17),b=n.n(T),O=n(88),E=function(){function e(){var t;Object(o.a)(this,e),f.a.ajax({type:"GET",url:"rules.json",async:!1,cache:!1,dataType:"json",success:function(e){t=e}}),this.rulesJson=JSON.parse(JSON.stringify(t)),this.ontoUri="http://lod2-dev.vse.cz/data/ontomodels#";var n=new URL(window.location.href);this.modelId=n.searchParams.get("model")}return Object(l.a)(e,[{key:"createButtons",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=(e=Array.isArray(e)?e:[e]).map((function(e){return{name:e}}));return Promise.resolve({buttons:l,title:t,type:n,elName:r,originalName:o})}},{key:"getQuestion",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var l,i=this.rulesJson.questions[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if(a.type===t){var s="string"===typeof e?e:e.label;return a.question.replace("VAL",s)}}}catch(u){r=!0,o=u}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}}},{key:"createQuestion",value:function(e,t){var n="";if("question"in e.rule){var r=!0,o=!1,l=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;if(s.type===e.rule.question){n=s.question;break}}}catch(c){o=!0,l=c}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}console.log(e),n=""===n?e.rule.question:n;var u=e.key in e.rule?e.rule[e.key][0]:e.rule.type[0];return n.replace("VAL",e.elLabel).replace("TYPE",u)}var h=this.isSameCaseInsensitive(e.key,"connect")?" to ":" of ";return"What is "+e.key+h+e.elLabel+"?"}},{key:"countBTypesInTree",value:function(e){var t=0,n=!0,r=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;"BType"!==this.delUri(a.type.value)||a.fatherTypeRelation.includes("http://lod2-dev.vse.cz/ontology/puro#instanceOf")||t++}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return t}},{key:"delUri",value:function(e){var t=[];if("string"===typeof e)return e.split("#")[1];if(Array.isArray(e)){var n=!0,r=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;t.push(a.split("#")[1])}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return t}return""}},{key:"getKeyByValue",value:function(e,t){return Object.keys(e).find((function(n){return e[n]===t}))}},{key:"isSameCaseInsensitive",value:function(e,t){return 0===e.localeCompare(t,void 0,{sensitivity:"base"})}},{key:"getOpositeDirection",value:function(e){return"from"===e?"to":"from"}}]),e}(),R=function(e){function t(){var e,r;Object(o.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).call(this))).rdf=n(867);var l=e.rulesJson.modelURL.replace("MODELID",e.modelId);return f.a.ajax({type:"GET",url:l,crossDomain:!0,async:!1,cache:!1,dataType:"xml",success:function(e){this.puroXML=e,console.log(this.puroXML),r=e},error:function(e,t,n){alert("There is the problem to load serialized PURO model! \n"+n),window.location.replace(document.referrer)}}),e.puroXML=r,e}return Object(s.a)(t,e),Object(l.a)(t,[{key:"getRelatorBtype",value:function(e,t){var n=this,r="\n            PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n            SELECT ?element ?valuation ?elementLabel ?type ?father ?fatherLabel ?elementType ?fatherType WHERE \n            {\n                {<"+e+"> puro:linkedTo ?element . <"+t+"> puro:linkedTo <"+e+">} \n                UNION\n                {?element puro:linkedTo <"+e+"> . <"+e+"> puro:linkedTo <"+t+">}    \n                {?element a puro:BObject}\n                UNION\n                {?element a puro:BType}\n                ?element rdfs:label ?elementLabel .\n                ?element a ?elementType .  \n                OPTIONAL {?element puro:instanceOf ?father}\n                OPTIONAL {?father rdfs:label ?fatherLabel}\n                OPTIONAL {?father a ?fatherType}\n                OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n               \n               \n            }";return new Promise((function(t){n.sparqlQuery(r,(function(n){(n=this.deleteDuplicity(n,["valuation"])).relationName=e,t(n)}))}))}},{key:"findBTypeRelation",value:function(e,t,n){var r=e.uri.value,o="\n             PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n             PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n             SELECT ?uri ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \n             {\n                 {<"+r+"> puro:instanceOf ?uri }\n                 UNION\n                 {<"+r+"> puro:subTypeOf  ?uri }\n                 ?uri a ?type . \n                 ?uri rdfs:label ?label . \n                \n             }";this.sparqlQuery(o,function(e){if(!((e=this.deleteDuplicity(e,["connect","connectFrom","father","fatherType","fatherTypeRelation","child","childType","childRel"])).length>0))return n(t),t;for(var r in e)t.push(e[r]),this.findBTypeRelation(e[r],t,n)}.bind(this))}},{key:"findBTypeChild",value:function(e,t,n){var r=this,o=e.uri.value,l="\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT ?uri ?valuation ?valuationLabel ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \n                 {\n                     {?uri puro:instanceOf <"+o+">}\n                     UNION\n                     {?uri puro:subTypeOf <"+o+">}\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri}}\n                     OPTIONAL {?child a ?childType}\n                     OPTIONAL {{?child ?childRel ?uri} UNION {?child ?childRel ?uri}}\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n                     ?uri ?fatherTypeRelation <"+o+"> .\n                     ?uri rdfs:label ?label .\n                     ?uri a ?type . \n                     <"+o+"> a ?fatherType\n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\n                     OPTIONAL {?connectFrom puro:linkedTo ?uri. ?connectFrom a puro:BRelaion}\n                     BIND ( <"+o+">  AS ?father)\n                 }";this.sparqlQuery(l,(function(e){if(!((e=r.deleteDuplicity(e,["connect","connectFrom","father","fatherType","fatherTypeRelation","child","childType","childRel","valuation"])).length>0))return n(t),t;for(var o in e)t.push(e[o]),r.findBTypeChild(e[o],t,n)}))}},{key:"getFullPath",value:function(){var e=this;return new Promise((function(t){e.sparqlQuery("\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT ?uri ?valuation ?label ?type ?connect ?child ?fatherType ?father ?fatherTypeRelation ?childType ?childRel WHERE \n                 {\n                     ?uri rdfs:label ?label .\n                     ?uri a puro:BType . \n                     ?uri a ?type\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri} ?child a ?childType . ?child ?childRel ?uri . } \n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n                     FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                     FILTER NOT EXISTS {?uri puro:instanceOf ?object}\n                 }",function(e){e.forEach((function(e){e.father=[],e.fatherType=[],e.fatherTypeRelation=[],e.connectFrom=[]})),this.deleteDuplicity(e,["valuation","connect","childType","child","childRel"]),this.recursiveFindChild(0,e,[],(function(e){t(e)}))}.bind(e))}))}},{key:"recursiveFindChild",value:function(e,t,n,r,o){var l=this;if(e>=t.length)return r(n),n;n.push(t[e]),"relation"===o?this.findBTypeRelation(t[e],n,(function(o){e++,l.recursiveFindChild(e++,t,n,r,"relation")})):this.findBTypeChild(t[e],n,(function(i){e++,l.recursiveFindChild(e++,t,n,r,o)}))}},{key:"sparqlQuery",value:function(e,t){var r,o=(new XMLSerializer).serializeToString(this.puroXML),l=this.rdf.graph();this.rdf.parse(o,l,"http://lod2-dev.vse.cz/","application/rdf+xml"),this.rdf.serialize(void 0,l,"http://www.w3sds.org/1999/02/22-rdf-syntax-ns#type","text/turtle",(function(e,t){r=t})),n(814).create((function(n,o){o.load("text/turtle",r,(function(n,r){o.execute(e,(function(e,n){t(n)}))}))}))}},{key:"getRelationBTypes",value:function(e){var t=this,n="\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT  ?uri ?type ?label  WHERE \n                 {\n                     {<"+e+"> puro:instanceOf ?uri}\n                     UNION\n                     {<"+e+"> puro:subTypeOf ?uri}\n                     ?uri a ?type .\n                     ?uri rdfs:label ?label\n                 }";return new Promise((function(e){t.sparqlQuery(n,(function(n){t.recursiveFindChild(0,n,[],(function(t){e(t)}),"relation")}))}))}},{key:"getRelations",value:function(){var e=this;return new Promise((function(t){e.sparqlQuery("\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?valuation ?from ?to ?toType ?fromType ?label ?type  WHERE \n                {\n                  ?uri a puro:BRelation . \n                  ?from puro:linkedTo ?uri .\n                  ?uri puro:linkedTo ?to .\n                  ?uri rdfs:label ?label . \n                  ?uri a ?type .\n                  OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n                  {?from a puro:BObject}\n                  UNION \n                  {?from a puro:BType}\n                  {?to a puro:BObject}\n                  UNION\n                  {?to a puro:BType} \n                  ?to a ?toType . \n                  ?from a ?fromType . \n                }",function(e){e=this.deleteDuplicity(e,["from","to","toType","fromType","valuation"]),console.log(e),t(e)}.bind(e))}))}},{key:"findRelation",value:function(e){var t=this,n="\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label  WHERE \n                {\n                  <"+e+"> puro:linkedTo ?uri . \n                }";return new Promise((function(e){t.sparqlQuery(n,(function(t){e(t)}))}))}},{key:"firstFind",value:function(){var e=Object(O.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label ?child WHERE \n                {\n                    {?child puro:instanceOf ?uri}\n                     UNION\n                    {?child puro:subTypeOf ?uri}\n                    ?uri rdfs:label ?label. asfadf\n                    ?uri a puro:BType\n                    FILTER NOT EXISTS {?uri puro:linkedTo ?obj}\n                    FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                }",e.abrupt("return",new Promise((function(e){t.sparqlQuery("\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label ?child WHERE \n                {\n                    {?child puro:instanceOf ?uri}\n                     UNION\n                    {?child puro:subTypeOf ?uri}\n                    ?uri rdfs:label ?label. asfadf\n                    ?uri a puro:BType\n                    FILTER NOT EXISTS {?uri puro:linkedTo ?obj}\n                    FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                }",(function(t){e(t)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDuplicity",value:function(e,t){var n,r=[],o=!0,l=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value,h=!0,c=!1,d=void 0;try{for(var y,f=t[Symbol.iterator]();!(h=(y=f.next()).done);h=!0){var p=y.value;null===u[p]?u[p]=[]:u[p]=[u[p].value]}}catch(R){c=!0,d=R}finally{try{h||null==f.return||f.return()}finally{if(c)throw d}}}}catch(R){l=!0,i=R}finally{try{o||null==s.return||s.return()}finally{if(l)throw i}}for(var v=e.length-1;v>=0;v--)if(r.includes(e[v].uri.value)){var m=!0,g=!1,T=void 0;try{for(var b,O=function(){for(var t=b.value,r=function(r){if(n=e[v][t],e[r].uri.value===e[v].uri.value){if(!n.some((function(n){return e[r][t].includes(n)})))return e[r][t]=e[r][t].concat(n),"break";if(t.includes("Type")&&e[r][t.split("Type")[0]].length!==e[r][t].length)return e[r][t]=e[r][t].concat(n),"break"}},o=e.length-1;o>=0;o--){if("break"===r(o))break}},E=t[Symbol.iterator]();!(m=(b=E.next()).done);m=!0)O()}catch(R){g=!0,T=R}finally{try{m||null==E.return||E.return()}finally{if(g)throw T}}e.splice(v,1)}else r.push(e[v].uri.value);return e}}]),t}(E),C=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).call(this))).addToOntoModel=function(t,n,r,o,l,i,a,s,u,h,c){var d,y,f;!1===e.getOntoElement(e.ontoUri+a)?(s=void 0!==s&&s,c=void 0===c?"":c,""!==a&&void 0!==a&&!1===s?(d=!1,y=a,f=e.ontoUri+a):(d=o,y=s?a:n,f=t),!1===e.getOntoElement(f)&&e.ontoModel.push({uri:f,label:y,ontoType:r,puroType:d,fromRelation:[l],direction:[i],from:[void 0],to:[void 0],type:"Class",branchIndex:[h],origUri:c})):(t=u+a,e.updateOntoModel(t,"fromRelation",l),e.updateOntoModel(t,"direction",i),e.updateOntoModel(t,"branchIndex",h));return console.log(e.ontoModel),e.ontoModel},e.addRelation=function(t,n,r,o,l,i,a){o=void 0===o?e.ontoUri.slice(0,-1)+"/relation/"+t+"/"+e.delUri(n)+e.delUri(r):o,i=void 0===i?[]:[i],a=void 0===a?[]:[a],n=void 0===n||0===n.length?[]:[n],r=void 0===r||0===r.length?[]:[r];var s=!0,u=!1,h=void 0;try{for(var c,d=e.ontoModel[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var y=c.value;if("relation"===y.type&&y.from.includes(n)&&y.to.includes(r))return e.ontoModel}}catch(f){u=!0,h=f}finally{try{s||null==d.return||d.return()}finally{if(u)throw h}}return e.ontoModel.push({type:"relation",ontoType:t,from:n,to:r,uri:o,label:l,fromType:i,toType:a,fromRelation:[]}),e.ontoModel},e.updateOntoModel=function(t,n,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=!0,i=!1,a=void 0;try{for(var s,u=e.ontoModel[Symbol.iterator]();!(l=(s=u.next()).done);l=!0){var h=s.value;if(h.uri===t)return Array.isArray(h[n])?!0!==o&&h[n].includes(r)||h[n].push(r):!0!==o&&h[n]===r||(h[n]=r),e.ontoModel}}catch(c){i=!0,a=c}finally{try{l||null==u.return||u.return()}finally{if(i)throw a}}return!1},e.getOntoModel=function(){return e.ontoModel},e.getElementsRelation=function(t,n){var r=[],o=!0,l=!1,i=void 0;try{for(var a,s=e.ontoModel[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value,h=!1;Array.isArray(u[n])&&(h=!!u[n].includes(t)),"relation"===u.type&&!0===h?r.push(u):"connect"===n&&(u.from.includes(t)||u.to.includes(t))&&r.push(u)}}catch(c){l=!0,i=c}finally{try{o||null==s.return||s.return()}finally{if(l)throw i}}return r},e.getElementOntoType=function(t){var n=e.getOntoElement(t);return!1!==n&&n.ontoType},e.getElementsByOntoType=function(t,n){var r=[],o=!0,l=!1,i=void 0;try{for(var a,s=e.ontoModel[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;t!==u.ontoType||void 0!==n&&!u.fromRelation.includes(n)||r.push(u.uri)}}catch(h){l=!0,i=h}finally{try{o||null==s.return||s.return()}finally{if(l)throw i}}return r},e.getOntoElement=function(t){var n=!0,r=!1,o=void 0;try{for(var l,i=e.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if(a.uri===t)return a}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return!1},e.changeOrigin=function(t,n){for(var r=0;r<e.ontoModel.length;r++)if(e.ontoModel[r].uri===t)return e.ontoModel[r].origin=n,!0;return!1},e.getLastElementUri=function(t,n){for(var r=e.ontoModel.length-1;r>=0;r--)for(var o=0;o<e.ontoModel[r].fromRelation.length;o++){if(e.ontoModel[r].fromRelation[o]===t&&e.ontoModel[r].direction[o]===n&&"Datatype"!==e.ontoModel[r].ontoType)return e.ontoModel[r].uri;if(e.ontoModel[r].fromRelation[o]===t&&void 0===n)return e.ontoModel[r].uri;if(void 0===t&&void 0===n)return e.ontoModel[r].uri}return!1},e.getLastElement=function(t,n){var r=e.getLastElementUri(t,n);return e.getOntoElement(r)},e.getFatherOntoType=function(t){var n=[];if("father"in t){var r=!0,o=!1,l=void 0;try{for(var i,a=e.ontoModel[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;t.father.includes(s.uri)&&n.push(s.ontoType)}}catch(u){o=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}}return 0===n.length&&(n=[""]),n},e.getRelationElements=function(t,n,r,o,l,i,a,s,u,h,c){var d,y,f=e.getOntoElement(r);if(""!==t&&"dataType"!==a&&!1===h&&(!1!==n||!1!==f))return"superType"===a?(d=e.ontoUri+t,y=!1!==f?f.uri:n.uri.value):"subType"===a?(y=e.ontoUri+t,d=!1!==f?f.uri:n.uri.value):(d=!1!==n?void 0===n.father[0]?n.uri.value:n.father[0]:f.uri,y=e.ontoUri+t),[d,y];if(null===o)return n.father.length>0&&[n.father[0],n.uri.value];if(a.includes("elementSelection")||!1!==n&&!1!==e.getOntoElement(n.father[0])){var p=e.getOntoElement(n.father[0]);return a.includes("invert")||!a.includes("elementSelection")?[n.uri.value,p.uri]:[p.uri,n.uri.value]}if(0===l&&!0===i||!1===n){var v=e.getLastElement(o);v=e.getOntoElement(e.getElementInRelRow(v.uri));var m=!1===n?e.ontoUri+t:r,g=e.getLastElementUri(o,u);if(g=e.getElementInRelRow(g),!1!==v&&(v.direction[v.direction.length-1]!==u||!0===c)&&0===l)return!e.isRelationExist(g,m)&&e.getOntoBranch(o,u).length>1?[g,m]:(e.updateOntoModel(o,u,m,!1),o);if(!1===n||!1!==v)return[v.uri,m]}},e.ontoModel=[],e}return Object(s.a)(t,e),Object(l.a)(t,[{key:"isRelationComplete",value:function(e){return"relation"===e.type&&e.from.length>0&&e.to.length>0}},{key:"getCardinalElement",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var l,i=this.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if("relation"===a.type&&"generalization"===a.ontoType.toLowerCase()&&a.from[0]===e&&!1===t)return a.to[0];if("relation"===a.type&&"generalization"===a.ontoType.toLowerCase()&&a.to[0]===e&&!0===t)return a.from[0]}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return!1}},{key:"getElementByProperty",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var l,i=this.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if(a[e]===t)return a}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return!1}},{key:"getReletadELement",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var l,i=this.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if("relation"===a.type&&(a.from.includes(e.uri)||a.to.includes(e.uri))&&this.isRelationComplete(a)){var s=void 0;if(s=a.from.includes(e.uri)?a.to[0]:a.from[0],(s=this.getOntoElement(s)).fromRelation.includes(t))return s}}}catch(u){r=!0,o=u}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return!1}},{key:"addToProperty",value:function(e,t,n){var r=!0,o=!1,l=void 0;try{for(var i,a=this.ontoModel[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;if(s.uri===e&&Array.isArray(s[t]))return s[t].push(n),!0}}catch(u){o=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return!1}},{key:"getElementInRelRow",value:function(e){var t=this.getElementInRelation(e,"*","from",!1);if(0===t.length)return e;var n=this.getElementInRelation(t[0].element.uri,"*","to",this.getOntoElement(e).ontoType);return console.log(n),console.log(n[0].element.uri),n[0].element.uri}},{key:"checkDuplicity",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,l=this.ontoModel[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){if(o.value.label===e)return!1}}catch(i){n=!0,r=i}finally{try{t||null==l.return||l.return()}finally{if(n)throw r}}return!0}},{key:"getRelatedTypes",value:function(e,t,n){var r=this.getElementsRelation(e,t),o=[],l=[],i=!0,a=!1,s=void 0;try{for(var u,h=r[Symbol.iterator]();!(i=(u=h.next()).done);i=!0){var c=u.value;if(c.ontoType===n||"Generalization"===n&&c.ontoType.includes("memberOf")){var d=c.to.includes(e)?c.from[c.to.indexOf(e)]:c.to[c.from.indexOf(e)];o.push(d),l.push(this.getElementOntoType(d))}else if(!1===n&&"Relator"===c.ontoType)l.push(c.ontoType);else if(!1===n){var y=c.to.includes(e)?c.from[c.to.indexOf(e)]:c.to[c.from.indexOf(e)];o.push(y),l.push(this.getElementOntoType(y))}}}catch(f){a=!0,s=f}finally{try{i||null==h.return||h.return()}finally{if(a)throw s}}return l}},{key:"getElementsFromBranch",value:function(e){for(var t=[e],n=e;!1!==this.getCardinalElement(n,!0);)n=this.getCardinalElement(n,!0),t.push(n);return t}},{key:"getElementInRelation",value:function(e,t,n,r){var o=[],l="*"===t;r=void 0!==r&&r;var i=!0,a=!1,s=void 0;try{for(var u,h=this.ontoModel[Symbol.iterator]();!(i=(u=h.next()).done);i=!0){var c=u.value;if("relation"===c.type&&(c.ontoType===t||l)&&c[this.getOpositeDirection(n)].includes(e)){var d=this.getOntoElement(c[n][0]);!1!==r&&r!==d.ontoType||o.push({element:d,relationType:c.ontoType})}}}catch(y){a=!0,s=y}finally{try{i||null==h.return||h.return()}finally{if(a)throw s}}return o}},{key:"isRelationExist",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var l,i=this.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if("relation"===a.type&&a.from===e&&a.to===t||a.from===t&&a.to===e)return!0}}catch(s){r=!0,o=s}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return!1}},{key:"getOntoBranch",value:function(e,t){var n=[],r=!0,o=!1,l=void 0;try{for(var i,a=this.ontoModel[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;for(var u in s.fromRelation)s.fromRelation[u]===e&&s.direction[u]===t&&n.push(s)}}catch(h){o=!0,l=h}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return n}},{key:"connectToBranchElement",value:function(e,t,n){var r="To which element is the "+this.delUri(n.uri.value)+" connected?",o=this.getOntoBranch(e,t)[0],l=this.getLastElement(e,t);return void 0!==o&&!1!==l&&this.createButtons([o.label,l.label],r,"nextBranchElements",!1,"")}},{key:"undo",value:function(e){this.ontoModel=JSON.parse(JSON.stringify(e))}}]),t}(E),x=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).call(this))).ontoModel=[],e}return Object(s.a)(t,e),Object(l.a)(t,[{key:"createGraph",value:function(e){this.ontoModel=e;var t="classDiagram\n",n=!0,r=!1,o=void 0;try{for(var l,i=this.ontoModel[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value;if("relation"===a.type&&!1!==this.findLabel(a.to[0])&&!1!==this.findLabel(a.from[0]))if("Relator"===a.ontoType){if(a.from.length>0&&a.to.length>0){for(var s in t+="class "+a.label+"{\n                                <<"+a.ontoType+">>\n                        }\n",a.from)t+=this.findLabel(a.from[s])+" "+(a.fromType[s]?'"'+a.fromType[s][0]+'"':"")+" .. "+(a.toType[s]?'"'+a.fromType[s][1]+'"':"")+" "+a.label+" : <<Mediation>>\n";for(var u in a.to)t+=a.label+" "+(a.toType[u]?'"'+a.toType[u][0]+'"':"")+" .. "+(a.toType[u]?'"'+a.toType[u][1]+'"':"")+" "+this.findLabel(a.to[u])+" : <<Mediation>>\n"}}else{var h=this.getRelationSpec(a.ontoType);if(a.from.length===a.to.length)for(var c in a.from)t+=this.findLabel(a.from[c])+" "+(a.fromType[c]?'"'+a.fromType[c]+'"':"")+h[0]+(a.toType[c]?'"'+a.toType[c]+'"':"")+" "+this.findLabel(a.to[c])+(!0===h[1]?" : <<"+a.ontoType.split("-")[0]+">>":"")+"\n";else for(var d in a.from){var y=this.findLabel(a.from[d])+" "+(a.fromType[d]?'"'+a.fromType[d]+'"':"")+h[0];for(var f in a.to)t+=y+(a.toType[f]?'"'+a.toType[f]+'"':"")+" "+this.findLabel(a.to[f])+(!0===h[1]?" : <<"+a.ontoType.split("-")[0]+">>":"")+"\n"}}else"relation"!==a.type&&(t+="class "+a.label+"{\n                    <<"+a.ontoType+">>\n                }\n")}}catch(p){r=!0,o=p}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return"classDiagram"!==t.trim()&&t}},{key:"getRelationSpec",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,l=this.rulesJson.relations[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var i=o.value;if(e in i){var a=i[e],s="showType"in i&&!0===i.showType,u=void 0;switch(a.toLowerCase()){case"arrowline":u=" <|-- ";break;case"simpleline":u=" -- ";break;case"dashedline":u=" .. ";break;case"composition":u=" *-- ";break;case"aggregation":u=" o-- ";break;default:u=" -- "}return[u,s]}}}catch(h){n=!0,r=h}finally{try{t||null==l.return||l.return()}finally{if(n)throw r}}}},{key:"findLabel",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,l=this.ontoModel[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var i=o.value;if(i.uri===e)return i.label}}catch(a){n=!0,r=a}finally{try{t||null==l.return||l.return()}finally{if(n)throw r}}return!1}}]),t}(E),S=function(e){function t(){var e,n;Object(o.a)(this,t);for(var r=arguments.length,l=new Array(r),s=0;s<r;s++)l[s]=arguments[s];return(n=Object(i.a)(this,(e=Object(a.a)(t)).call.apply(e,[this].concat(l)))).ruleSelection=function(e,t,r,o,l,i,a){var s,u,h,c="";if(s=l||n.getSpecificRule(e,t).offer,!1!==r){var d="";r.connect.length>1&&(d="\n "+n.getQuestion(a,"relSpecific")),n.isElementInstace(r,i)?(h=!0,r.uri.value,u=n.rulesJson.questions[1].question.replace("VAL",r.label.value)+d):(h=!1,r.uri.value,u=n.rulesJson.questions[0].question.replace("VAL",r.label.value)+d,c=r.label.value)}else{h=!0;var y=!0,f=!1,p=void 0;try{for(var v,m=n.rulesJson.questions[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){var g=v.value;if("bTypeChild"===g.type){u=g.question.replace("VAL",o);break}}}catch(T){f=!0,p=T}finally{try{y||null==m.return||m.return()}finally{if(f)throw p}}}return n.createButtons(s,u,"classSelection",h,c)},n.isElementInstace=function(e,t){var r=!0,o=!1,l=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;if(e.uri.value===s.uri.value){var u=!0,h=!1,c=void 0;try{for(var d,y=s.fatherTypeRelation[Symbol.iterator]();!(u=(d=y.next()).done);u=!0){var f=d.value;if("instanceOf"===n.delUri(f))return!0}}catch(p){h=!0,c=p}finally{try{u||null==y.return||y.return()}finally{if(h)throw c}}}}}catch(p){o=!0,l=p}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return!1},n.elementConsistencyRules=function(e,t){var r=n.rulesJson[e.ontoType],o=[],l={superType:t.getRelatedTypes(e.uri,"to","Generalization"),subType:t.getRelatedTypes(e.uri,"from","Generalization"),connect:t.getRelatedTypes(e.uri,"connect",!1)},i=!0,a=!1,s=void 0;try{for(var u,h=r[Symbol.iterator]();!(i=(u=h.next()).done);i=!0){var c=u.value;o=n.elementConsistencySelection(c,l.connect,"connect",e,o,r,l,t),o=n.elementConsistencySelection(c,l.superType,"superType",e,o,r,l,t),o=n.elementConsistencySelection(c,l.subType,"subType",e,o,r,l,t),"moreThanOne"===c.key&&(o=n.moreThanOneRule(t,e,c.count,o))}}catch(y){a=!0,s=y}finally{try{i||null==h.return||h.return()}finally{if(a)throw s}}o.length>0&&o[0].types.includes("Relator")&&o[0].types.includes("None")&&o.splice(0,1);for(var d=0;d<o.length;d++)o[d].elLabel=t.getOntoElement(o[d].element).label;return o},n.elementConsistencySelection=function(e,t,r,o,l,i,a,s){if(e.key===r){var u="e"===r[r.length-1]?"d":"ed",h=n.getSpecificRule(i,r+u,!0);if(!e.type.some((function(e){return t.includes(e)}))&&e.type.length>0)l.push({key:r,types:e.type,element:o.uri,rule:e});else if(!1!==h){var c=!0,d=!1,y=void 0;try{for(var f,p=h[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;console.log(JSON.parse(JSON.stringify(v))),v.type.some((function(e){return t.includes(e)}))&&(l=n.elementConsAddSelection("superType",v,t,l,o,a),l=n.elementConsAddSelection("subType",v,t,l,o,a),l=n.elementConsAddSelection("connect",v,t,l,o,a),"moreThanOne"in v&&!0===v.moreThanOne&&(l=n.moreThanOneRule(s,o,v.count,l)))}}catch(m){d=!0,y=m}finally{try{c||null==p.return||p.return()}finally{if(d)throw y}}}}return l},n.getSpecificRule=function(e,t,n,r){var o=[];if(n=void 0!==n&&n,!1!==(r=void 0!==r&&r)){var l=!0,i=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(l=(s=u.next()).done);l=!0){var h=s.value;if(h.key===t&&"bTypeNumber"in h&&h.bTypeNumber.includes(r)){if(!0!==n)return h;o.push(h)}}}catch(m){i=!0,a=m}finally{try{l||null==u.return||u.return()}finally{if(i)throw a}}}var c=!0,d=!1,y=void 0;try{for(var f,p=e[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;if(v.key===t){if(!0!==n)return v;o.push(v)}}}catch(m){d=!0,y=m}finally{try{c||null==p.return||p.return()}finally{if(d)throw y}}return o.length>0&&e},n.getAdditionalRule=function(e,t,n){return!1!==e&&n.toString()in e&&t in e[n]?(console.log(e[n][t]),e[n][t]):[]},n.commonRuleSelection=function(e,t,r){var o=[],l=[],i="elementSelection",a=!0,s=!1,u=void 0;try{for(var h,c=e.childType[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;l.push(n.delUri(d))}}catch(S){s=!0,u=S}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}var y=!0,f=!1,p=void 0;try{for(var v,m=r[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){var g=v.value;e.father.includes(g.uri)&&o.push(g.ontoType)}}catch(S){f=!0,p=S}finally{try{y||null==m.return||m.return()}finally{if(f)throw p}}var T=!0,b=!1,O=void 0;try{for(var E,R=function(){var r=E.value;if(console.log(!0===t),console.log("NoRelation"===r.fatherOnto),console.log(r.fatherOnto),!0===t&&"NoRelation"===r.fatherOnto[0]){var l="Which type is "+e.label.value+"?";return{v:n.createButtons(r.offer,l,i,!1,e.label.value)}}if(o.some((function(e){return r.fatherOnto.includes(e)}))||r.fatherOnto.includes("none")){"invert"in r&&!0===r.invert&&(i+="-invert");var a="Which type is "+e.label.value+"?";return{v:n.createButtons(r.offer,a,i,!1,e.label.value)}}},C=n.rulesJson.commonRules[Symbol.iterator]();!(T=(E=C.next()).done);T=!0){var x=R();if("object"===typeof x)return x.v}}catch(S){b=!0,O=S}finally{try{T||null==C.return||C.return()}finally{if(b)throw O}}},n}return Object(s.a)(t,e),Object(l.a)(t,[{key:"moreThanOneRule",value:function(e,t,n,r){var o=e.getElementInRelation(t.uri,"*","from",!1)[0];return e.getElementInRelation(o.element.uri,o.relationType,"to",t.ontoType).length<n&&r.push({key:"subType",types:[t.ontoType],element:o.element.uri,rule:{type:[t.ontoType],question:this.getQuestion(o.element,"moreThanOne")}}),r}},{key:"elementConsAddSelection",value:function(e,t,n,r,o,l){if(e in t)if(!t[e].some((function(t){return l[e].includes(t)}))&&t[e].length>0){for(var i in r)r[i].key===e&&r[i].element===o.uri&&r.splice(i,1);r.push({key:e,types:t[e],element:o.uri,rule:t})}else"moreThanOne"in t&&t.moreThanOne;return r}},{key:"numberOfRuleStep",value:function(e,t,n){var r=this.getSpecificRule(this.rulesJson[e],t,!1,n),o=0;for(var l in r)isNaN(l)||o++;return o}}]),t}(E),k=function(){function e(){Object(o.a)(this,e),this.ontoModelHistory=[],this.propertiesHistory=[],this.inputVariables=[]}return Object(l.a)(e,[{key:"init",value:function(e){this.propertiesHistory.push(e),this.ontoModelHistory.push([])}},{key:"reset",value:function(){this.ontoModelHistory=[],this.propertiesHistory=[],this.inputVariables=[]}},{key:"saveRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;this.propertiesHistory.push(e),this.ontoModelHistory.push(t),this.inputVariables.push(n)}},{key:"undo",value:function(){this.ontoModelHistory.pop();var e=this.propertiesHistory.pop();return this.inputVariables.pop(),void 0!==this.propertiesHistory[this.propertiesHistory.length-2]&&0===this.propertiesHistory[this.propertiesHistory.length-2].queryTree.length&&(this.propertiesHistory[this.propertiesHistory.length-2].queryTree=JSON.parse(JSON.stringify(e.queryTree))),console.log(this.propertiesHistory),console.log(this.inputVariables),console.log(this.ontoModelHistory),{ontoModel:this.ontoModelHistory[this.ontoModelHistory.length-2],properties:this.propertiesHistory[this.propertiesHistory.length-2],inputVariables:this.inputVariables[this.inputVariables.length-1]}}}]),e}(),N=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"transform",value:function(e){var t=this.schemaInit(),r=0,o=!0,l=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;"Class"!==u.type&&"relator"!==u.ontoType.toLowerCase()||t.contents.push(this.ontoClassTransformation(u))}}catch(N){l=!0,i=N}finally{try{o||null==s.return||s.return()}finally{if(l)throw i}}console.log(t);var h=!0,c=!1,d=void 0;try{for(var y,f=e[Symbol.iterator]();!(h=(y=f.next()).done);h=!0){var p=y.value;if("relation"===p.type&&"relator"!==p.ontoType.toLowerCase()){var v=void 0;v=p.from.length>=p.to.length?"from":"to";var m=0;for(var g in p[v]){var T="from"===v?g:m,b="to"===v?g:m;t.contents.push(this.relationTransformation(p,r,T,b)),r+=2,g<=p[v].length&&(m=g)}}else if("relator"===p.ontoType.toLowerCase()){var O=JSON.parse(JSON.stringify(p)),E=JSON.parse(JSON.stringify(p)),R=void 0;R=p.from.length>=p.to.length?"from":"to";var C=0;for(var x in p[R])O.uri+="rel1",E.uri+="rel2",O.ontoType+="mediation",E.ontoType+="mediation","from"===R?(O.fromType=p.fromType[x][0],O.toType=p.fromType[x][1],E.fromType=p.toType[C][0],E.toType=p.toType[C][1],O.from=[O.from[x]],E.to=[O.to[C]]):(O.fromType=p.fromType[C][0],O.toType=p.fromType[C][1],E.fromType=p.toType[x][0],E.toType=p.toType[x][1],O.from=[O.from[C]],E.to=[O.to[x]]),O.to=[p.uri],E.from=[p.uri],t.contents.push(this.relationTransformation(O,r,0,0)),r+=2,t.contents.push(this.relationTransformation(E,r,0,0)),r+=2,x<=p[R].length&&(C=x)}}}catch(N){c=!0,d=N}finally{try{h||null==f.return||f.return()}finally{if(c)throw d}}var S=n(831),k=(new(n(833))).compile(S.getSchema(S.ONTOUML_2));return this.ontoModel=this.initJson(),k(t)?t:(alert("Model is not valid! Check OntoSchemaCotroller!"),{})}},{key:"schemaInit",value:function(){return{type:"Package",id:"puroConversion",name:null,description:null,contents:[],propertyAssignments:null}}},{key:"ontoClassTransformation",value:function(e){return{type:"Class",id:e.uri,name:e.label,description:null,properties:null,literals:null,propertyAssignments:null,stereotypes:[e.ontoType.toLowerCase()],isAbstract:null,isDerived:null}}},{key:"relationTransformation",value:function(e,t,n,r){return"Generalization"===e.ontoType?{type:"Generalization",id:e.uri,name:null,description:null,general:{type:"Class",id:e.from[n]},specific:{type:"Class",id:e.to[r]},propertyAssignments:{nonStandardProperty:null}}:{type:"Relation",id:e.uri,name:null,description:null,properties:[{type:"Property",id:"prop"+t,name:null,description:null,propertyType:{type:"Class",id:e.from[n]},cardinality:""===e.fromType[n]?null:e.fromType[n],isDerived:null,isOrdered:null,isReadOnly:null,stereotypes:null,propertyAssignments:null,subsettedProperties:null,redefinedProperties:null,aggregationKind:null},{type:"Property",id:"prop"+(parseInt(t)+1),name:null,description:null,propertyType:{type:"Class",id:e.to[r]},cardinality:""===e.toType[r]?null:e.toType[r],isDerived:null,isOrdered:null,isReadOnly:null,stereotypes:null,propertyAssignments:null,subsettedProperties:null,redefinedProperties:null,aggregationKind:null}],propertyAssignments:{nonStandardProperty:null},stereotypes:[e.ontoType.toLowerCase()],isAbstract:!0,isDerived:!1}}},{key:"initJson",value:function(){return JSON.parse('[\n        {\n          "type": "relation",\n          "ontoType": "Characterization",\n          "from": [\n            "http://lod2-dev.vse.cz/data/puromodels#Book"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/puromodels#Topic"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#has_topic",\n          "label": "has_topic",\n          "fromType": [\n            "1"\n          ],\n          "toType": [\n            "1"\n          ],\n          "fromRelation": []\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#Book",\n          "label": "Book",\n          "ontoType": "Kind",\n          "puroType": "BType",\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#has_topic",\n            "http://lod2-dev.vse.cz/data/puromodels#published_in"\n          ],\n          "direction": [\n            "from",\n            "from"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#Topic",\n          "label": "Topic",\n          "ontoType": "Mode",\n          "puroType": "BType",\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#has_topic"\n          ],\n          "direction": [\n            "to"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        },\n        {\n          "type": "relation",\n          "ontoType": "Generalization",\n          "from": [\n            "http://lod2-dev.vse.cz/data/puromodels#Topic"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/puromodels#DDC_Topic"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/TopicDDC_Topic",\n          "label": "nazev",\n          "fromType": [\n            ""\n          ],\n          "toType": [\n            ""\n          ],\n          "fromRelation": []\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#DDC_Topic",\n          "label": "DDC_Topic",\n          "ontoType": "Subkind",\n          "puroType": "BType",\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#has_topic"\n          ],\n          "direction": [\n            "to"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        },\n        {\n          "type": "relation",\n          "ontoType": "Relator",\n          "from": [\n            "http://lod2-dev.vse.cz/data/ontomodels#q"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/puromodels#Location"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#published_in",\n          "label": "published_in",\n          "fromType": [\n            [\n              "1",\n              "1"\n            ]\n          ],\n          "toType": [\n            [\n              "1",\n              "1"\n            ]\n          ],\n          "fromRelation": []\n        },\n        {\n          "type": "relation",\n          "ontoType": "Generalization",\n          "from": [\n            "http://lod2-dev.vse.cz/data/puromodels#Book"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/ontomodels#q"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/Bookq",\n          "label": "nazev",\n          "fromType": [\n            ""\n          ],\n          "toType": [\n            ""\n          ],\n          "fromRelation": []\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels#q",\n          "label": "q",\n          "ontoType": "Role",\n          "puroType": false,\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#published_in"\n          ],\n          "direction": [\n            "from"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels#w",\n          "label": "w",\n          "ontoType": "Datatype",\n          "puroType": "BValue",\n          "fromRelation": [\n            {\n              "token": "uri",\n              "value": "http://lod2-dev.vse.cz/data/puromodels#published_in"\n            }\n          ],\n          "direction": [\n            "from"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            null\n          ]\n        },\n        {\n          "type": "relation",\n          "ontoType": "connect",\n          "from": [\n            "http://lod2-dev.vse.cz/data/puromodels#published_in"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/ontomodels#w"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels/relation/connect/published_inw",\n          "label": "nazev",\n          "fromType": [\n            "*"\n          ],\n          "toType": [\n            "*"\n          ],\n          "fromRelation": []\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/puromodels#Location",\n          "label": "Location",\n          "ontoType": "Role",\n          "puroType": "BType",\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#published_in"\n          ],\n          "direction": [\n            "to"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        },\n        {\n          "type": "relation",\n          "ontoType": "Generalization",\n          "from": [\n            "http://lod2-dev.vse.cz/data/ontomodels#e"\n          ],\n          "to": [\n            "http://lod2-dev.vse.cz/data/puromodels#Location"\n          ],\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/eLocation",\n          "label": "nazev",\n          "fromType": [\n            ""\n          ],\n          "toType": [\n            ""\n          ],\n          "fromRelation": []\n        },\n        {\n          "uri": "http://lod2-dev.vse.cz/data/ontomodels#e",\n          "label": "e",\n          "ontoType": "Kind",\n          "puroType": false,\n          "fromRelation": [\n            "http://lod2-dev.vse.cz/data/puromodels#published_in"\n          ],\n          "direction": [\n            "to"\n          ],\n          "from": [\n            null\n          ],\n          "to": [\n            null\n          ],\n          "type": "Class",\n          "branchIndex": [\n            1\n          ]\n        }\n      ]')}}]),e}(),w=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).call(this))).rdfController=new R,e.ontoController=new C,e.imageController=new x,e.ruleController=new S,e.historyController=new k,e.ontoSchemaController=new N,e.rdfController.getFullPath().then((function(t){e.queryTree=t,console.log(t)})),e.rdfController.getRelations().then((function(t){e.relations=t})),e.elSettings={},e.relationOrderIndex=0,e.relation={},e.relationIndex=0,e.relationType="",e.setIndexexToDefault(),e}return Object(s.a)(t,e),Object(l.a)(t,[{key:"getDefault",value:function(e){if(this.relationOrderIndex===this.relations.length||0===this.relations.length)return!0===e?(this.relationTree=this.queryTree,this.ruleKey="from",this.elementUri=this.relationTree[this.relationOrderIndex].uri.value,this.relation={uri:{value:null}},this.ruleController.commonRuleSelection(this.relationTree[this.relationOrderIndex],!0,this.ontoController.getOntoModel())):(alert("Transformation is comlete!!!"),{buttons:[],title:"The End",type:"end"});var t=this.relations[this.relationOrderIndex];if(this.relation=t,this.ruleKey="from",this.relation.valuation.length>0){var n=t.label.value.charAt(0).toUpperCase()+t.label.value.slice(1)+" was typed as a Relator.";return this.createButtons("Relator",n,this.delUri(t.type.value),!1,t.label.value)}this.elementUri=t.uri.value;var r=this.rulesJson.bRelationRules[0].question.replace("VAL",t.label.value);return this.createButtons(this.rulesJson.bRelationRules[0].offer,r,this.delUri(t.type.value),!1,t.label.value)}},{key:"nextElement",value:function(){var e=Object(O.a)(b.a.mark((function e(t,n,r,o,l){var i,a,s,u,h,c,d,y,f,p,v,m,g,T,O,E,R;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(this.relationTree),console.log([t,n,r,o,l]),""!==o&&!0===l&&this.changeElementsProperty(this.elementUri,"label",o),"BRelation"!==r){e.next=7;break}return e.abrupt("return",this.relationWasSelected(t,this.ruleKey));case 7:if(s=[],u=r,!r.includes("ontoRelation-save-bRelation")&&!r.includes("material")){e.next=27;break}if(r.includes("relator")?"from"===(c=r.replace("ontoRelation-save-bRelation-relator-",""))?(this.ontoController.updateOntoModel(this.relation.uri.value,"fromType",t),u="last"===this.additionalRule.key?"updated":u):"to"===c&&(this.ontoController.updateOntoModel(this.relation.uri.value,"toType",t),u="last"===this.additionalRule.key?"updated":u):(this.ontoController.updateOntoModel(this.relation.uri.value,"fromType",t[0]),this.ontoController.updateOntoModel(this.relation.uri.value,"toType",t[1]),u="last"===this.additionalRule.key?"updated":u),"cPhase-next"!==this.lastElInBranch){e.next=21;break}if(!(this.relation[this.ruleKey].length<=this.relationRuleIndex)){e.next=18;break}return this.relationOrderIndex++,this.setIndexexToDefault(),e.abrupt("return",this.getDefault());case 18:return e.abrupt("return",this.nextTreeBranch());case 19:e.next=27;break;case 21:t=this.elSettings.selectedType,r=this.elSettings.puroType,o=this.elSettings.elName,a=this.elSettings.relationEl,s=this.elSettings.additionalRule,l=this.elSettings.nameWasChange;case 27:if(Array.isArray(t)||"none"!==t.toLowerCase()){e.next=37;break}if(this.elSettings.selectedType=t,d=this.ontoController.getOntoElement(this.relation.uri.value),this.additionalRule.key="stop",d[this.ruleKey].length!==this.relationRuleIndex&&(y=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(d.uri,this.ruleKey,y)),!1===(f=this.updateRelationTypes())){e.next=35;break}return e.abrupt("return",f);case 35:return this.consistencyExeption.push({uri:this.elementUri,ontoType:t,type:r}),e.abrupt("return",this.consistencyCheck());case 37:if(r.includes("ontoRelation")||"dataType"===r){e.next=48;break}if("stop"!==this.additionalRule.key&&void 0===this.additionalRule.key&&(this.additionalRule.index>1||0===this.ontoController.getOntoBranch(this.relation.uri.value,this.ruleKey).length)&&null!==this.relation.uri.value?(s=this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),t,1)).length>0&&(this.additionalRule.index=2,this.additionalRule.rule=this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),this.additionalRule.key=t):this.additionalRule.index>1&&"stop"!==this.additionalRule.key&&((s=this.ruleController.getAdditionalRule(this.additionalRule.rule,t,this.additionalRule.index)).length>0?this.additionalRule.index++:this.additionalRule.key="last"),a=this.ontoController.getRelationElements(o,this.getElementByUri(this.elementUri),this.elementUri,this.relation.uri.value,s.length,0===s.length,r,this.ontoUri,this.ruleKey,l,this.relationRuleIndex>1),this.elSettings={selectedType:t,nameWasChange:l,puroType:r,ruleKey:this.ruleKey,elName:o,relationEl:a,additionalRule:s,relType:"",elUri:this.elementUri},a!==this.relation.uri.value&&"cPhase"!==this.lastElInBranch){e.next=46;break}if(!1===(p=this.updateRelationTypes())){e.next=46;break}return this.lastElInBranch+="-next",e.abrupt("return",p);case 46:e.next=49;break;case 48:"dataType"===r?(a=[t,this.ontoUri+o],this.elSettings.relationEl=a,this.elSettings.relType="connect",this.ontoController.addToOntoModel(this.ontoUri+o,o,"Datatype","BValue",this.relation.uri,this.ruleKey,void 0,void 0,void 0,void 0,this.elementUri)):(r.includes("ontoRelation-cardinality")?this.elSettings.relType=t:r.includes("ontoRelation-save")&&(h=t),t=this.elSettings.selectedType,r=this.elSettings.puroType,o=this.elSettings.elName,a=this.elSettings.relationEl,s=this.elSettings.additionalRule,l=this.elSettings.nameWasChange,this.elementUri=this.elSettings.elUri);case 49:if(!0===(i=this.getRelationRules(a,u,n,this.ruleKey,this.elSettings.selectedType,this.elSettings.relType,h))){e.next=52;break}return e.abrupt("return",Promise.resolve(i));case 52:if(null===this.valuationArr){e.next=67;break}if(!(this.valuationArr.length>0)){e.next=57;break}return e.abrupt("return",this.handleValuation());case 57:if(0!==this.valuationArr.length){e.next=67;break}if("to"!==this.ruleKey||this.relation.to.length!==this.relationRuleIndex){e.next=66;break}return v=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(this.relation.uri.value,"to",v),this.elementUri=v,this.lastElInBranch="cPhase",e.abrupt("return",this.updateRelationTypes());case 66:return e.abrupt("return",this.nextTreeBranch());case 67:if(m=!1!==this.selectedEl&&"type"in this.selectedEl&&this.delUri(this.selectedEl.type.value),g=void 0,this.relationTree[this.relationTree.length-1].uri.value===this.elementUri&&!1===this.ontoController.getOntoElement(this.elementUri)&&(g="first"),this.ontoController.addToOntoModel(this.elementUri,this.delUri(this.elementUri),t,m,this.relation.uri.value,this.ruleKey,o,l,this.ontoUri,this.relationRuleIndex,g),!(s.length>0)){e.next=78;break}return this.selectedEl=this.getNextElement(),this.elementUri=!1===this.selectedEl||Array.isArray(this.selectedEl)?"":this.selectedEl.uri.value,this.selectedEl=""!==this.elementUri&&this.selectedEl,e.abrupt("return",this.ruleController.ruleSelection(void 0,this.ruleKey,this.selectedEl,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,s,this.queryTree,this.relation.label.value));case 78:if("last"!==this.additionalRule.key){e.next=90;break}if((T=this.ontoController.getOntoElement(this.relation.uri.value))[this.ruleKey].length!==this.relationRuleIndex&&(O=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(T.uri,this.ruleKey,O)),!1===(E=this.updateRelationTypes())){e.next=86;break}return e.abrupt("return",E);case 86:return this.additionalRule.key="stop",e.abrupt("return",this.consistencyCheck());case 88:e.next=93;break;case 90:return this.additionalRule.key="stop",null!==this.relation.uri.value&&0===this.ontoController.getOntoElement(this.relation.uri.value).from.length&&(R=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(this.relation.uri.value,this.ruleKey,R)),e.abrupt("return",this.consistencyCheck());case 93:case"end":return e.stop()}}),e,this)})));return function(t,n,r,o,l){return e.apply(this,arguments)}}()},{key:"consistencyCheck",value:function(){if(0===this.elementsWithoutType.length&&(this.elementsWithoutType=this.checkElementsInRelationTree(this.relationTree,this.ontoController.getOntoModel())),this.elementsWithoutType.length>0&&this.withoutTypeIndex<this.elementsWithoutType.length){var e=this.getElementByUri(this.elementsWithoutType[this.withoutTypeIndex].uri.value);this.withoutTypeIndex++,this.elementUri=e.uri.value;var t=this.ruleController.commonRuleSelection(e,this.ruleKey,this.ontoController.getOntoModel());if(void 0!==t)return t;alert("Common rule is not defined! Check rules.json"),window.location.reload()}var n=this.checkElementsConsistency(this.relation.uri.value,this.ruleKey);if(n.length>0){var r=!0,o=!1,l=void 0;try{for(var i,a=this.consistencyExeption[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;for(var u in n)s.uri===n[u].element&&n[u].types.includes(s.ontoType)&&s.type===n[u].key&&n.splice(u,1)}}catch(y){o=!0,l=y}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}(n.length>0&&n[0].types.includes("Relator")&&n[0].types.includes("None")||n.length>0&&n[0].types.includes("None")&&1===n[0].types.length)&&n.splice(0,1)}if(n.length>0){var h=this.createQuestion(n[0],this.rulesJson.questions);return this.elementUri=n[0].element,this.createButtons(n[0].types,h,n[0].key,!0)}if(null===this.relation.uri.value)return this.getDefault();if(null===this.relation&&this.getDefault(),null===this.valuationArr&&1===this.relationRuleIndex&&(this.valuationArr=this.getAllTreeValuations(this.ruleKey),this.valuationArr.length>0))return this.handleValuation();if(this.relation[this.ruleKey].length===this.relationRuleIndex&&"from"!==this.ruleKey){var c=this.ontoController.getOntoElement(this.relation.uri.value);if(c.to.length<this.relationRuleIndex){var d=this.ontoController.getLastElement(c.uri,"to");return this.ontoController.updateOntoModel(c.uri,"to",d.uri),this.lastElInBranch="cPhase",this.updateRelationTypes(!0)}return this.setIndexexToDefault(),this.relationOrderIndex++,this.getDefault()}return this.nextTreeBranch()}},{key:"updateRelationTypes",value:function(){var e=this.ontoController.getOntoElement(this.relation.uri.value);if(e.to.length>0&&e.from.length>0){if("Relator"===e.ontoType&&e.fromType.length<e.from.length){var t=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality");return this.createRelCardinalityBtn("ontoRelation-save-bRelation-relator-from",t,"from",e.from[e.fromType.length],e.uri)}if("Relator"===e.ontoType&&e.toType.length<e.to.length){var n=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality");return this.createRelCardinalityBtn("ontoRelation-save-bRelation-relator-to",n,"to",e.uri,e.to[e.toType.length])}if(e.toType.length<e.to.length&&e.fromType.length<e.from.length){var r=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality");return this.createRelCardinalityBtn("ontoRelation-save-bRelation",r,"to",e.from[e.fromType.length],e.to[e.toType.length])}}return!1}},{key:"handleValuation",value:function(){var e="Which Datatype represents "+this.delUri(this.valuationArr[0].valuation)+"?",t=this.createButtons(this.valuationArr[0].el,e,"dataType",!0);return this.elementUri=this.valuationArr[0].valuation,this.valuationArr.shift(),t}},{key:"nextTreeBranch",value:function(){var e,t=this;if(null===this.valuationArr&&1===this.relationRuleIndex&&(this.valuationArr=this.getAllTreeValuations(this.ruleKey),this.valuationArr.length>0))return this.handleValuation();if(0===this.ontoController.getOntoElement(this.relation.uri.value).from.length||this.relationRuleIndex>1&&"from"===this.ruleKey){var n=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey);this.ontoController.updateOntoModel(this.relation.uri.value,this.ruleKey,n)}return this.relationTreeIndex===this.relationTreeArr.length?(this.relation[this.ruleKey].length===this.relationRuleIndex&&(this.ruleKey="from"===this.ruleKey?"to":"from",this.relationRuleIndex=0),e=this.getRelatedElements(this.relation,this.ruleKey),this.relationRuleIndex++):e=Promise.resolve(this.relationTreeArr),this.additionalRule.key=void 0,this.additionalRule.index=0,this.consistencyExeption=[],new Promise((function(n){e.then((function(e){t.valuationArr=null,n(t.handleRelatedElements(e,"nextElement",t.ruleKey))}))}))}},{key:"getAllTreeValuations",value:function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var l,i=this.relationTree[Symbol.iterator]();!(n=(l=i.next()).done);n=!0){var a=l.value,s=this.getElementByUri(a.uri.value);if(s.valuation.length>0){var u=s.uri.value;if("BObject"===this.delUri(s.type.value)||s.fatherTypeRelation.includes("http://lod2-dev.vse.cz/ontology/puro#instanceOf")){var h=this.rulesJson.lastTypes,c=[],d=!0,y=!1,f=void 0;try{for(var p,v=h[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var m=p.value;c=c.concat(this.ontoController.getElementsByOntoType(m,this.relation.uri.value))}}catch(U){y=!0,f=U}finally{try{d||null==v.return||v.return()}finally{if(y)throw f}}c.length>0&&(u=c[0])}var g=!0,T=!1,b=void 0;try{for(var O,E=s.valuation[Symbol.iterator]();!(g=(O=E.next()).done);g=!0){var R=O.value;t.push({el:u,valuation:R})}}catch(U){T=!0,b=U}finally{try{g||null==E.return||E.return()}finally{if(T)throw b}}}}}catch(U){r=!0,o=U}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}if("from"===e){var C=!0,x=!1,S=void 0;try{for(var k,N=this.relation.valuation[Symbol.iterator]();!(C=(k=N.next()).done);C=!0){var w=k.value;t.push({el:this.relation.uri.value,valuation:w})}}catch(U){x=!0,S=U}finally{try{C||null==N.return||N.return()}finally{if(x)throw S}}}for(var I in t)!1!==this.ontoController.getElementByProperty("origUri",t[I].valuation)&&t.splice(I,1);return t}},{key:"getGraphSvg",value:function(){var e=this.ontoController.getOntoModel();return this.imageController.createGraph(e)}},{key:"createRelCardinalityBtn",value:function(e,t,n,r,o,l,i){e+="dataType"===l?"-daType":"";var a=t.fromT.map((function(e){return{name:e,uri:i,direction:"from"}})),s=t.toT.map((function(e){return{name:e,uri:i,direction:"to"}})),u=this.selectElementsLabel(r),h=this.selectElementsLabel(o);return{buttons:s.concat(a),title:"Select cardinality between elements",type:e,elName:[u,h]}}},{key:"selectElementsLabel",value:function(e){var t=this.ontoController.getOntoElement(e);return!1===t?e===this.elSettings.elUri?""===this.elSettings.elName?this.delUri(e):this.elSettings.elName:this.delUri(e):t.label}},{key:"getRelationRules",value:function(e,t,n,r,o,l,i){var a,s,u,h,c,d=t.replace("ontoRelation-",""),y=this.rulesJson.relationRules;if(!Array.isArray(e))return!0;if(a=e[0],s=e[1],u=!1===(u=this.ontoController.getElementOntoType(a))?o:u,h=!1===(h=this.ontoController.getElementOntoType(s))?o:h,c=this.findRule(y,["from",u,"to",h]),"updated"===t)return!0;if(!1!==c||d.includes("save")||alert("Relation rule is not defined! Check rules.json!"),d.includes("save")||"cardinality"!==d&&"dataType"!==d&&1!==c.offer.length){if(d.includes("save"))return this.ontoController.addRelation(this.elSettings.relType,a,s,void 0,"nazev",i[0],i[1]),!0;var f=c.offer.map((function(e){return{name:e,uri:n,origin:r}}));return this.elementUri=n,{buttons:f,title:"Which type of relation is between "+this.delUri(a)+" and "+this.delUri(s)+"?",type:"ontoRelation-cardinality"}}return"fromT"in c&&"toT"in c?(this.elSettings.relType=1===c.offer.length?c.offer[0]:this.elSettings.relType,this.createRelCardinalityBtn("ontoRelation-save",c,r,a,s,d,n)):(l=1===c.offer.length?c.offer[0]:l,this.ontoController.addRelation(l,a,s,void 0,"nazev","",""),!0)}},{key:"findRule",value:function(e,t){var n=!1,r=!0,o=!1,l=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;n=!1;for(var u=0;u<t.length;u+=2){var h=!0,c=!1,d=void 0;try{for(var y,f=s[t[u]][Symbol.iterator]();!(h=(y=f.next()).done);h=!0){var p=y.value;if(this.isSameCaseInsensitive(t[u+1],p)||"*"===p){if(!0===n)return s;n=!0;break}}}catch(v){c=!0,d=v}finally{try{h||null==f.return||f.return()}finally{if(c)throw d}}}}}catch(v){o=!0,l=v}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return!1}},{key:"relationWasSelected",value:function(e){var t=this;this.ruleKey="from",this.relation=this.relations[this.relationOrderIndex],this.relationType=e;var n,r=this.rulesJson[e];return n=this.relationTreeArr.length===this.relationTreeIndex?this.getRelatedElements(this.relation,this.ruleKey):Promise.resolve(this.relationTreeArr),this.relationRuleIndex++,this.ontoController.addRelation(e,"","",this.relation.uri.value,this.relation.label.value),new Promise((function(e){n.then((function(n){e(t.handleRelatedElements(n,"relationWasSelected",t.ruleKey,r))}))}))}},{key:"handleRelatedElements",value:function(e,t,n,r){if(r=void 0===r?this.rulesJson[this.relationType]:r,this.relationTreeArr=e,this.relationTree=e[this.relationTreeIndex],this.relationTreeIndex++,this.relationIndex=this.relationTree.length-1,"relationWasSelected"===t||!1!==this.ontoController.getOntoElement(this.relationTree[this.relationIndex].uri.value)){var o,l=this.getNextElement(),i=[],a="",s=!1,u=!1,h=!1,c=null;if(Array.isArray(l)&&!1===l[1]){h=l[0],a=l[0].ontoType;var d=this.getElementByUri(l[0].uri);!1!==d&&d.child.length>0&&(s=this.getElementByUri(d.child[0]),this.selectedEl=s,u=!0),this.ontoController.updateOntoModel(l[0].uri,"branchIndex",this.relationRuleIndex,!1),(this.relationRuleIndex>1||h.fromRelation.length>0)&&!this.additionalRule.index>0&&this.additionalRule.index++}else this.selectedEl=l,(s=this.getElementByUri(this.selectedEl.uri.value)).father.length>0&&(a=this.ontoController.getElementOntoType(s.father[0]));if(""!==a&&!1!==a){var y=this.ontoController.getElementsFromBranch(h.uri),f=1,p=[];for(var v in y){if("first"===this.ontoController.getOntoElement(y[v]).origUri){y.length=parseInt(v)+parseInt(1);break}}for(var m=y.length-1;m>=0;m--){var g=this.ontoController.getOntoElement(y[m]);if(!((i=this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),g.ontoType,f)).length>0)){if(p.includes(g.ontoType)){i=[];break}c=g,this.additionalRule.key=a,i=p;break}p=i,this.additionalRule.index++,f=this.additionalRule.index,m===y.length-1&&(this.additionalRule.key=a,i=p)}i.length>0&&(this.additionalRule.rule=this.ruleController.getSpecificRule(r,n,this.countBTypesInTree(this.relationTree)))}return 0===i.length?!1===s&&!0===u?this.nextTreeBranch():"relationWasSelected"!==t&&!0===u?(this.ontoController.updateOntoModel(this.relation.uri.value,n,h.uri),this.elementUri=h.uri,this.lastElInBranch="cPhase",this.updateRelationTypes(!0)):"relationWasSelected"!==t||!0!==u&&!1===h?(this.elementUri=this.selectedEl.uri.value,this.ruleController.ruleSelection(r,n,s,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,void 0,this.queryTree,this.relation.label.value)):(this.ontoController.updateOntoModel(this.relation.uri.value,n,h.uri),this.nextTreeBranch()):(this.elementUri=!1!==s?this.selectedEl.uri.value:"",null!==c?(this.elementUri=c.uri,o=c.label):o=h.label,this.ruleController.ruleSelection(void 0,n,s,o,i,this.queryTree,this.relation.label.value))}var T=this.rulesJson[this.relationType];return this.selectedEl=this.relationTree[this.relationIndex],this.relationIndex--,this.elementUri=this.selectedEl.uri.value,this.ruleController.ruleSelection(T,n,this.selectedEl,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,void 0,this.queryTree,this.relation.label.value)}},{key:"getElementsWithoutType",value:function(e,t){var n=this.getElementByUri(e.uri.value);if(n.child.length>0){var r=!0,o=!1,l=void 0;try{for(var i,a=n.child[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value,u=this.getElementByUri(s);this.isElementInstace(u)||!1!==this.ontoController.getOntoElement(u.uri.value)||(t.push(u),t=this.getElementsWithoutType(u,t))}}catch(h){o=!0,l=h}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}}return console.log(t),t}},{key:"checkElementsInRelationTree",value:function(e,t){var n=[],r=!0,o=!1,l=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;n=this.getElementsWithoutType(s,n)}}catch(u){o=!0,l=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return n}},{key:"getRelatedElements",value:function(e,t){var n=this;this.elementConsitencyTree=[],this.elementConsistencyIndex=0,this.relationTreeIndex=0,this.relationTreeArr=[];var r=[];return r.push(this.rdfController.getRelationBTypes(e[t][this.relationRuleIndex])),Promise.all(r).then((function(r){console.log(r);for(var o=0;o<r.length;o++)r[o].length>0?(r[o].unshift(n.getElementByUri(e[t][n.relationRuleIndex-1])),r[o]=r[o].map((function(e){return n.getElementByUri(e.uri.value)}))):r[o]=[n.getElementByUri(e[t][o])];return r}))}},{key:"getNextElement",value:function(){if(this.relationIndex<0)return!1;var e,t=this.ontoController.getOntoModel();this.isElementUseless(this.relationTree[this.relationIndex])&&this.relationIndex--;for(var n=0;n<t.length;n++)if(void 0!==this.relationTree[this.relationIndex]&&t[n].uri===this.relationTree[this.relationIndex].uri.value){if(this.areChildrenInBranchUseless(this.relationTree[this.relationIndex])){for(var r=t[n].fromRelation[t[n].fromRelation.length-1],o=t[n].direction[t[n].direction.length-1],l=this.ontoController.getLastElementUri(r,o);!1!==this.ontoController.getCardinalElement(l,!1);)l=this.ontoController.getCardinalElement(l,!1);l=this.ontoController.getElementInRelRow(l),l=this.ontoController.getOntoElement(l);var i=this.ontoController.getOntoBranch(r,o),a=!0,s=!1,u=void 0;try{for(var h,c=i[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;this.ontoController.addToProperty(d.uri,"fromRelation",this.relation.uri.value),this.ontoController.addToProperty(d.uri,"direction",this.ruleKey)}}catch(y){s=!0,u=y}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return[l,!1]}this.relationIndex--,n=0}return e=void 0!==(e=this.relationTree[this.relationIndex])&&e,this.relationIndex--,e}},{key:"areChildrenInBranchUseless",value:function(e){return!e.childRel.includes("http://lod2-dev.vse.cz/ontology/puro#subTypeOf")}},{key:"isElementInstace",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,l=this.queryTree[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var i=o.value;if(e.uri.value===i.uri.value){var a=!0,s=!1,u=void 0;try{for(var h,c=i.fatherTypeRelation[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if("instanceOf"===this.delUri(d))return!0}}catch(y){s=!0,u=y}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}}}catch(y){n=!0,r=y}finally{try{t||null==l.return||l.return()}finally{if(n)throw r}}return!1}},{key:"checkElementsConsistency",value:function(e,t){var n=this.ontoController.getOntoModel(),r=0,o=[],l=!0,i=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(l=(s=u.next()).done);l=!0){var h=s.value;h.fromRelation.includes(e)&&h.direction[h.direction.length-1]===t&&h.branchIndex.includes(this.relationRuleIndex)&&o.push(h)}}catch(d){i=!0,a=d}finally{try{l||null==u.return||u.return()}finally{if(i)throw a}}if(0===o.length)return o;var c=this.ruleController.elementConsistencyRules(o[r],this.ontoController);for(r++;r<o.length&&0===c.length;)c=this.ruleController.elementConsistencyRules(o[r],this.ontoController),r++;return c}},{key:"isElementUseless",value:function(e){return"child"in e&&0===e.child.length&&0===e.connect.length&&0===e.connectFrom.length}},{key:"getElementByUri",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,l=this.queryTree[Symbol.iterator]();!(t=(o=l.next()).done);t=!0){var i=o.value;if(i.uri.value===e)return i}}catch(a){n=!0,r=a}finally{try{t||null==l.return||l.return()}finally{if(n)throw r}}return!1}},{key:"changeElementsProperty",value:function(e,t,n){for(var r=0;r<this.queryTree.length;r++)if(this.queryTree[r].uri.value===e)return this.queryTree[r][t].value=n,!0;return!1}},{key:"checkDuplicity",value:function(e){return this.ontoController.checkDuplicity(e)}},{key:"getConnectedElements",value:function(e,t){var n=[],r=!0,o=!1,l=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value,u=this.ontoController.getElementOntoType(s);if(!1===u||e[this.ruleIndex].connect.includes(u)){var h=!1!==u?this.delUri(s)+" ["+u+"]":this.delUri(s);n.push({name:h,uri:s})}}}catch(c){o=!0,l=c}finally{try{r||null==a.return||a.return()}finally{if(o)throw l}}return n}},{key:"setIndexexToDefault",value:function(){this.valuationArr=null,this.relationRuleIndex=0,this.relationTree={},this.relationTreeIndex=0,this.relationTreeArr=[],this.elementsWithoutType=[],this.withoutTypeIndex=0,this.elementConsistencyIndex=0,this.elementConsitencyTree=[],this.elementUri="",this.ruleKey="",this.type="",this.selectedEl={},this.elSettings={},this.lastElInBranch=!1,this.additionalRule={key:void 0,rule:{},index:1},this.consistencyExeption=[]}},{key:"saveHistory",value:function(e,t){if(0===this.historyController.propertiesHistory.length){var n={};for(var r in e)"queryTree"===e[r]?n[r]=JSON.parse(JSON.stringify(this.queryTree)):"string"===typeof e[r]?n[r]="":"number"===typeof e[r]?n[r]=0:Array.isArray(e[r])?n[r]=[]:"object"===typeof e[r]&&(n[r]={});this.historyController.init(n)}this.historyController.saveRecords(e,JSON.parse(JSON.stringify(this.ontoController.getOntoModel())),t)}},{key:"undo",value:function(){var e=this.historyController.undo();if(void 0===e.ontoModel&&void 0===e.properties)return this.historyController.reset(),this.ontoController.undo([]),this.setIndexexToDefault(),this.elSettings={},this.relationOrderIndex=0,this.relationRuleIndex=0,this.relation={},this.relationIndex=0,this.relationType="",!1;for(var t in this.ontoController.undo(e.ontoModel),console.log(JSON.parse(JSON.stringify(this.additionalRule))),e.properties)"object"===typeof e.properties[t]?(console.log(t),console.log(JSON.parse(JSON.stringify(this[t]))),this[t]=JSON.parse(JSON.stringify(e.properties[t]))):this[t]=e.properties[t];return console.log(JSON.parse(JSON.stringify(this.additionalRule))),{inputVariables:e.inputVariables}}},{key:"getOntoSchema",value:function(){return this.ontoSchemaController.transform(this.ontoController.getOntoModel())}},{key:"getIframeURL",value:function(){return this.rulesJson.iframeURL.replace("MODELID",this.modelId)}}]),t}(E),I=n(204),U=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(a.a)(t).call(this,e))).createGraph=function(e){n.setState({svg:e})},n.eventController=new w,n.state={svg:"",iframeURL:n.eventController.getIframeURL()},g.a.initialize({startOnLoad:!1,themeCSS:"#extensionEnd { fill: white; } #extensionStart { fill: white; }"}),n}return Object(s.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"container"},h.a.createElement("div",{className:"row"},h.a.createElement("div",{className:"form-group col-md-6",id:"graph"},h.a.createElement("label",{htmlFor:"exampleFormControlTextarea1"},"Puro model"),h.a.createElement("div",{className:"form-control  transformWindow embed-responsive",id:"exampleFormControlTextarea1"},h.a.createElement(L,{iframeURL:this.state.iframeURL}))),h.a.createElement("div",{className:"form-group col-md-6",id:"graph"},h.a.createElement(I.b,{enablePadding:!1},(function(t){t.zoomIn,t.zoomOut;var n=t.resetTransform;Object(r.a)(t,["zoomIn","zoomOut","resetTransform"]);return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"tools"},h.a.createElement("label",{htmlFor:"exampleFormControlTextarea1"},"Onto model"),h.a.createElement("button",{className:"toolBtn btn-sm btn-light",onClick:n},"Unzoom")),h.a.createElement("div",{className:"border"},h.a.createElement(I.a,null,h.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.state.svg},className:"transformWindow",id:"exampleFormControlTextarea1"}))))}))),h.a.createElement(B,{graphCreation:this.createGraph,eventController:this.eventController})))}}]),t}(h.a.Component),L=function(e){function t(){return Object(o.a)(this,t),Object(i.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return h.a.createElement("iframe",{onLoad:this.loaded,id:"iframePuro",className:"embed-responsive-item",src:this.props.iframeURL})}}]),t}(h.a.Component),B=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(a.a)(t).call(this,e))).handleChange=function(e){n.setState({elName:e.target.value})},n.handleSubmit=function(e){void 0!==e&&e.preventDefault(),n.eventController.getDefault(!0).then((function(e){n.setState({undoActive:!1,svgUrl:"",buttons:e.buttons,title:e.title,originalName:e.originalName,type:e.type,startTransform:!1})}))},n.undoClick=function(){},n.handleClick=function(e,t,r){var o=n.state.elName,l=!1,i=!0,a=n.state.nameWasChange;if(""===o&&!0===n.state.changeName&&"Undo"!==r&&"none"!==e.toLowerCase())alert("Plese write name of the element!");else if(""===o||o.match(/^[A-Za-z0-9-_*<>]+$/)){if("Undo"===r){var s=n.eventController.undo();if(!1===s)n.handleSubmit(),i=!1;else{var u=s.inputVariables;e=u[0],t=u[1],r=u[2],o=u[3],a=u[4],l=!0}}""===(o=o.replace(/\s/g,"_"))||!0!==n.state.changeName||n.eventController.checkDuplicity(o)?!0===i&&n.eventController.nextElement(e,t,r,o,a).then((function(i){if(!1===l){var a=Object.getOwnPropertyNames(n.eventController),s={},u=!0,h=!1,c=void 0;try{for(var d,y=a[Symbol.iterator]();!(u=(d=y.next()).done);u=!0){var f=d.value;f.includes("Controller")||"rulesJson"===f||"relations"===f||"function"!==typeof f&&(s[f]=n.assignProp(n.eventController[f]))}}catch(v){h=!0,c=v}finally{try{u||null==y.return||y.return()}finally{if(h)throw c}}n.eventController.saveHistory(s,[e,t,r,o,n.state.nameWasChange])}var p=n.eventController.getGraphSvg();n.setState({buttons:i.buttons,type:i.type,title:i.title,undoActive:!0,elName:"",changeName:i.elName,originalName:i.originalName,nameWasChange:!1}),!1!==p&&n.createGraph(p),n.state.type.includes("end")&&n.handleDownloadImage()})):alert("Element already exists! Please choose different name.")}else alert("Please change the name. It contains forbidden characters!")},n.assignProp=function(e){return Array.isArray(e)||"object"===typeof e?JSON.parse(JSON.stringify(e)):e},n.createGraph=function(e){g.a.render("id1",e,(function(e){n.setState({svg:e}),n.props.graphCreation(e)}))},n.handleChangeName=function(){n.setState({changeName:!n.state.changeName}),!0===n.state.changeName?(n.setState({elName:"",nameWasChange:!1}),f()(".changeAlert").fadeTo(1400,500).slideUp(500,(function(){f()(".changeAlert").alert("fade")}))):n.setState({elName:"",nameWasChange:!0})},n.handleDownloadImage=function(){var e=new Blob([n.state.svg],{type:"image/svg+xml;charset=utf-8"}),t=URL.createObjectURL(e);n.setState({svgUrl:t})},n.handleDownloadSchema=function(){var e=JSON.stringify(n.eventController.getOntoSchema());v()(e,"ontoSchema.json")},n.state={startTransform:!0,originalName:"",nameWasChange:!1,buttons:[],changeName:!1,elName:"",type:"",undoActive:!1,svg:""},n.eventController=n.props.eventController,n}return Object(s.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"container-fluid text-center questionPart"},h.a.createElement("button",{type:"Submint",className:this.state.startTransform?"btn btn-primary":"d-none","data-toggle":"modal","data-target":"#exampleModal",onClick:this.handleSubmit},"Start transformation"),h.a.createElement("div",{className:this.state.startTransform?"d-none":""},h.a.createElement("h3",{className:"questionTitle"},this.state.title),h.a.createElement("div",{className:"optionButtons d-none d-md-block"},h.a.createElement("div",{className:"btn-group-vertical text-right"},h.a.createElement("button",{type:"button",className:"btn btn-primary btnModal",onClick:this.handleChangeName,disabled:""===this.state.originalName||this.state.type.includes("ontoRelation")||this.state.type.includes("end")||"nextBranchElements"===this.state.type},!0===this.state.changeName&&""!==this.state.originalName?"Set original name":"Change name"),h.a.createElement("button",{type:"button",className:"btn btn-primary btnModal",onClick:function(){return e.handleClick(void 0,void 0,"Undo")},disabled:!this.state.undoActive},"Undo"),h.a.createElement("button",{type:"button",className:"btn btn-secondary btnModal","data-dismiss":"modal",onClick:function(e){window.confirm("Are you sure you want to cancel the transformation?")&&window.location.reload()}},"Cancel"))),h.a.createElement("div",{className:!0===this.state.changeName?"col-md-6 mx-auto":"d-none"},h.a.createElement("div",{className:"input-group inputName"},h.a.createElement("div",{className:"input-group-prepend"},h.a.createElement("span",{className:"input-group-text",id:""},"Name of the element:")),h.a.createElement("input",{placeholder:""===this.state.originalName?"Write name of the element!":this.state.originalName,type:"text",className:"form-control",onChange:this.handleChange,value:this.state.elName})),h.a.createElement("h5",{className:this.state.buttons.lenght>1?"text-center inputName":"d-none"},"Select element's class:")),h.a.createElement("div",{className:"divButtons text-center"},h.a.createElement(M,{buttons:this.state.buttons,onClickDownloadSchema:this.handleDownloadSchema,svgUrl:this.state.svgUrl,onClick:this.handleClick,type:this.state.type,elNames:this.state.changeName,originalName:this.state.originalName})),h.a.createElement("div",{class:"alert alert-success col-md-6 mx-auto changeAlert",role:"alert"},"Original name of the element was set!")))}}]),t}(h.a.Component),M=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(a.a)(t).call(this,e))).refs=h.a.createRef(),n}return Object(s.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.props.type.includes("ontoRelation-save")?h.a.createElement("div",{className:"row col-md-5 mx-auto"},h.a.createElement("label",{className:"label label-default col-md-6 mx-auto form-control"},this.props.elNames[0]),h.a.createElement("label",{className:"label label-default col-md-6 mx-auto form-control"},this.props.elNames[1]),h.a.createElement("select",{ref:"relFrom",className:"col-md-6 mx-auto form-control cardinalitySelect"},this.props.buttons.filter((function(e){return"from"===e.direction})).map((function(e){return h.a.createElement("option",{value:e.name},e.name)}))),h.a.createElement("select",{ref:"relTo",className:"col-md-6 mx-auto form-control cardinalitySelect"},this.props.buttons.filter((function(e){return"to"===e.direction})).map((function(e){return h.a.createElement("option",{value:e.name},e.name)}))),h.a.createElement("button",{className:"btn btn-success mx-auto questionPart",onClick:function(){return e.props.onClick([e.refs.relFrom.value,e.refs.relTo.value],null,e.props.type)}},"Next")):this.props.type.includes("end")?h.a.createElement("div",{className:"col-md-8 mx-auto"},h.a.createElement("a",{className:"btn btn-success btnEnd",href:this.props.svgUrl,download:"ontoUml-graph.svg"},"Download Onto-UML graph"),h.a.createElement("button",{type:"button",className:"btn btn-success btnEnd",onClick:function(){return e.props.onClickDownloadSchema()}},"Download Onto-Schema")):h.a.createElement("div",{className:"row col-md-6 mx-auto"},this.props.buttons.map((function(t){return h.a.createElement("div",{className:"col-md-4 mx-auto"},h.a.createElement("button",{key:e.props.uri,type:"button",className:"none"===t.name.toLowerCase()?" btn btn-secondary btnModal":"btn btn-success btnModal",onClick:function(){return e.props.onClick(t.name,t.uri,e.props.type,t.origin)}},e.props.type.includes("dataType")||""===e.props.originalName&&1===e.props.buttons.length||"relator"===t.name.toLowerCase()&&1===e.props.buttons.length?"Next":t.name))})))}}]),t}(h.a.Component),A=function(e){function t(){return Object(o.a)(this,t),Object(i.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return[h.a.createElement(U,null)]}}]),t}(h.a.Component);d.a.render(h.a.createElement(A,null),document.getElementById("root"))}},[[380,1,2]]]);
//# sourceMappingURL=main.15238d51.chunk.js.map