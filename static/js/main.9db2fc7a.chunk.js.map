{"version":3,"sources":["../node_modules/moment-mini/locale sync /^/.*$","../node_modules/@trust/webcrypto/src/algorithms sync","../node_modules/rdfstore/node_modules/n3/lib sync /^/N3.*$","controllers/MainController.js","controllers/RdfController.js","controllers/OntoModelController.js","controllers/ImageController.js","controllers/RuleController.js","controllers/HistoryController.js","controllers/OntoSchemaController.js","controllers/EventController.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","webpackEmptyContext","MainController","jsonData","$","ajax","type","url","async","cache","dataType","success","json","this","rulesJson","JSON","parse","stringify","ontoUri","windowUrl","URL","window","location","href","modelId","searchParams","get","buttons","title","elName","origName","mapButtons","Array","isArray","buttonType","name","Promise","originalName","labelEL","key","questions","q","replace","label","question","unfinishedType","rule","console","log","qType","elLabel","preposition","isSameCaseInsensitive","tree","index","node","delUri","value","fatherTypeRelation","includes","uri","result","split","element","push","object","find","text","other","localeCompare","undefined","sensitivity","direction","RdfController","puro","rdf","require","modelURL","xml","puroXML","error","jqXHR","textStatus","errorThrown","alert","relator","fromUri","query","sparqlQuery","deleteDuplicity","fatherElement","returnArr","endCall","elementsUri","length","i","findBTypeRelation","bind","findBTypeChild","forEach","father","fatherType","recursiveFindChild","lastResult","bTypeTree","lastCall","final","sparql","callback","turtle","XMLSerializer","serializeToString","store","graph","serialize","err","str","create","load","results","execute","relationUri","elementUri","properties","duplicity","checkArr","res","property","k","some","concat","splice","OntoModelController","addToOntoModel","ontoType","puroType","relationName","nameWasChange","branchIndex","origUri","elPuroType","elUri","getOntoElement","ontoModel","fromRelation","from","to","updateOntoModel","addRelation","fromType","toType","slice","el","getOntoModel","getElementsRelation","nextRel","getElementOntoType","getElementsByOntoType","origin","changeOrigin","getLastElementUri","j","getLastElement","getFatherOntoType","getRelationElements","selectedUri","addRulesLenght","lastEl","ruleKey","moreBranches","passEl","ontoEl","elementFather","lastRelElement","getElementInRelRow","lastElUri","isRelationExist","getOntoBranch","relation","superType","toLowerCase","isRelationComplete","relatedElement","relElements","getElementInRelation","fatherChildren","rels","elements","types","rel","indexOf","getCardinalElement","relationType","all","getOpositeDirection","el1","el2","selectedEl","firstEl","createButtons","ontoModelHistory","ImagController","graphCommand","findLabel","relationSpec","getRelationSpec","base","toKey","trim","relations","normRelType","showType","RuleController","ruleSelection","rules","previousElName","queryTree","relationLabel","offerTypes","needElName","getSpecificRule","offer","additionalQuestion","connect","getQuestion","isElementInstace","elementConsistencyRules","ontoController","check","elTypes","getRelatedTypes","subType","elementConsistencySelection","moreThanOneRule","minCount","maxCount","allTypes","suffix","additionalRules","r","addRule","elementConsAddSelection","mincCountount","moreThanOne","bTypeNumber","addRules","getAdditionalRule","selectedType","toString","commonRuleSelection","start","fatherOnto","childPuroType","childType","child","commonRules","elInRelation","childrenCount","indexCount","isNaN","HistoryController","propertiesHistory","inputVariables","rec","pop","lastProp","OntoScheController","ontoUmlSchema","schemaInit","relCount","ontoClassTransformation","opositeIndex","fromIndex","toIndex","relationTransformation","nodeCopy","nodeCopy2","schemas","validator","compile","getSchema","ONTOUML_2","initJson","ontoClass","parseInt","EventController","rdfController","imageController","ImageController","ruleController","historyController","ontoSchemaController","OntoSchmeController","getFullPath","then","getRelations","elSettings","relationOrderIndex","relationIndex","setIndexexToDefault","firstCall","relationTree","valuation","charAt","toUpperCase","bRelationRules","changeElementsProperty","relationWasSelected","additionalRule","relFlow","lastElInBranch","relationRuleIndex","getDefault","nextTreeBranch","relationEl","ontoRelation","updateCardinality","updateRelationTypes","consistencyExeption","consistencyCheck","countBTypesInTree","getElementByUri","relType","updateRelTypes","elRelTypes","relationRules","getRelationRules","valuationArr","handleValuation","purType","getNextElement","elementsWithoutType","checkElementsInRelationTree","withoutTypeIndex","commonRule","reload","unfinishedTypes","checkElementsConsistency","exeption","createQuestion","getAllTreeValuations","ontoRel","createRelCardinalityBtn","shift","relationTypePromise","relationTreeIndex","relationTreeArr","getRelatedElements","handleRelatedElements","valuations","treeEl","connectElement","lastTypes","getElementByProperty","createGraph","fromE","toE","relationFlow","fromB","fromT","ruleClass","toB","toT","labelFromE","selectElementsLabel","labelToE","relOntoType","fromEType","toEType","findRule","condition","validity","relationTreePromise","lastLabel","nextElement","bObjectChild","prevEl","rdfEl","getElementsFromBranch","addIndex","prevAdd","elWithoutType","currEl","childEl","getElementsWithoutType","elementConsitencyTree","elementConsistencyIndex","promiseArr","getRelationBTypes","unshift","returnEl","isElementUseless","areChildrenInBranchUseless","lastRel","lastDirection","lastElement","allBranchBtypes","addToProperty","childRel","consistencyIndex","consistencyTree","elementTypes","connectFrom","checkDuplicity","ruleIndex","record","initRec","init","saveRecords","history","undo","reset","prop","transform","Layout","props","svg","setState","eventController","state","iframeURL","getIframeURL","mermaid","initialize","startOnLoad","themeCSS","className","htmlFor","width","height","display","position","enablePadding","zoomIn","zoomOut","resetTransform","Fragment","onClick","dangerouslySetInnerHTML","__html","graphCreation","React","Component","QuestionPart","handleChange","event","target","handleSubmit","preventDefault","undoActive","svgUrl","startTransform","undoClick","handleClick","changeName","match","getOwnPropertyNames","historyRecord","assignProp","saveHistory","getGraphSvg","handleDownloadImage","chart","render","handleChangeName","fadeTo","slideUp","svgBlob","Blob","createObjectURL","handleDownloadSchema","ontoSchema","getOntoSchema","fileDownload","data-toggle","data-target","disabled","data-dismiss","confirm","placeholder","onChange","lenght","onClickDownloadSchema","elNames","class","role","TypeButtons","refs","createRef","ref","filter","val","relFrom","relTo","download","App","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.9db2fc7a.chunk.js","sourcesContent":["var map = {\n\t\"./locale\": 304,\n\t\"./locale.js\": 304\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 659;","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 795;","var map = {\n\t\"./N3Lexer\": 197,\n\t\"./N3Lexer.js\": 197,\n\t\"./N3Parser\": 198,\n\t\"./N3Parser.js\": 198,\n\t\"./N3Store\": 359,\n\t\"./N3Store.js\": 359,\n\t\"./N3StreamParser\": 360,\n\t\"./N3StreamParser.js\": 360,\n\t\"./N3StreamWriter\": 361,\n\t\"./N3StreamWriter.js\": 361,\n\t\"./N3Util\": 199,\n\t\"./N3Util.js\": 199,\n\t\"./N3Writer\": 200,\n\t\"./N3Writer.js\": 200\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 823;","import $ from 'jquery';\r\nexport default class MainController{\r\n    \r\n    constructor()\r\n    {\r\n        \r\n        let jsonData;\r\n        $.ajax({\r\n            type: \"GET\",\r\n            url: \"rules.json\",\r\n            async: false,\r\n            cache: false,\r\n            dataType: \"json\",\r\n            success: function(json) {\r\n                jsonData = json;\r\n            }\r\n        });\r\n\r\n        this.rulesJson = JSON.parse(JSON.stringify(jsonData)); \r\n        this.ontoUri = \"http://lod2-dev.vse.cz/data/ontomodels#\";\r\n\r\n        const windowUrl = new URL(window.location.href);\r\n        this.modelId = windowUrl.searchParams.get(\"model\");\r\n    }\r\n    // orgin lze držet jako property objektu \r\n    // uri lze držet v property objektu \r\n    createButtons (buttons, title, type, elName, origName = \"\") \r\n    {\r\n        \r\n        \r\n        //\"uri\": unfinishedTypes[0].element\r\n        buttons = !Array.isArray(buttons)? [buttons] : buttons;\r\n        const mapButtons = buttons.map(buttonType => {\r\n            return {name: buttonType};\r\n        });\r\n     \r\n        return Promise.resolve({buttons: mapButtons, title: title, type: type, elName: elName, originalName: origName}); \r\n    }\r\n\r\n    getQuestion(labelEL, key)\r\n    {\r\n\r\n        for (let q of this.rulesJson.questions)\r\n        {\r\n            \r\n            if (q.type === key)\r\n            {\r\n                const replace = typeof labelEL === \"string\" ? labelEL : labelEL.label; \r\n                return q.question.replace(\"VAL\", replace); \r\n            }\r\n        }\r\n    }\r\n\r\n    createQuestion (unfinishedType, questions) \r\n    {\r\n        let question = \"\";\r\n        if (\"question\" in unfinishedType.rule)\r\n        {\r\n            for (let q of questions)\r\n            {\r\n                \r\n                if (q.type === unfinishedType.rule.question)\r\n                {\r\n                    question = q.question;\r\n                    break;\r\n                    \r\n                }\r\n            }\r\n            console.log(unfinishedType)\r\n            question = (question === \"\") ? unfinishedType.rule.question : question; \r\n            let qType = (unfinishedType.key in unfinishedType.rule) ? unfinishedType.rule[unfinishedType.key][0] : unfinishedType.rule.type[0];\r\n            return question.replace(\"VAL\", unfinishedType.elLabel).replace(\"TYPE\",qType); \r\n        }\r\n        else\r\n        {\r\n            const preposition = this.isSameCaseInsensitive(unfinishedType.key, \"connect\") ? \" to \" : \" of \";\r\n            return \"What is \" + unfinishedType.key + preposition + unfinishedType.elLabel +\"?\";\r\n        }\r\n\r\n    }\r\n\r\n    countBTypesInTree(tree)\r\n    {\r\n        let index = 0; \r\n        for (let node of tree)\r\n        {\r\n            if (this.delUri(node.type.value) === \"BType\" && !node.fatherTypeRelation.includes(\"http://lod2-dev.vse.cz/ontology/puro#instanceOf\"))\r\n            {\r\n                index ++; \r\n            }\r\n        }\r\n\r\n        return index; \r\n    }\r\n   \r\n   \r\n    delUri (uri) \r\n    {\r\n        var result = []; \r\n        if (typeof uri === 'string')\r\n        {\r\n            return uri.split('#')[1];\r\n        }\r\n        else if (Array.isArray(uri))\r\n        {\r\n            for(let element of uri)\r\n            {\r\n                result.push(element.split('#')[1]);\r\n            }\r\n            return result; \r\n        }\r\n        else\r\n        {\r\n            return \"\";\r\n        }\r\n        \r\n    }\r\n     getKeyByValue(object, value) {\r\n        return Object.keys(object).find(key => object[key] === value);\r\n      }\r\n\r\n    isSameCaseInsensitive(text, other) {\r\n        return text.localeCompare(other, undefined, { sensitivity: 'base' }) === 0;\r\n    }\r\n\r\n    getOpositeDirection (direction)\r\n    {\r\n        return  direction = direction === \"from\" ? \"to\" : \"from\"; \r\n    }\r\n\r\n\r\n}","import $ from 'jquery';\r\nimport MainController from './MainController';\r\n\r\n\r\nexport default class RdfController extends MainController {\r\n    \r\n    constructor() {\r\n        super(); \r\n        this.rdf = require('rdflib');\r\n        let puro ;\r\n        \r\n        const modelURL = this.rulesJson[\"modelURL\"].replace(\"MODELID\", this.modelId)\r\n        // puroOutput.xml\r\n        $.ajax({\r\n            type: \"GET\",\r\n            url:  modelURL,\r\n            async: false,\r\n            cache: false,\r\n            dataType: \"xml\",\r\n            success: function(xml) {\r\n          \r\n                this.puroXML = xml;\r\n                console.log(this.puroXML)\r\n                puro = xml; \r\n            },\r\n            error: function (jqXHR, textStatus, errorThrown) {\r\n             alert(\"There is the problem to load serialized PURO model! \\n\" + errorThrown ); \r\n             //window.location.replace(document.referrer); \r\n            }\r\n        });\r\n        \r\n        this.puroXML = puro; \r\n     \r\n    }\r\n\r\n\r\n    getRelatorBtype  (relator, fromUri) \r\n    {\r\n            var query = `\r\n            PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n            SELECT ?element ?valuation ?elementLabel ?type ?father ?fatherLabel ?elementType ?fatherType WHERE \r\n            {\r\n                {<`+relator+`> puro:linkedTo ?element . <`+fromUri+`> puro:linkedTo <`+relator+`>} \r\n                UNION\r\n                {?element puro:linkedTo <`+relator+`> . <`+relator+`> puro:linkedTo <`+fromUri+`>}    \r\n                {?element a puro:BObject}\r\n                UNION\r\n                {?element a puro:BType}\r\n                ?element rdfs:label ?elementLabel .\r\n                ?element a ?elementType .  \r\n                OPTIONAL {?element puro:instanceOf ?father}\r\n                OPTIONAL {?father rdfs:label ?fatherLabel}\r\n                OPTIONAL {?father a ?fatherType}\r\n                OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\r\n               \r\n               \r\n            }`\r\n\r\n            return new Promise(resolve => {\r\n                this.sparqlQuery(query, function callback(result) {\r\n                     result = this.deleteDuplicity(result, [\"valuation\"])\r\n                    result[\"relationName\"] = relator; \r\n                    resolve(result);\r\n                  }); \r\n           });\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n    findBTypeRelation (fatherElement, returnArr,endCall)  \r\n    {\r\n            \r\n            var elementsUri = fatherElement.uri.value;\r\n            var query = `\r\n             PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n             PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n             SELECT ?uri ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \r\n             {\r\n                 {<` +elementsUri+`> puro:instanceOf ?uri }\r\n                 UNION\r\n                 {<` +elementsUri+`> puro:subTypeOf  ?uri }\r\n                 ?uri a ?type . \r\n                 ?uri rdfs:label ?label . \r\n                \r\n             }`;\r\n            this.sparqlQuery(query, function callback(result) {  \r\n                \r\n                var checkArr = []; \r\n                var connect = [];\r\n               \r\n                result = this.deleteDuplicity(result, [\"connect\", \"connectFrom\", \"father\", \"fatherType\",\"fatherTypeRelation\",\"child\",\"childType\",\"childRel\"]);\r\n        \r\n                if (result.length > 0)\r\n                {\r\n                    // otestovat jak funguje v případě dvou \r\n                    \r\n                    for (let i in result) {\r\n                        returnArr.push(result[i]);\r\n                        this.findBTypeRelation(result[i],returnArr,endCall);\r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    //POZOR MUZE BYT CHYB kvuli opakovani\r\n                    endCall(returnArr);\r\n                    return returnArr;\r\n                }\r\n            }.bind(this));          \r\n         }\r\n\r\n\r\n\r\n    findBTypeChild  (fatherElement, returnArr,endCall) \r\n        {\r\n               \r\n                const elementsUri = fatherElement.uri.value;\r\n                \r\n                const query = `\r\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                 SELECT ?uri ?valuation ?valuationLabel ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \r\n                 {\r\n                     {?uri puro:instanceOf <` +elementsUri+`>}\r\n                     UNION\r\n                     {?uri puro:subTypeOf <` +elementsUri+`>}\r\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri}}\r\n                     OPTIONAL {?child a ?childType}\r\n                     OPTIONAL {{?child ?childRel ?uri} UNION {?child ?childRel ?uri}}\r\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\r\n                     ?uri ?fatherTypeRelation <` +elementsUri+`> .\r\n                     ?uri rdfs:label ?label .\r\n                     ?uri a ?type . \r\n                     <` +elementsUri+`> a ?fatherType\r\n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\r\n                     OPTIONAL {?connectFrom puro:linkedTo ?uri. ?connectFrom a puro:BRelaion}\r\n                     BIND ( <`+elementsUri+`>  AS ?father)\r\n                 }`;\r\n                this.sparqlQuery(query, result => {  \r\n                    result = this.deleteDuplicity(result, [\"connect\",\"connectFrom\", \"father\", \"fatherType\",\"fatherTypeRelation\",\"child\",\"childType\",\"childRel\",\"valuation\"]);\r\n                  \r\n                    if (result.length > 0)\r\n                    {\r\n                        for (let i in result) {\r\n                            returnArr.push(result[i]);\r\n                            this.findBTypeChild(result[i],returnArr,endCall);\r\n                        }\r\n                    }\r\n                    else\r\n                    { \r\n                        endCall(returnArr);\r\n                        return returnArr;\r\n                    }\r\n                });          \r\n             }\r\n\r\n             getFullPath ()  \r\n             {\r\n                 const query = `\r\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                 SELECT ?uri ?valuation ?label ?type ?connect ?child ?fatherType ?father ?fatherTypeRelation ?childType ?childRel WHERE \r\n                 {\r\n                     ?uri rdfs:label ?label .\r\n                     ?uri a puro:BType . \r\n                     ?uri a ?type\r\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri} ?child a ?childType . ?child ?childRel ?uri . } \r\n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\r\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\r\n                     FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\r\n                     FILTER NOT EXISTS {?uri puro:instanceOf ?object}\r\n                 }`;\r\n                 return new Promise(resolve => {\r\n                  \r\n                  // instance může mít mnohem více dětí!!!! zaměř se na to a dej si na to pozor!!!\r\n                  this.sparqlQuery(query, function callback(result) {\r\n                      result.forEach(function(node) {\r\n                            \r\n                            node.father = [];\r\n                            node.fatherType = [];\r\n                            node.fatherTypeRelation = [];\r\n                            // tady to nastav ve SPARQ \r\n                            node[\"connectFrom\"] = [];\r\n                    });\r\n                  \r\n                      this.deleteDuplicity(result,[\"valuation\", \"connect\", \"childType\", \"child\", \"childRel\"]);\r\n                      this.recursiveFindChild(0,result,[], lastResult => {\r\n                             resolve(lastResult);\r\n                     });\r\n                 }.bind(this));\r\n             });\r\n             }\r\n\r\n             recursiveFindChild (i, result, bTypeTree,lastCall, type)\r\n             {      \r\n                 //last change \r\n                 if(i >= result.length)\r\n                 {\r\n                     lastCall(bTypeTree);\r\n                     return bTypeTree;\r\n                 }\r\n                 else {\r\n                     bTypeTree.push(result[i]);\r\n                     if (type === \"relation\")\r\n                     {\r\n                        this.findBTypeRelation(result[i],bTypeTree, final => {\r\n                            i++;\r\n                            this.recursiveFindChild(i++, result, bTypeTree,lastCall, \"relation\");    \r\n                        });\r\n                     }\r\n                     else\r\n                     {\r\n                        this.findBTypeChild(result[i],bTypeTree,  final => {\r\n                            i++;\r\n                            this.recursiveFindChild(i++, result, bTypeTree,lastCall, type);    \r\n                        });\r\n                     }\r\n\r\n                 }\r\n    \r\n             }\r\n\r\n             sparqlQuery (sparql, callback)  {\r\n                const puroXML = new XMLSerializer().serializeToString(this.puroXML);\r\n               \r\n                const store = this.rdf.graph();\r\n                const contentType = 'application/rdf+xml';\r\n                const baseUrl = \"http://lod2-dev.vse.cz/\";\r\n                \r\n                this.rdf.parse(puroXML, store, baseUrl, contentType); \r\n        \r\n                var turtle;\r\n                 this.rdf.serialize(undefined, store, \"http://www.w3sds.org/1999/02/22-rdf-syntax-ns#type\", 'text/turtle', function(err, str){\r\n                    turtle = str;\r\n                })\r\n        \r\n                const rdfstore = require('rdfstore');\r\n                rdfstore.create( function(err, store) {\r\n                     store.load(\"text/turtle\", turtle, function(err, results) {\r\n                        store.execute(sparql,\r\n                          function(err, results) {\r\n                          callback(results);\r\n                            \r\n                        });\r\n                    });\r\n                });\r\n                 \r\n            }; \r\n\r\n\r\n     \r\n            //from nebo to poslat si ukazatel? \r\n            getRelationBTypes (relationUri) \r\n            {\r\n                \r\n                var query = `\r\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                 SELECT  ?uri ?type ?label  WHERE \r\n                 {\r\n                     {<`+relationUri+`> puro:instanceOf ?uri}\r\n                     UNION\r\n                     {<`+relationUri+`> puro:subTypeOf ?uri}\r\n                     ?uri a ?type .\r\n                     ?uri rdfs:label ?label\r\n                 }`; \r\n\r\n                 return new Promise(resolve => {\r\n                    // instance může mít mnohem více dětí!!!! zaměř se na to a dej si na to pozor!!!\r\n                    this.sparqlQuery(query, (result) => {\r\n                        \r\n                        // result.push({uri: {token:\"uri\", value: relationUri}});\r\n                \r\n                        this.recursiveFindChild(0,result,[], function lastCall(lastResult){\r\n                               resolve(lastResult);\r\n                       },\"relation\");\r\n                   });\r\n                });\r\n\r\n\r\n            }\r\n\r\n            //začátek hlavního\r\n            getRelations  () \r\n            {\r\n                // ještě by to chtělo sjednotit do pole \r\n                var query = `\r\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                SELECT ?uri ?valuation ?from ?to ?toType ?fromType ?label ?type  WHERE \r\n                {\r\n                  ?uri a puro:BRelation . \r\n                  ?from puro:linkedTo ?uri .\r\n                  ?uri puro:linkedTo ?to .\r\n                  ?uri rdfs:label ?label . \r\n                  ?uri a ?type .\r\n                  OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\r\n                  {?from a puro:BObject}\r\n                  UNION \r\n                  {?from a puro:BType}\r\n                  {?to a puro:BObject}\r\n                  UNION\r\n                  {?to a puro:BType} \r\n                  ?to a ?toType . \r\n                  ?from a ?fromType . \r\n                }`;\r\n                \r\n                return new Promise(resolve => {\r\n                    this.sparqlQuery(query, function callback(result) {\r\n                        result = this.deleteDuplicity(result,[ \"from\", \"to\", \"toType\", \"fromType\", \"valuation\"]);\r\n                        console.log(result)\r\n                        resolve(result);\r\n                    }.bind(this));\r\n                  }); \r\n            }\r\n\r\n            findRelation  (elementUri) {\r\n                var query = `\r\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                SELECT ?uri ?label  WHERE \r\n                {\r\n                  <`+elementUri+`> puro:linkedTo ?uri . \r\n                }`;\r\n                \r\n                return new Promise(resolve => {\r\n                    this.sparqlQuery(query, function callback(result) {\r\n                        resolve(result);\r\n                    });\r\n                  }); \r\n\r\n            }\r\n\r\n            async firstFind  ()  {\r\n                var query = `\r\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\r\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\r\n                SELECT ?uri ?label ?child WHERE \r\n                {\r\n                    {?child puro:instanceOf ?uri}\r\n                     UNION\r\n                    {?child puro:subTypeOf ?uri}\r\n                    ?uri rdfs:label ?label. asfadf\r\n                    ?uri a puro:BType\r\n                    FILTER NOT EXISTS {?uri puro:linkedTo ?obj}\r\n                    FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\r\n                }`;\r\n                \r\n                return new Promise(resolve => {\r\n                    this.sparqlQuery(query, function callback(result) {\r\n                        resolve(result);\r\n                    });\r\n                  });       \r\n            }\r\n\r\n            //result[index].connect\r\n            deleteDuplicity  (result, properties) {\r\n                var duplicity;\r\n                var checkArr = []; \r\n                \r\n                // sjednocení datových typů na pole\r\n                for (var res of result)\r\n                {\r\n                    for (let property of properties)\r\n                    {               \r\n                        if (res[property] === null)\r\n                        {\r\n                            res[property] = [];    \r\n                        }\r\n                        else\r\n                        {\r\n                            res[property] = [res[property].value]; \r\n                        }        \r\n                    }\r\n                }\r\n\r\n                for (let index = result.length -1; index >= 0; index --) {\r\n                    \r\n                    if (checkArr.includes(result[index].uri.value))\r\n                    {\r\n                            for (let property of properties)\r\n                            {\r\n                                for (let k = result.length -1; k >= 0; k --) {\r\n                                duplicity = result[index][property];    \r\n                                if(result[k].uri.value === result[index].uri.value){     \r\n                                    \r\n                                    if (!duplicity.some(e => result[k][property].includes(e)))\r\n                                    {                                    \r\n                                        result[k][property] = result[k][property].concat(duplicity); \r\n                                        break;\r\n                                    }\r\n                                    else{\r\n                                        if(property.includes(\"Type\"))\r\n                                        {\r\n                                            if (result[k][property.split(\"Type\")[0]].length !== result[k][property].length) {\r\n                                                result[k][property] = result[k][property].concat(duplicity); \r\n                                                break; \r\n                                            }\r\n                                        }\r\n                                    }     \r\n                                }   \r\n                            }\r\n                        }\r\n                        \r\n                        result.splice(index, 1);\r\n                    }\r\n                    else\r\n                    {\r\n                        checkArr.push(result[index].uri.value);\r\n                    } \r\n                }\r\n\r\n                return result; \r\n\r\n            }\r\n\r\n\r\n}","import MainController from \"./MainController\";\r\n\r\nexport default class OntoModelController extends MainController {\r\n\r\n\r\n    constructor ()\r\n    {\r\n        super();\r\n        this.ontoModel  = []; \r\n    } \r\n  \r\n    \r\n    addToOntoModel = (uri, label, ontoType, puroType, relationName, direction, elName, nameWasChange, ontoUri, branchIndex, origUri) => \r\n    {\r\n    \r\n        if (this.getOntoElement(this.ontoUri + elName) === false)\r\n        {\r\n            let elPuroType;\r\n            let elLabel;\r\n            let elUri; \r\n            nameWasChange = nameWasChange === undefined ? false : nameWasChange;\r\n            origUri = origUri === undefined ? \"\" : origUri;\r\n            if (elName !==  \"\" && elName !== undefined && nameWasChange === false) \r\n            {\r\n\r\n                elPuroType = false;\r\n                elLabel = elName;\r\n                elUri = this.ontoUri + elName; \r\n\r\n            }\r\n            else\r\n            {\r\n                elPuroType = puroType;\r\n                elLabel = nameWasChange ? elName : label; \r\n                elUri = uri; \r\n            }\r\n\r\n            if (this.getOntoElement(elUri) === false)\r\n            {\r\n                this.ontoModel.push({uri: elUri, label:elLabel, ontoType: ontoType, puroType: elPuroType, fromRelation: [relationName], direction: [direction], from: [undefined], to:[undefined],type:\"Class\", branchIndex: [branchIndex], origUri:origUri});\r\n            }    \r\n        }\r\n        else\r\n        {\r\n            uri = ontoUri + elName; \r\n            this.updateOntoModel(uri, \"fromRelation\",relationName);\r\n            this.updateOntoModel(uri, \"direction\",direction);\r\n            this.updateOntoModel(uri, \"branchIndex\",branchIndex);\r\n        }\r\n        console.log(this.ontoModel)\r\n        return this.ontoModel; \r\n    }\r\n\r\n    isRelationComplete (relation)\r\n    {\r\n        if (relation.type === \"relation\" && relation.from.length > 0 && relation.to.length > 0)\r\n        {\r\n            return true;\r\n        }\r\n        return false; \r\n    }\r\n    \r\n    getCardinalElement (element, superType)\r\n    {\r\n\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.type === \"relation\" && node.ontoType.toLowerCase() === \"generalization\" && node.from[0] === element && superType === false)\r\n            {\r\n                return node.to[0]; \r\n            }\r\n            else if (node.type === \"relation\" && node.ontoType.toLowerCase() === \"generalization\" && node.to[0] === element && superType === true)\r\n            {\r\n                return node.from[0];\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    getElementByProperty (property, value)\r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node[property] === value)\r\n            {\r\n                return node; \r\n            }\r\n        }\r\n\r\n        return false; \r\n    }\r\n\r\n\r\n    getReletadELement (element, relationName)\r\n    {\r\n        \r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.type === \"relation\" && (node.from.includes(element.uri) || node.to.includes(element.uri)) && this.isRelationComplete(node))\r\n            {\r\n                let relatedElement; \r\n                if (node.from.includes(element.uri)) \r\n                {\r\n                    relatedElement = node.to[0];\r\n                }\r\n                else\r\n                {\r\n                    relatedElement = node.from[0];\r\n                } \r\n                relatedElement = this.getOntoElement(relatedElement);\r\n                if (relatedElement.fromRelation.includes(relationName))\r\n                {\r\n                    return relatedElement; \r\n                }\r\n            }\r\n        }\r\n\r\n        return false; \r\n    }\r\n\r\n\r\n    addRelation = (type, from, to, uri,label, fromType, toType) => \r\n    {\r\n        //fromT toT\r\n        uri = uri === undefined ? this.ontoUri.slice(0,-1) + \"/relation/\"+type+\"/\"+this.delUri(from)+this.delUri(to) : uri; \r\n        fromType = fromType === undefined ? [] : [fromType];\r\n        toType = toType === undefined ? [] : [toType]; \r\n        from = from === undefined || \"\" || from.length === 0 ? [] : [from];\r\n        to = to === undefined || \"\" || to.length === 0 ? [] : [to];\r\n        \r\n        for (let el of this.ontoModel)\r\n        {\r\n            if (el.type === \"relation\" && el.from.includes(from) && el.to.includes(to))\r\n            {\r\n                return this.ontoModel;\r\n            }\r\n        }\r\n\r\n\r\n        this.ontoModel.push({type:\"relation\",ontoType: type, from: from, to: to,uri:uri, label:label, fromType: fromType, toType: toType, fromRelation: []});\r\n        \r\n        return this.ontoModel; \r\n    }\r\n\r\n    updateOntoModel = (elementsUri, property, value, duplicity = true) =>\r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.uri === elementsUri) {\r\n                if (Array.isArray(node[property]))\r\n                {\r\n                    if (duplicity === true || !node[property].includes(value))\r\n                    {\r\n                        node[property].push(value);\r\n                    }\r\n                    \r\n                }\r\n                else\r\n                {\r\n                    if (duplicity === true || node[property] !== value)\r\n                    {\r\n                        node[property] = value;\r\n                    } \r\n                }\r\n                return this.ontoModel;\r\n            }\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    addToProperty (uri, property, value)\r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.uri === uri)\r\n            {\r\n                 \r\n                if (Array.isArray(node[property]))\r\n                {\r\n                    node[property].push(value); \r\n                    return true; \r\n                }\r\n            }\r\n        }\r\n        return false; \r\n    }\r\n\r\n    getOntoModel = () =>\r\n    {\r\n        return this.ontoModel; \r\n    }\r\n    \r\n    getElementsRelation = (uri, direction) =>\r\n    {\r\n        \r\n       \r\n        let returnArr = []; \r\n        \r\n        for (let node of this.ontoModel)\r\n        {\r\n            let nextRel = false;\r\n            let nextOther = false;\r\n            if (Array.isArray(node[direction]))\r\n            {\r\n                nextRel = node[direction].includes(uri) ? true : false; \r\n            }\r\n\r\n        \r\n            if (node[\"type\"] === \"relation\" && nextRel === true)\r\n            {\r\n                returnArr.push(node);\r\n            }\r\n            else if(direction === \"connect\" &&  (node[\"from\"].includes(uri) || node[\"to\"].includes(uri)))\r\n            {\r\n                returnArr.push(node) ;\r\n            }\r\n        }\r\n        \r\n        return returnArr; \r\n    }\r\n\r\n\r\n\r\n    getElementOntoType = (uri) => \r\n    {\r\n        \r\n        let element = this.getOntoElement(uri);\r\n\r\n        if (element === false)\r\n        {\r\n            return false;\r\n        }\r\n        else\r\n        {\r\n            return element.ontoType; \r\n        }\r\n\r\n    }\r\n\r\n    getElementsByOntoType = (type, origin) => \r\n    {\r\n       let result = [];\r\n\r\n       for (let node of this.ontoModel)\r\n       {\r\n            if (type === node.ontoType && (origin === undefined || node.fromRelation.includes(origin)))\r\n            {  \r\n                result.push(node.uri);\r\n            }\r\n       }\r\n       return result; \r\n\r\n    }\r\n\r\n    getOntoElement = (uri) => \r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.uri === uri) \r\n            {\r\n                return node; \r\n        \r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    changeOrigin = (uri, origin) => \r\n    {\r\n       for (let i = 0; i < this.ontoModel.length; i++)   \r\n       {\r\n         if (this.ontoModel[i].uri === uri) {\r\n             this.ontoModel[i].origin = origin; \r\n             return true;\r\n         }\r\n       }\r\n       return false; \r\n    }\r\n\r\n    \r\n\r\n    getLastElementUri = (origin, direction) => \r\n    {\r\n        var uri; \r\n        for (let i = this.ontoModel.length - 1; i >= 0; i--) \r\n        {\r\n\r\n            for (let j = 0; j < this.ontoModel[i].fromRelation.length; j++) {\r\n               \r\n                if (this.ontoModel[i].fromRelation[j] === origin && this.ontoModel[i].direction[j] === direction && this.ontoModel[i].ontoType !== \"Datatype\")\r\n                {\r\n                    uri = this.ontoModel[i].uri;\r\n                    return uri;\r\n                }\r\n                else if (this.ontoModel[i].fromRelation[j] === origin && direction === undefined)\r\n                {\r\n                    uri = this.ontoModel[i].uri;\r\n                    return uri; \r\n                }\r\n                else if(origin === undefined && direction === undefined)\r\n                {\r\n                    return this.ontoModel[i].uri;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false; \r\n    }\r\n\r\n    getElementInRelRow (lastElUri)\r\n    {\r\n        const relElements = this.getElementInRelation(lastElUri,\"*\",\"from\",false); \r\n        if (relElements.length === 0)\r\n        {\r\n            return lastElUri;\r\n        }\r\n        \r\n        const fatherChildren = this.getElementInRelation(relElements[0].element.uri,\"*\",\"to\",this.getOntoElement(lastElUri).ontoType); \r\n        console.log(fatherChildren)\r\n        console.log(fatherChildren[0].element.uri)\r\n        return fatherChildren[0].element.uri; \r\n\r\n    }\r\n\r\n    getLastElement = (origin, direction) =>\r\n    {\r\n        const uri = this.getLastElementUri(origin, direction);\r\n        return this.getOntoElement(uri); \r\n    }\r\n\r\n    getFatherOntoType = (element) => \r\n    {\r\n\r\n        let result = []; \r\n        if ('father' in element)\r\n        {\r\n            for (let node of this.ontoModel)\r\n            {\r\n                if(element.father.includes(node.uri))\r\n                {\r\n                    result.push(node.ontoType);\r\n                }\r\n            }\r\n        }\r\n\r\n        if(result.length === 0)\r\n        {\r\n            result = [\"\"];\r\n        }\r\n        return result;\r\n    }\r\n\r\n    getRelationElements = (elName, element, selectedUri, relationUri, addRulesLenght, lastEl, puroType, ontoUri, ruleKey, nameWasChange, moreBranches) => \r\n    {\r\n        const ontoEl = this.getOntoElement(selectedUri);\r\n        if (elName !== \"\" && puroType !== \"dataType\" && nameWasChange === false && (element !== false || ontoEl !== false))\r\n        {\r\n           \r\n            let father;\r\n            let passEl; \r\n            \r\n            if (puroType === \"superType\")\r\n            {\r\n                father = this.ontoUri + elName;\r\n                passEl = ontoEl !== false ? ontoEl.uri : element.uri.value; \r\n            }\r\n            else if (puroType === \"subType\")\r\n            {\r\n                passEl = this.ontoUri + elName;    \r\n                father = ontoEl !== false ? ontoEl.uri : element.uri.value; \r\n            }\r\n            else\r\n            {\r\n                if (element !== false)\r\n                {\r\n                    father = element.father[0] === undefined ? element.uri.value : element.father[0];\r\n                }\r\n                else\r\n                {\r\n                    father = ontoEl.uri;\r\n                }\r\n                passEl = this.ontoUri + elName; \r\n            }\r\n            return [father, passEl];\r\n\r\n        }\r\n        else if (relationUri === null)\r\n        {\r\n            if (element.father.length > 0)\r\n            {\r\n\r\n                return [element.father[0], element.uri.value];\r\n            }\r\n            else return false; \r\n            \r\n        }\r\n        else if (puroType.includes(\"elementSelection\") || (element !== false && this.getOntoElement(element.father[0]) !== false))\r\n        {   \r\n      \r\n            let elementFather = this.getOntoElement(element.father[0]);\r\n            if (puroType.includes(\"invert\") || !puroType.includes(\"elementSelection\"))\r\n            {\r\n                return [element.uri.value, elementFather.uri];\r\n            }\r\n            else\r\n            {\r\n                return [elementFather.uri,element.uri.value];\r\n            \r\n            }\r\n        }\r\n        else if((addRulesLenght === 0 && lastEl === true) || element === false )\r\n        {\r\n            //koko\r\n            let lastRelElement = this.getLastElement(relationUri);\r\n            lastRelElement = this.getOntoElement(this.getElementInRelRow(lastRelElement.uri))\r\n          \r\n            const passEl = (element === false) ? this.ontoUri + elName : selectedUri;\r\n\r\n            let lastElUri = this.getLastElementUri(relationUri,ruleKey);\r\n            lastElUri = this.getElementInRelRow(lastElUri); \r\n    \r\n            if (lastRelElement !== false && (lastRelElement.direction[lastRelElement.direction.length - 1] !== ruleKey || moreBranches === true) && addRulesLenght === 0)\r\n            {\r\n                if (!this.isRelationExist(lastElUri,passEl) &&  this.getOntoBranch(relationUri, ruleKey).length > 1)\r\n                {\r\n                    return [lastElUri, passEl];\r\n                }\r\n    \r\n                this.updateOntoModel(relationUri,ruleKey,passEl, false);\r\n                \r\n                return relationUri; \r\n            }\r\n            else if (element === false || lastRelElement !== false)\r\n            {\r\n                return [lastRelElement.uri, passEl];\r\n            }\r\n            \r\n        }  \r\n     \r\n    }\r\n\r\n    checkDuplicity (label) \r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.label === label) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true; \r\n    }\r\n\r\n    getRelatedTypes (elUri, direction, ontoType) \r\n    {\r\n        let rels = this.getElementsRelation(elUri, direction);\r\n        let elements = [];\r\n        let types = []; \r\n        for (let rel of rels)\r\n        {\r\n          //Arrow \r\n          \r\n          if (rel.ontoType === ontoType || (ontoType === \"Generalization\" && rel.ontoType.includes(\"memberOf\")))\r\n          {\r\n              const el = (rel.to.includes(elUri)) ? rel.from[rel.to.indexOf(elUri)] : rel.to[rel.from.indexOf(elUri)];\r\n              elements.push(el);\r\n              types.push(this.getElementOntoType(el));\r\n          }\r\n          else if (ontoType === false && rel.ontoType === \"Relator\")\r\n          {\r\n            types.push(rel.ontoType); \r\n          }\r\n          else if (ontoType === false)\r\n          {\r\n            const el = (rel.to.includes(elUri)) ? rel.from[rel.to.indexOf(elUri)] : rel.to[rel.from.indexOf(elUri)];\r\n            elements.push(el);\r\n            types.push(this.getElementOntoType(el)); \r\n          }\r\n        }  \r\n\r\n        return types; \r\n    }\r\n\r\n    getElementsFromBranch(element)\r\n    {\r\n\r\n        let returnArr = [element];\r\n        let el = element;\r\n    \r\n        while (this.getCardinalElement(el,true) !== false)\r\n        {   \r\n            el = this.getCardinalElement(el, true);\r\n            returnArr.push(el);\r\n        }\r\n\r\n        return returnArr; \r\n    }\r\n\r\n    getElementInRelation(elementUri, relationType, direction, ontoType)\r\n    {\r\n        let returnArr = [];\r\n        const all = relationType === \"*\" ? true : false; \r\n        ontoType = ontoType === undefined || false ? false : ontoType; \r\n\r\n        for (let relation of this.ontoModel)\r\n        {\r\n     \r\n            if (relation.type === \"relation\" && (relation.ontoType === relationType || all) && relation[this.getOpositeDirection(direction)].includes(elementUri))\r\n            {   \r\n                let el = this.getOntoElement(relation[direction][0]);\r\n         \r\n                if (ontoType === false || ontoType === el.ontoType)\r\n                {\r\n                    returnArr.push({element : el, relationType: relation.ontoType}); \r\n                } \r\n            }\r\n        }\r\n        return returnArr; \r\n    }\r\n\r\n    isRelationExist(el1, el2)\r\n    {\r\n        for (let el of this.ontoModel)\r\n        {\r\n            if (el.type === \"relation\" && (el.from === el1 && el.to === el2) || (el.from === el2 && el.to === el1))\r\n            {\r\n                return true;\r\n            }\r\n        }\r\n        return false; \r\n    }\r\n    getOntoBranch(relation, key)\r\n    {\r\n        let returnArr = [];\r\n        for (let el of this.ontoModel)\r\n        {\r\n            for (let index in el.fromRelation)\r\n            {\r\n                if (el.fromRelation[index] === relation && el.direction[index] === key)\r\n                {\r\n                    returnArr.push(el);\r\n                }\r\n            }\r\n        }\r\n        \r\n        return returnArr; \r\n    }\r\n    \r\n    connectToBranchElement(relation, key, selectedEl)\r\n    {\r\n\r\n        const question =  \"To which element is the \" + this.delUri(selectedEl.uri.value) + \" connected?\";\r\n\r\n        const firstEl = (this.getOntoBranch(relation, key)[0]);\r\n        const lastEl = this.getLastElement(relation, key);\r\n\r\n        if (firstEl === undefined || lastEl === false)\r\n        {\r\n            return false\r\n        }\r\n        else\r\n        {\r\n            \r\n            return this.createButtons([firstEl.label, lastEl.label],question, \"nextBranchElements\", false, \"\");\r\n        }\r\n\r\n        if (firstEl.uri === lastEl.uri)\r\n        {\r\n            return false;\r\n        }\r\n        else\r\n        {\r\n           \r\n        }\r\n\r\n    }\r\n\r\n\r\n\r\n    undo (ontoModelHistory)\r\n    {\r\n        \r\n        this.ontoModel =  JSON.parse(JSON.stringify(ontoModelHistory));  \r\n   \r\n    }\r\n\r\n\r\n\r\n\r\n}\r\n\r\n","import MainController from \"./MainController\";\r\n\r\nexport default class ImagController extends MainController {\r\n\r\n    constructor()\r\n    {\r\n        super();\r\n        this.ontoModel = [];\r\n    }\r\n\r\n    createGraph  (ontoModel) \r\n    {\r\n        this.ontoModel = ontoModel;\r\n        let graphCommand = \"classDiagram\\n\"; \r\n\r\n\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node[\"type\"] === \"relation\" && this.findLabel(node.to[0]) !== false && this.findLabel(node.from[0]) !== false) {\r\n                if (node.ontoType === \"Relator\")\r\n                {\r\n                    if (node.from.length > 0 && node.to.length > 0) \r\n                    {\r\n                    \r\n                        graphCommand += 'class '+ node.label + `{\r\n                                <<`+ node.ontoType + `>>\r\n                        }\\n`;   \r\n                        \r\n                        for (let key in node.from)\r\n                        {\r\n                            graphCommand += this.findLabel(node.from[key]) +\" \"+ (node.fromType[key] ? '\"'+node.fromType[key][0]+'\"' : \"\") +\" .. \"+ (node.toType[key] ? '\"'+node.fromType[key][1]+'\"' : \"\") + \" \" + node.label +  \" : <<Mediation>>\\n\";\r\n                        }\r\n\r\n                      //  graphCommand += this.findLabel(node.from) +\" \"+ (fromT ? '\"'+fromT[0]+'\"' : \"\") +\" .. \"+ (toT ? '\"'+fromT[1]+'\"' : \"\") + \" \" + node.label +  \" : <<Mediation>>\\n\"; \r\n                        \r\n                        for (let key in node.to)\r\n                        {\r\n                            graphCommand += node.label +\" \"+ (node.toType[key] ? '\"'+node.toType[key][0]+'\"' : \"\") +\" .. \"+ (node.toType[key]  ? '\"'+node.toType[key][1]+'\"' : \"\") + \" \" + this.findLabel(node.to[key]) + \" : <<Mediation>>\\n\"; \r\n                        }\r\n                      \r\n                    }\r\n                }\r\n                else\r\n                {\r\n                    \r\n                    const relationSpec = this.getRelationSpec(node.ontoType);\r\n                    if (node.from.length === node.to.length)\r\n                    {\r\n                        for (let key in node.from)\r\n                        {\r\n                            graphCommand += this.findLabel(node.from[key]) +\" \"+ (node.fromType[key] ? '\"'+node.fromType[key]+'\"' : \"\") + relationSpec[0] + (node.toType[key] ? '\"'+node.toType[key]+'\"' : \"\") + \" \" + this.findLabel(node.to[key]) + (relationSpec[1] === true ? \" : <<\"+node.ontoType.split('-')[0]+\">>\" : \"\" ) + \"\\n\"; \r\n                        }\r\n                    }\r\n                    else\r\n                    {\r\n                        for (let key in node.from)\r\n                        {\r\n                            let base = this.findLabel(node.from[key]) +\" \"+ (node.fromType[key] ? '\"'+node.fromType[key]+'\"' : \"\") + relationSpec[0];\r\n                            \r\n                            for (let toKey in node.to)\r\n                            {\r\n                                graphCommand += base + (node.toType[toKey] ? '\"'+node.toType[toKey]+'\"' : \"\") + \" \" + this.findLabel(node.to[toKey]) + (relationSpec[1] === true ? \" : <<\"+node.ontoType.split('-')[0]+\">>\" : \"\" ) + \"\\n\"; \r\n                            }\r\n                        }\r\n                    }   \r\n                }\r\n\r\n            }\r\n            else if (node[\"type\"] !== \"relation\")\r\n            {\r\n              \r\n                graphCommand += 'class '+ node.label + `{\r\n                    <<`+ node.ontoType + `>>\r\n                }\\n`;   \r\n            }\r\n        }\r\n        return graphCommand = (graphCommand.trim() === \"classDiagram\") ? false : graphCommand; \r\n    }\r\n    \r\n    getRelationSpec (ontoType)\r\n    {\r\n        for(let rel of this.rulesJson.relations)\r\n        {\r\n            \r\n            if (ontoType in rel)\r\n            {\r\n                \r\n                const normRelType = rel[ontoType]; \r\n                const showType = \"showType\" in rel && rel[\"showType\"] === true ? true : false;  \r\n                let code; \r\n                switch(normRelType.toLowerCase())\r\n                {\r\n                    case \"arrowline\": code = \" <|-- \";  \r\n                        break; \r\n                    case \"simpleline\": code = \" -- \"; \r\n                        break; \r\n                    case \"dashedline\": code = \" .. \"; \r\n                        break; \r\n                    case \"composition\": code = \" *-- \"; \r\n                        break; \r\n                    case \"aggregation\": code = \" o-- \"; \r\n                        break; \r\n                    default:  code = \" -- \"; \r\n                }\r\n            \r\n                return [code, showType]; \r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    findLabel (uri)\r\n    {\r\n        for (let node of this.ontoModel)\r\n        {\r\n            if (node.uri === uri)\r\n            {\r\n                return node.label;\r\n            }\r\n        }\r\n\r\n        return false;\r\n\r\n    }\r\n\r\n}","import MainController from \"./MainController\";\r\n\r\nexport default class RuleController extends MainController {\r\n    \r\n\r\n    //ruleSelection queryTree, \r\n    ruleSelection = (rules, key, element, previousElName, rule, queryTree, relationLabel) => \r\n    {\r\n        \r\n        let commands; \r\n        let additionalRules;\r\n        let offerTypes;\r\n        let uri;\r\n        let question;\r\n        let needElName;\r\n        let elName = \"\";\r\n        \r\n        if (rule)\r\n        {\r\n            offerTypes = rule; \r\n        }\r\n        else\r\n        {\r\n            commands = this.getSpecificRule(rules,key);\r\n            //additionalRules = this.getAdditionalRule(commands,ontoType);\r\n            //offerTypes = (additionalRules.length > 0 ) ? offerTypes = additionalRules : offerTypes = commands.offer;\r\n            offerTypes = commands.offer   \r\n        }\r\n\r\n        //z elementu udělat otázku\r\n        if (element !== false)\r\n        {\r\n            let additionalQuestion = \"\";\r\n            \r\n            if (element.connect.length > 1)\r\n            { \r\n                additionalQuestion = \"\\n \" + this.getQuestion(relationLabel, \"relSpecific\");\r\n            }\r\n            \r\n            if (this.isElementInstace(element,queryTree))\r\n            {\r\n                needElName =true;\r\n                uri = element.uri.value;\r\n\r\n\r\n\r\n                question = this.rulesJson.questions[1].question.replace(\"VAL\",element.label.value) + additionalQuestion;\r\n            }\r\n            else\r\n            {\r\n                needElName = false;\r\n                uri = element.uri.value;\r\n                question = this.rulesJson.questions[0].question.replace(\"VAL\",element.label.value) + additionalQuestion;\r\n                elName = element.label.value; \r\n            }\r\n        }\r\n        else\r\n        {\r\n            //zjisti zda je chyby nebno ne \r\n            needElName = true;\r\n\r\n            //Třeba dodělat Replace!!\r\n\r\n            for (let q of this.rulesJson.questions)\r\n            {\r\n                if (q.type === \"bTypeChild\")\r\n                {\r\n                    question = q.question.replace(\"VAL\", previousElName);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n       \r\n        return this.createButtons(offerTypes,question, \"classSelection\",needElName,elName);\r\n    }\r\n\r\n    isElementInstace = (element, queryTree) =>\r\n    {\r\n        for (let node of queryTree)\r\n        {\r\n           \r\n            if (element.uri.value === node.uri.value  )\r\n            {\r\n                for (let type of node.fatherTypeRelation)\r\n                {\r\n                    if (this.delUri(type) === \"instanceOf\")\r\n                    {\r\n                        return true; \r\n                    }\r\n                }\r\n            \r\n            }\r\n        }\r\n        return false; \r\n    } \r\n\r\n    moreThanOneRule (ontoController, element,minCount,maxCount, check)\r\n    {\r\n        const elInRelation = ontoController.getElementInRelation(element.uri,\"*\",\"from\",false)[0]; \r\n        const childrenCount = ontoController.getElementInRelation(elInRelation.element.uri,elInRelation.relationType,\"to\", element.ontoType).length;\r\n        if (childrenCount < maxCount)\r\n        {\r\n            const types = childrenCount < minCount ? [element.ontoType] : [element.ontoType, \"None\"]\r\n            check.push({key: \"subType\", types: types, element: elInRelation.element.uri, rule:{type:[element.ontoType],question:this.getQuestion(elInRelation.element,\"moreThanOne\")}}); \r\n        }\r\n\r\n        return check; \r\n\r\n    }\r\n\r\n    // this.ontoController.getOntoElement(this.relation.uri.value);\r\n    elementConsistencyRules = (element,  ontoController) => \r\n    {\r\n            // v případě undefinied vyhoď, že pravidlo není definováno \r\n            let rules = this.rulesJson[element.ontoType];    \r\n            let check = []; \r\n        \r\n       \r\n\r\n            //Tady by měla být pole jelikož to může být 1:N \r\n            // !!! Převod na metodu a úprava dle pravidel\r\n            // udělat connect -> subtype -> supertype jenom v případě arrow \r\n\r\n            let elTypes = {\r\n                superType: ontoController.getRelatedTypes(element.uri,\"to\", \"Generalization\"), \r\n                subType: ontoController.getRelatedTypes(element.uri,\"from\",\"Generalization\"), \r\n                connect: ontoController.getRelatedTypes(element.uri, \"connect\", false)\r\n            };\r\n\r\n            console.log (elTypes.connect)\r\n            \r\n            for (let rule of rules)\r\n            {\r\n             \r\n                check = this.elementConsistencySelection(rule,elTypes.connect,\"connect\",element,check,rules,elTypes, ontoController);\r\n                check = this.elementConsistencySelection(rule,elTypes.superType,\"superType\",element,check,rules,elTypes,ontoController);\r\n                check = this.elementConsistencySelection(rule,elTypes.subType,\"subType\",element,check,rules,elTypes, ontoController);\r\n                if (rule.key === \"moreThanOne\")\r\n                {\r\n                    check = this.moreThanOneRule(ontoController,element,rule.minCount,rule.maxCount,check);\r\n                }\r\n            }\r\n\r\n            //Kontrola none a spojených typů!! \r\n\r\n            if ((check.length > 0 && check[0].types.includes(\"Relator\") && check[0].types.includes(\"None\")))\r\n            {\r\n                check.splice(0, 1);  \r\n            }\r\n\r\n            for (let i = 0; i < check.length; i++) {\r\n                check[i][\"elLabel\"] =  ontoController.getOntoElement(check[i].element).label;  \r\n            }\r\n\r\n\r\n\r\n            return check;\r\n    }\r\n\r\n\r\n\r\n    elementConsistencySelection = (rule,elTypes,key,element,check,rules,allTypes, ontoController) =>\r\n    {\r\n        if(rule.key === key)\r\n        {\r\n                \r\n                const suffix = key[key.length - 1] === \"e\" ? \"d\" : \"ed\";\r\n                const additionalRules =  this.getSpecificRule(rules, key + suffix, true);\r\n                if (!rule.type.some(r=> elTypes.includes(r)) && rule.type.length > 0 )\r\n                {\r\n                    // if includes none -> zkontrolovat lenght superType -> zeptat se jestli chci doplnit superType -> nabídnout co je v tabulce -> zkontrolovat jestli už není\r\n                    check.push({key: key, types: rule.type, element:element.uri, rule:rule});\r\n\r\n                }\r\n                else \r\n                {\r\n                    if (additionalRules !== false)\r\n                    {\r\n                      \r\n                        for (let addRule of additionalRules)\r\n                        {\r\n                            console.log(JSON.parse(JSON.stringify(addRule)))\r\n                            if (addRule.type.some(r=> elTypes.includes(r))) {\r\n                                check = this.elementConsAddSelection(\"superType\",addRule,elTypes,check,element,allTypes);\r\n                                check = this.elementConsAddSelection(\"subType\",addRule,elTypes,check,element,allTypes);\r\n                                check = this.elementConsAddSelection(\"connect\",addRule,elTypes,check,element,allTypes);\r\n                                if (\"moreThanOne\" in addRule && addRule[\"moreThanOne\"] === true && elTypes.length < 2)\r\n                                {\r\n                                    check = this.moreThanOneRule(ontoController,element,addRule.mincCountount,addRule.maxCount,check);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n        }\r\n        return check; \r\n    }\r\n    \r\n    elementConsAddSelection (type, rule, elTypes, check, element, allTypes)\r\n    {\r\n    \r\n        if (type in rule)\r\n        {\r\n      \r\n            if (!rule[type].some(r=> allTypes[type].includes(r)) && rule[type].length > 0 )\r\n            {\r\n                \r\n                for (let index in check)\r\n                {\r\n                  \r\n                    if (check[index].key === type && check[index].element === element.uri)\r\n                    {\r\n                        check.splice(index, 1);\r\n                    }\r\n                }\r\n                check.push({key: type, types: rule[type], element:element.uri, rule:rule});\r\n            }\r\n            else if (\"moreThanOne\" in rule && rule[\"moreThanOne\"] === true)\r\n            {\r\n                //vrat element dej fathera \r\n            }\r\n\r\n        }\r\n    \r\n        return check; \r\n       \r\n    }\r\n\r\n    numberOfRuleStep (relationType, key, bTypeNumber)\r\n    {\r\n        const rule = this.getSpecificRule(this.rulesJson[relationType], key, false, bTypeNumber);\r\n        let indexCount = 0; \r\n\r\n        for (let key in rule)\r\n        {\r\n            if (!isNaN(key))\r\n            {\r\n                indexCount ++; \r\n            }\r\n        }\r\n\r\n        return indexCount; \r\n    }\r\n\r\n    getSpecificRule = (rules, key, moreThanOne, bTypeNumber) =>\r\n    {\r\n        let addRules = [];\r\n        \r\n        bTypeNumber = bTypeNumber === undefined ? false : bTypeNumber; \r\n        moreThanOne = moreThanOne === undefined ? false : moreThanOne; \r\n        \r\n        if (bTypeNumber !== false)\r\n        {\r\n            for (let node of rules)\r\n            {\r\n                if (node.key === key &&  (\"bTypeNumber\" in node) && node.bTypeNumber.includes(bTypeNumber))\r\n                {\r\n                    if (moreThanOne === true)\r\n                    {\r\n                        addRules.push(node);\r\n                    }\r\n                    else\r\n                    {   \r\n                        return node; \r\n                    }   \r\n                }\r\n            }\r\n\r\n       \r\n        }\r\n            for (let node of rules)\r\n            {\r\n                \r\n                if (node.key === key)\r\n                {\r\n                    if (moreThanOne === true)\r\n                    {\r\n                        addRules.push(node);\r\n                    }\r\n                    else\r\n                    {   \r\n                        return node; \r\n                    }   \r\n                }\r\n            }\r\n        \r\n\r\n\r\n        // Tady možná hvězda \r\n        if (addRules.length > 0)\r\n        {\r\n            return rules;\r\n        }\r\n        else\r\n        {\r\n            return false; \r\n        }     \r\n    }\r\n\r\n\r\n\r\n    getAdditionalRule = (rule, selectedType, index) =>\r\n    {\r\n        /*\r\n        if (selectedType in rule)\r\n        {\r\n            (\"bam\")\r\n            console.log(rule)\r\n            return rule[selectedType];\r\n        }\r\n        else\r\n        {\r\n            return [];\r\n        }\r\n        */\r\n        if (rule !== false && index.toString() in rule && selectedType in rule[index])\r\n        {\r\n            console.log(rule[index][selectedType])\r\n            return rule[index][selectedType]; \r\n        }\r\n        \r\n        return [];\r\n    \r\n    }\r\n\r\n\r\n    commonRuleSelection = (element, start, ontoModel) => \r\n    {\r\n        let result = [];\r\n\r\n        // tohle vyřeš na úrovni onto modelu!\r\n        let fatherOnto = [];\r\n        let childPuroType = [];\r\n        //const connection =  element.connect.length > 0 ? true : false;  \r\n        let type = \"elementSelection\"; \r\n        for (let child of element.childType)\r\n        {\r\n            childPuroType.push(this.delUri(child));\r\n        }\r\n\r\n        \r\n        for (let node of ontoModel)\r\n        {\r\n            if (element.father.includes(node.uri)) {\r\n                fatherOnto.push(node.ontoType);\r\n            }\r\n            \r\n        }\r\n\r\n        // Změnit!! \r\n        for (let rule of this.rulesJson.commonRules)\r\n        {\r\n\r\n            /*((fatherOnto.some(r=> rule.fatherOnto.includes(r)) || (rule.fatherOnto.includes(\"none\"))) &&\r\n            (element.childType.some(r=> rule.childPuro.includes(r) || \r\n            (rule.childPuro.includes(\"none\"))) \r\n           ))\r\n            */\r\n            console.log(start === true)\r\n            console.log(rule.fatherOnto === \"NoRelation\")\r\n            console.log(rule.fatherOnto)\r\n           if (start === true && rule.fatherOnto[0] === \"NoRelation\")\r\n           {\r\n             const question = \"Which type is \"+element.label.value+\"?\";\r\n             return this.createButtons(rule.offer,question, type,false, element.label.value);\r\n           }\r\n           else if ((fatherOnto.some(r=> rule.fatherOnto.includes(r)) || (rule.fatherOnto.includes(\"none\"))))\r\n            {\r\n                \r\n                if (\"invert\" in rule && rule[\"invert\"] === true)\r\n                {\r\n                    type += \"-invert\"\r\n                }\r\n\r\n                // tady doplň máš i rule \r\n                const question = \"Which type is \"+element.label.value+\"?\";\r\n                return this.createButtons(rule.offer,question, type,false, element.label.value);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n}","import EventController from \"./EventController\";\r\n\r\nexport default class HistoryController {\r\n    constructor ()\r\n    {\r\n        this.ontoModelHistory = [];\r\n        this.propertiesHistory = []; \r\n        this.inputVariables = [];\r\n    }\r\n\r\n    init (rec)\r\n    {\r\n         this.propertiesHistory.push(rec);\r\n         this.ontoModelHistory.push([]); \r\n    }\r\n\r\n    reset ()\r\n    {\r\n        this.ontoModelHistory = [];\r\n        this.propertiesHistory = []; \r\n        this.inputVariables = [];\r\n    }\r\n\r\n    saveRecords (properties = {}, ontoModel = [], inputVariables)\r\n    {\r\n        this.propertiesHistory.push(properties);\r\n        this.ontoModelHistory.push(ontoModel);\r\n        this.inputVariables.push(inputVariables); \r\n    }\r\n\r\n\r\n    undo()\r\n    {   \r\n        \r\n        this.ontoModelHistory.pop();\r\n        const lastProp = this.propertiesHistory.pop();\r\n        this.inputVariables.pop(); \r\n        if (this.propertiesHistory[this.propertiesHistory.length-2] !== undefined && this.propertiesHistory[this.propertiesHistory.length-2][\"queryTree\"].length === 0)\r\n        {\r\n            this.propertiesHistory[this.propertiesHistory.length-2][\"queryTree\"] = JSON.parse(JSON.stringify(lastProp[\"queryTree\"]));\r\n        }\r\n        console.log(this.propertiesHistory)\r\n        console.log(this.inputVariables)\r\n        console.log(this.ontoModelHistory)\r\n        return {ontoModel: this.ontoModelHistory[this.ontoModelHistory.length-2], properties: this.propertiesHistory[this.propertiesHistory.length-2],\r\n        inputVariables: this.inputVariables[this.inputVariables.length-1]};\r\n    }\r\n\r\n}\r\n","\r\nexport default class OntoScheController {\r\n\r\n    /*\r\n    constructor()\r\n    {\r\n\r\n       const mod = this.initJson();\r\n       console.log(mod)\r\n       const model = this.transform(mod);\r\n\r\n\r\n\r\n         console.log(model);\r\n        const schemas = require('ontouml-schema');\r\n        const Ajv = require('ajv');\r\n        const validator = new Ajv().compile(schemas.getSchema(schemas.ONTOUML_2));\r\n        this.ontoModel = this.initJson();\r\n       \r\n        const isValid = validator(model);\r\n\r\n        if (isValid)\r\n        {\r\n          console.log(\"ok\")\r\n        }\r\n        else\r\n        {\r\n          console.log(validator.errors);\r\n        }\r\n    } */\r\n\r\n    transform (ontoModel)\r\n    {\r\n        const ontoUmlSchema = this.schemaInit(); \r\n        let relCount = 0; \r\n\r\n        for (let node of ontoModel)\r\n        {\r\n            if(node.type === \"Class\" || node.ontoType.toLowerCase() === \"relator\")\r\n            {\r\n              ontoUmlSchema[\"contents\"].push(this.ontoClassTransformation(node)); \r\n            }\r\n        }\r\n        console.log(ontoUmlSchema)\r\n        // Relations have to be added at the end \r\n        for (let node of ontoModel)\r\n        {\r\n          if (node.type === \"relation\" && node.ontoType.toLowerCase() !== \"relator\") {\r\n              let key; \r\n              \r\n              if (node.from.length >= node.to.length)\r\n              {\r\n                 key = \"from\";\r\n              }\r\n              else\r\n              {\r\n                key = \"to\"; \r\n              }\r\n              \r\n              let opositeIndex = 0;\r\n              for (let index in node[key])\r\n              {\r\n                 \r\n                 let fromIndex = key === \"from\" ? index : opositeIndex; \r\n                 let toIndex = key === \"to\" ? index : opositeIndex; \r\n                  \r\n                 ontoUmlSchema[\"contents\"].push(this.relationTransformation(node, relCount, fromIndex, toIndex));\r\n                 relCount += 2;  \r\n                 if (index <= node[key].length)\r\n                 {\r\n                    opositeIndex = index; \r\n                 }\r\n              }\r\n          }\r\n          else if (node.ontoType.toLowerCase() === \"relator\")\r\n          {\r\n            let nodeCopy = JSON.parse(JSON.stringify(node));\r\n            let nodeCopy2 = JSON.parse(JSON.stringify(node));  \r\n            \r\n            let key; \r\n              \r\n            if (node.from.length >= node.to.length)\r\n            {\r\n               key = \"from\";\r\n            }\r\n            else\r\n            {\r\n              key = \"to\"; \r\n            }\r\n            \r\n            let opositeIndex = 0;\r\n\r\n            for (let index in node[key])\r\n            {\r\n              nodeCopy[\"uri\"] += \"rel1\"\r\n              nodeCopy2[\"uri\"] += \"rel2\"\r\n        \r\n              nodeCopy[\"ontoType\"] += \"mediation\"\r\n              nodeCopy2[\"ontoType\"] += \"mediation\"\r\n              \r\n              if (key === \"from\")\r\n              {\r\n                nodeCopy[\"fromType\"] = node[\"fromType\"][index][0]; \r\n                nodeCopy[\"toType\"] = node[\"fromType\"][index][1];\r\n\r\n                nodeCopy2[\"fromType\"] = node[\"toType\"][opositeIndex][0];\r\n                nodeCopy2[\"toType\"] = node[\"toType\"][opositeIndex][1];\r\n                \r\n                nodeCopy[\"from\"] = [nodeCopy[\"from\"][index]];\r\n                nodeCopy2[\"to\"] = [nodeCopy[\"to\"][opositeIndex]];\r\n              }\r\n              else\r\n              {\r\n                nodeCopy[\"fromType\"] = node[\"fromType\"][opositeIndex][0]; \r\n                nodeCopy[\"toType\"] = node[\"fromType\"][opositeIndex][1];\r\n\r\n                nodeCopy2[\"fromType\"] = node[\"toType\"][index][0];\r\n                nodeCopy2[\"toType\"] = node[\"toType\"][index][1];\r\n                \r\n                nodeCopy[\"from\"] = [nodeCopy[\"from\"][opositeIndex]];\r\n                nodeCopy2[\"to\"] = [nodeCopy[\"to\"][index]];\r\n              }\r\n              \r\n              nodeCopy[\"to\"] = [node.uri];\r\n              nodeCopy2[\"from\"] = [node.uri];\r\n              \r\n              ontoUmlSchema[\"contents\"].push(this.relationTransformation(nodeCopy, relCount, 0,0));\r\n              relCount += 2;\r\n  \r\n              ontoUmlSchema[\"contents\"].push(this.relationTransformation(nodeCopy2, relCount,0,0));\r\n              relCount += 2;  \r\n              \r\n              if (index <= node[key].length)\r\n              {\r\n                 opositeIndex = index; \r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        const schemas = require('ontouml-schema');\r\n        const Ajv = require('ajv');\r\n        const validator = new Ajv().compile(schemas.getSchema(schemas.ONTOUML_2));\r\n        this.ontoModel = this.initJson();\r\n       \r\n        const isValid = validator(ontoUmlSchema);\r\n\r\n        if (isValid)\r\n        {\r\n          return ontoUmlSchema; \r\n        }\r\n        else\r\n        {\r\n          alert(\"Model is not valid! Check OntoSchemaCotroller!\"); \r\n          return {}; \r\n        }\r\n    }\r\n\r\n    schemaInit ()\r\n    {\r\n        return {\r\n            \"type\": \"Package\",\r\n            \"id\": \"puroConversion\",\r\n            \"name\": null,\r\n            \"description\": null,\r\n            \"contents\": [],\r\n            \"propertyAssignments\": null\r\n            }\r\n    }\r\n\r\n    ontoClassTransformation (ontoClass)\r\n    {\r\n      return  {\r\n            \"type\": \"Class\",\r\n            \"id\": ontoClass.uri ,\r\n            \"name\": ontoClass.label,\r\n            \"description\": null,\r\n            \"properties\": null,\r\n            \"literals\": null,\r\n            \"propertyAssignments\": null,\r\n            \"stereotypes\": [ontoClass.ontoType.toLowerCase()],\r\n            \"isAbstract\": null,\r\n            \"isDerived\": null\r\n            }\r\n    }\r\n\r\n    relationTransformation (relation, relCount, fromIndex, toIndex)\r\n    {\r\n\r\n        if (relation.ontoType === \"Generalization\")\r\n        {\r\n             return {\r\n                \"type\": \"Generalization\",\r\n                \"id\": relation.uri,\r\n                \"name\": null,\r\n                \"description\": null,\r\n                \"general\": {\r\n                  \"type\": \"Class\",\r\n                  \"id\": relation.from[fromIndex]\r\n                },\r\n                \"specific\": {\r\n                  \"type\": \"Class\",\r\n                  \"id\": relation.to[toIndex]\r\n                },\r\n                \"propertyAssignments\": {\r\n                  \"nonStandardProperty\": null\r\n                }\r\n              };\r\n        }\r\n        else\r\n        {\r\n            return {\r\n              \"type\": \"Relation\",\r\n              \"id\": relation.uri,\r\n              \"name\": null,\r\n              \"description\": null,\r\n              \"properties\": [\r\n                {\r\n                  \"type\": \"Property\",\r\n                  \"id\": \"prop\" + relCount,\r\n                  \"name\": null,\r\n                  \"description\": null,\r\n                  \"propertyType\": {\r\n                    \"type\": \"Class\",\r\n                    \"id\": relation.from[fromIndex]\r\n                  },\r\n                  \"cardinality\": relation.fromType[fromIndex] === \"\" || undefined ? null : relation.fromType[fromIndex],\r\n                  \"isDerived\": null,\r\n                  \"isOrdered\": null,\r\n                  \"isReadOnly\": null,\r\n                  \"stereotypes\": null,\r\n                  \"propertyAssignments\": null,\r\n                  \"subsettedProperties\": null,\r\n                  \"redefinedProperties\": null,\r\n                  \"aggregationKind\": null\r\n                },\r\n                {\r\n                  \"type\": \"Property\",\r\n                  \"id\": \"prop\" + (parseInt(relCount) + 1),\r\n                  \"name\": null,\r\n                  \"description\": null,\r\n                  \"propertyType\": {\r\n                    \"type\": \"Class\",\r\n                    \"id\": relation.to[toIndex]\r\n                  },\r\n                  \"cardinality\": relation.toType[toIndex] === \"\" || undefined ? null : relation.toType[toIndex],\r\n                  \"isDerived\": null,\r\n                  \"isOrdered\": null,\r\n                  \"isReadOnly\": null,\r\n                  \"stereotypes\": null,\r\n                  \"propertyAssignments\": null,\r\n                  \"subsettedProperties\": null,\r\n                  \"redefinedProperties\": null,\r\n                  \"aggregationKind\": null\r\n                }\r\n              ],\r\n              \"propertyAssignments\": {\r\n                \"nonStandardProperty\": null\r\n              },\r\n              \"stereotypes\": [relation.ontoType.toLowerCase()],\r\n              \"isAbstract\": true,\r\n              \"isDerived\": false\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    initJson()\r\n    {\r\n      return JSON.parse(`[\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"Characterization\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Book\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Topic\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#has_topic\",\r\n          \"label\": \"has_topic\",\r\n          \"fromType\": [\r\n            \"1\"\r\n          ],\r\n          \"toType\": [\r\n            \"1\"\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#Book\",\r\n          \"label\": \"Book\",\r\n          \"ontoType\": \"Kind\",\r\n          \"puroType\": \"BType\",\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#has_topic\",\r\n            \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n          ],\r\n          \"direction\": [\r\n            \"from\",\r\n            \"from\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#Topic\",\r\n          \"label\": \"Topic\",\r\n          \"ontoType\": \"Mode\",\r\n          \"puroType\": \"BType\",\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#has_topic\"\r\n          ],\r\n          \"direction\": [\r\n            \"to\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"Generalization\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Topic\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#DDC_Topic\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/TopicDDC_Topic\",\r\n          \"label\": \"nazev\",\r\n          \"fromType\": [\r\n            \"\"\r\n          ],\r\n          \"toType\": [\r\n            \"\"\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#DDC_Topic\",\r\n          \"label\": \"DDC_Topic\",\r\n          \"ontoType\": \"Subkind\",\r\n          \"puroType\": \"BType\",\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#has_topic\"\r\n          ],\r\n          \"direction\": [\r\n            \"to\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"Relator\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/ontomodels#q\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Location\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#published_in\",\r\n          \"label\": \"published_in\",\r\n          \"fromType\": [\r\n            [\r\n              \"1\",\r\n              \"1\"\r\n            ]\r\n          ],\r\n          \"toType\": [\r\n            [\r\n              \"1\",\r\n              \"1\"\r\n            ]\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"Generalization\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Book\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/ontomodels#q\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/Bookq\",\r\n          \"label\": \"nazev\",\r\n          \"fromType\": [\r\n            \"\"\r\n          ],\r\n          \"toType\": [\r\n            \"\"\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels#q\",\r\n          \"label\": \"q\",\r\n          \"ontoType\": \"Role\",\r\n          \"puroType\": false,\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n          ],\r\n          \"direction\": [\r\n            \"from\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels#w\",\r\n          \"label\": \"w\",\r\n          \"ontoType\": \"Datatype\",\r\n          \"puroType\": \"BValue\",\r\n          \"fromRelation\": [\r\n            {\r\n              \"token\": \"uri\",\r\n              \"value\": \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n            }\r\n          ],\r\n          \"direction\": [\r\n            \"from\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            null\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"connect\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/ontomodels#w\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels/relation/connect/published_inw\",\r\n          \"label\": \"nazev\",\r\n          \"fromType\": [\r\n            \"*\"\r\n          ],\r\n          \"toType\": [\r\n            \"*\"\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/puromodels#Location\",\r\n          \"label\": \"Location\",\r\n          \"ontoType\": \"Role\",\r\n          \"puroType\": \"BType\",\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n          ],\r\n          \"direction\": [\r\n            \"to\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        },\r\n        {\r\n          \"type\": \"relation\",\r\n          \"ontoType\": \"Generalization\",\r\n          \"from\": [\r\n            \"http://lod2-dev.vse.cz/data/ontomodels#e\"\r\n          ],\r\n          \"to\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#Location\"\r\n          ],\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels/relation/Generalization/eLocation\",\r\n          \"label\": \"nazev\",\r\n          \"fromType\": [\r\n            \"\"\r\n          ],\r\n          \"toType\": [\r\n            \"\"\r\n          ],\r\n          \"fromRelation\": []\r\n        },\r\n        {\r\n          \"uri\": \"http://lod2-dev.vse.cz/data/ontomodels#e\",\r\n          \"label\": \"e\",\r\n          \"ontoType\": \"Kind\",\r\n          \"puroType\": false,\r\n          \"fromRelation\": [\r\n            \"http://lod2-dev.vse.cz/data/puromodels#published_in\"\r\n          ],\r\n          \"direction\": [\r\n            \"to\"\r\n          ],\r\n          \"from\": [\r\n            null\r\n          ],\r\n          \"to\": [\r\n            null\r\n          ],\r\n          \"type\": \"Class\",\r\n          \"branchIndex\": [\r\n            1\r\n          ]\r\n        }\r\n      ]`); \r\n    }\r\n}","import RdfController from './RdfController.js';\r\nimport OntoModelController from './OntoModelController';\r\nimport ImageController from './ImageController.js';\r\nimport RuleController from './RuleController.js';\r\nimport MainController from './MainController.js';\r\nimport HistoryController from './HistoryController.js';\r\nimport OntoSchmeController from './OntoSchemaController.js';\r\n\r\n//chyba nejspíše bude v RDF!! v relationTree je instance v případě prvního XML tam instance není, history of dogs je smazané, tak udělej příklad s tím!!!\r\n// TODO -> v případě dvou otců projdi cyklem a zkontroluj oba!!!!\r\n// TODO -> vyřešit vazby\r\n// TODO -> next element do objektového schématu -> zatím prototyp \r\n// TODO -> třída element pro sjednocení properties \r\n// UNDO \r\n\r\n// Udělat material \r\n// Udělat derivation \r\n// zkontrolovat jestli \r\n\r\n\r\nexport default class EventController extends MainController{\r\n    constructor() {\r\n        super();   \r\n        this.rdfController = new RdfController(); \r\n        this.ontoController = new OntoModelController();  \r\n        this.imageController = new ImageController();\r\n        this.ruleController = new RuleController();\r\n        this.historyController = new HistoryController();\r\n        this.ontoSchemaController = new OntoSchmeController(); \r\n        const queryTreePromise = this.rdfController.getFullPath();\r\n        \r\n        queryTreePromise.then(results => {\r\n            this.queryTree = results;   \r\n            console.log(results);        \r\n        });\r\n        \r\n        const relationsPromise = this.rdfController.getRelations();\r\n        relationsPromise.then(results => {\r\n            this.relations = results;          \r\n        });\r\n\r\n                     \r\n        \r\n\r\n\r\n        this.elSettings = {};\r\n        // Nový začátek \r\n\r\n        this.relationOrderIndex = 0;\r\n        this.relation = {};\r\n        this.relationIndex = 0; \r\n        this.relationType = \"\"; \r\n        \r\n        this.setIndexexToDefault();\r\n\r\n    }\r\n    \r\n    getDefault (firstCall)\r\n    {\r\n      \r\n        // tady se zeptej na type relationu \r\n        // tohle není do defaultu ale do next element\r\n        // hod vyjmku v případě když nebude žádný relation k dispozic\r\n       \r\n        if (this.relationOrderIndex === this.relations.length || this.relations.length === 0)\r\n        {\r\n            if (firstCall === true)\r\n            {\r\n                \r\n                this.relationTree = this.queryTree;\r\n            \r\n                this.ruleKey = \"from\";\r\n                this.elementUri = this.relationTree[this.relationOrderIndex].uri.value;\r\n                this.relation = {uri:{value: null}};\r\n                return this.ruleController.commonRuleSelection(this.relationTree[this.relationOrderIndex], true,this.ontoController.getOntoModel());\r\n            }\r\n            alert(\"Transformation is comlete!!!\");\r\n            return {buttons: [], title: \"The End\", type: \"end\"};\r\n        }\r\n\r\n        \r\n\r\n\r\n        const relation = this.relations[this.relationOrderIndex];\r\n        this.relation = relation;\r\n        this.ruleKey = \"from\";\r\n\r\n        if(this.relation.valuation.length > 0)\r\n        {\r\n           \r\n            //return this.nextElement(\"Relator\",this.relation.uri.value,\"BRelation\",\"from\");\r\n            const question = relation.label.value.charAt(0).toUpperCase() + relation.label.value.slice(1) + \" was typed as a Relator.\"\r\n            return this.createButtons(\"Relator\",question,this.delUri(relation.type.value),false,relation.label.value);\r\n        }\r\n        else\r\n        {\r\n            //this.elUri = relation.uri.value;\r\n            this.elementUri = relation.uri.value;\r\n            \r\n            const question = this.rulesJson.bRelationRules[0].question.replace(\"VAL\",relation.label.value);\r\n            return this.createButtons(this.rulesJson.bRelationRules[0].offer, question,this.delUri(relation.type.value), false, relation.label.value);            \r\n        }\r\n    }\r\n\r\n\r\n    async nextElement (selectedType, selectedUri, puroType ,elName, nameWasChange) \r\n    {  \r\n         console.log(this.relationTree)\r\n        let relationRules; \r\n        console.log([selectedType, selectedUri, puroType ,elName, nameWasChange])\r\n        if (elName !== \"\" && nameWasChange === true)\r\n        {\r\n            this.changeElementsProperty(this.elementUri,\"label\", elName);\r\n        } \r\n    \r\n        if (puroType === \"BRelation\")\r\n        {   \r\n           return this.relationWasSelected(selectedType, this.ruleKey);\r\n        }\r\n\r\n        else \r\n        {\r\n            \r\n            let relationEl; \r\n            let additionalRule = []; \r\n            let relFlow = puroType;\r\n            let elRelTypes;\r\n            \r\n            if (puroType.includes(\"ontoRelation-save-bRelation\") || puroType.includes(\"material\") )\r\n            {\r\n                if(puroType.includes(\"relator\"))\r\n                {\r\n                    let direction = puroType.replace(\"ontoRelation-save-bRelation-relator-\",\"\");\r\n                    if(direction === \"from\")\r\n                    {\r\n                        this.ontoController.updateOntoModel(this.relation.uri.value,\"fromType\", selectedType);\r\n                        relFlow = this.additionalRule.key === \"last\" ? \"updated\" : relFlow;\r\n                    }\r\n                    else if (direction === \"to\")\r\n                    {\r\n                        this.ontoController.updateOntoModel(this.relation.uri.value,\"toType\", selectedType);\r\n                        relFlow = this.additionalRule.key === \"last\" ? \"updated\" : relFlow;\r\n                    }\r\n                    else if (direction === \"material\")\r\n                    {\r\n                       // select type \r\n                       // alert(selectedType)\r\n                    }\r\n                }\r\n                else\r\n                {     \r\n                    this.ontoController.updateOntoModel(this.relation.uri.value,\"fromType\", selectedType[0]);\r\n                    this.ontoController.updateOntoModel(this.relation.uri.value,\"toType\", selectedType[1]);\r\n                    relFlow = this.additionalRule.key === \"last\" ? \"updated\" : relFlow;\r\n                }\r\n\r\n                if (this.lastElInBranch === \"cPhase-next\")\r\n                {\r\n                   \r\n                    if (this.relation[this.ruleKey].length <= this.relationRuleIndex)\r\n                    {\r\n                       \r\n                        this.relationOrderIndex ++;\r\n                        this.setIndexexToDefault();\r\n                        return this.getDefault();\r\n                    } \r\n                    else\r\n                    {\r\n                        return this.nextTreeBranch(); \r\n                    }\r\n                }\r\n                else\r\n                {\r\n                 \r\n                    selectedType = this.elSettings.selectedType;\r\n                    puroType = this.elSettings.puroType;\r\n                    elName = this.elSettings.elName;\r\n                    relationEl = this.elSettings.relationEl;\r\n                    additionalRule = this.elSettings.additionalRule; \r\n                    nameWasChange = this.elSettings.nameWasChange;\r\n                }\r\n\r\n            }\r\n            if (!Array.isArray(selectedType) && selectedType.toLowerCase() === \"none\")\r\n            {  \r\n                this.elSettings.selectedType = selectedType; \r\n                const ontoRelation = this.ontoController.getOntoElement(this.relation.uri.value);\r\n                this.additionalRule.key = \"stop\"; \r\n                if (ontoRelation[this.ruleKey].length !== this.relationRuleIndex)\r\n                {\r\n\r\n                    const lastElUri = this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey);\r\n            \r\n                    this.ontoController.updateOntoModel(ontoRelation.uri, this.ruleKey,lastElUri);\r\n                }\r\n                const updateCardinality = this.updateRelationTypes();\r\n                if (updateCardinality !== false)\r\n                {\r\n                    return updateCardinality; \r\n                } \r\n                this.consistencyExeption.push({uri: this.elementUri, ontoType:selectedType, type: puroType});\r\n            \r\n                return this.consistencyCheck(); \r\n            }\r\n            \r\n            if (!puroType.includes(\"ontoRelation\")  && puroType !== \"dataType\")\r\n            {\r\n            //addRUleAsync\r\n              \r\n               if ((this.additionalRule.key!== \"stop\" && this.additionalRule.key === undefined && (this.additionalRule.index > 1 || this.ontoController.getOntoBranch(this.relation.uri.value,this.ruleKey).length === 0)) && this.relation.uri.value !== null)\r\n               {\r\n                   \r\n                    additionalRule = this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,false, this.countBTypesInTree(this.relationTree)),selectedType, 1)\r\n                    if (additionalRule.length > 0)\r\n                    {\r\n                        this.additionalRule.index = 2; \r\n                        this.additionalRule.rule =  this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,false, this.countBTypesInTree(this.relationTree));\r\n                        this.additionalRule.key = selectedType;\r\n                    }\r\n               } \r\n               else if (this.additionalRule.index > 1 && this.additionalRule.key !== \"stop\")\r\n               {\r\n                 additionalRule = this.ruleController.getAdditionalRule(this.additionalRule.rule, selectedType, this.additionalRule.index);\r\n                 if (additionalRule.length > 0)\r\n                 {\r\n                    this.additionalRule.index ++; \r\n                 }\r\n                 else\r\n                 {\r\n                    this.additionalRule.key = \"last\";\r\n                 }\r\n\r\n               }\r\n              \r\n               relationEl = this.ontoController.getRelationElements(elName, this.getElementByUri(this.elementUri), this.elementUri,this.relation.uri.value, additionalRule.length, additionalRule.length === 0, puroType, this.ontoUri, this.ruleKey, nameWasChange,this.relationRuleIndex > 1);\r\n               this.elSettings = {selectedType: selectedType, nameWasChange: nameWasChange, puroType: puroType, ruleKey:this.ruleKey, elName:elName, relationEl: relationEl, additionalRule: additionalRule, relType: \"\", elUri: this.elementUri};\r\n            \r\n               \r\n            \r\n               if ((relationEl === this.relation.uri.value) || this.lastElInBranch === \"cPhase\")\r\n               {\r\n                 const updateRelTypes = this.updateRelationTypes(); \r\n\r\n                if (updateRelTypes !== false)\r\n                {\r\n                    this.lastElInBranch += \"-next\"; \r\n                    return updateRelTypes;\r\n                }\r\n               }\r\n            }\r\n            else if(puroType === \"dataType\")\r\n            {\r\n                relationEl = [selectedType, this.ontoUri+elName];\r\n                this.elSettings.relationEl = relationEl;\r\n                this.elSettings.relType = \"connect\" // rovná čára mezi elementy \r\n                \r\n\r\n                this.ontoController.addToOntoModel(this.ontoUri+elName,elName,\"Datatype\",\"BValue\",this.relation.uri,this.ruleKey, undefined,undefined,undefined,undefined,this.elementUri);\r\n            }\r\n            else \r\n            {\r\n             \r\n                if (puroType.includes(\"ontoRelation-cardinality\"))\r\n                {\r\n              \r\n                    this.elSettings.relType = selectedType; \r\n                }\r\n                else if (puroType.includes(\"ontoRelation-save\"))\r\n                {\r\n               \r\n                    elRelTypes = selectedType;\r\n                }\r\n              \r\n                selectedType = this.elSettings.selectedType;\r\n                puroType = this.elSettings.puroType;\r\n                elName = this.elSettings.elName;\r\n                relationEl = this.elSettings.relationEl;\r\n                additionalRule = this.elSettings.additionalRule; \r\n                nameWasChange = this.elSettings.nameWasChange;\r\n                this.elementUri = this.elSettings.elUri;\r\n               \r\n            } \r\n            relationRules = this.getRelationRules(relationEl, relFlow, selectedUri,this.ruleKey, this.elSettings.selectedType, this.elSettings.relType, elRelTypes);\r\n         \r\n            if (relationRules !== true)\r\n            {\r\n                //vrácení otázky v případě true relation ulož -> může se pokračovat\r\n                return Promise.resolve(relationRules); \r\n            }\r\n            \r\n            if (this.valuationArr !== null)\r\n            {\r\n                \r\n                if (this.valuationArr.length > 0)\r\n                {\r\n                    return this.handleValuation();\r\n                \r\n                }\r\n                else if(this.valuationArr.length === 0)\r\n                {\r\n                   \r\n                    if (this.ruleKey === \"to\" && this.relation.to.length === this.relationRuleIndex)\r\n                    {\r\n                        const lastEl = this.ontoController.getLastElementUri(this.relation.uri.value, this.ruleKey);\r\n                        this.ontoController.updateOntoModel(this.relation.uri.value,\"to\",lastEl);\r\n\r\n                        this.elementUri = lastEl; \r\n                        this.lastElInBranch = \"cPhase\";\r\n\r\n                        return this.updateRelationTypes();\r\n                    }\r\n                    else\r\n                    {\r\n                        return this.nextTreeBranch();\r\n                    }\r\n                }\r\n            } \r\n            //Přidání do ontomodelu \r\n            const purType = this.selectedEl === false || !(\"type\" in this.selectedEl) ? false : this.delUri(this.selectedEl.type.value);\r\n\r\n            let origUri = undefined; \r\n            if (this.relationTree[this.relationTree.length - 1].uri.value === this.elementUri)\r\n            {\r\n               const ontoEl = this.ontoController.getOntoElement(this.elementUri); \r\n               if (ontoEl === false)\r\n               {\r\n                 origUri = \"first\"\r\n               }    \r\n            }\r\n\r\n            this.ontoController.addToOntoModel(this.elementUri, this.delUri(this.elementUri),selectedType,\r\n            purType,this.relation.uri.value,this.ruleKey,elName, nameWasChange, this.ontoUri, this.relationRuleIndex, origUri);\r\n          \r\n            \r\n           \r\n            //zjištění dodatečných pravide \r\n            if (additionalRule.length > 0)\r\n            {\r\n                this.selectedEl = this.getNextElement();\r\n                \r\n             \r\n                this.elementUri = this.selectedEl === false || Array.isArray(this.selectedEl) ? \"\" : this.selectedEl.uri.value; \r\n                \r\n                this.selectedEl = this.elementUri === \"\" ? false : this.selectedEl; \r\n                \r\n                return this.ruleController.ruleSelection(undefined,this.ruleKey,this.selectedEl,this.ontoController.getLastElement(this.relation.uri.value, this.ruleKey).label,additionalRule,this.queryTree, this.relation.label.value);\r\n            }\r\n            else if (this.additionalRule.key === \"last\")\r\n            {\r\n                \r\n               \r\n                const ontoRelation = this.ontoController.getOntoElement(this.relation.uri.value);\r\n                if (ontoRelation[this.ruleKey].length !== this.relationRuleIndex)\r\n                {\r\n                    const lastElUri = this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey);\r\n                    this.ontoController.updateOntoModel(ontoRelation.uri, this.ruleKey,lastElUri);\r\n                }\r\n                const updateCardinality = this.updateRelationTypes();\r\n                if (updateCardinality !== false)\r\n                {\r\n                    //this.elSettings.selectedType = \"none\"\r\n                    return updateCardinality; \r\n                } \r\n                else\r\n                {\r\n                   \r\n                    this.additionalRule.key = \"stop\";\r\n                    return this.consistencyCheck(); \r\n                }\r\n            }\r\n            else\r\n            {\r\n                \r\n                this.additionalRule.key = \"stop\"; \r\n                \r\n\r\n                // přiřazení typu neurčeným elementům \r\n\r\n                    if (this.relation.uri.value !== null && this.ontoController.getOntoElement(this.relation.uri.value).from.length === 0)\r\n                    {\r\n                        const lastElUri = this.ontoController.getLastElementUri(this.relation.uri.value, this.ruleKey);\r\n                        this.ontoController.updateOntoModel(this.relation.uri.value, this.ruleKey, lastElUri);\r\n                    }\r\n            \r\n                    return this.consistencyCheck();\r\n                    \r\n                \r\n            }\r\n\r\n        }\r\n            \r\n    }\r\n\r\n\r\n    consistencyCheck ()\r\n    {\r\n        if (this.elementsWithoutType.length === 0)\r\n        {\r\n            this.elementsWithoutType = this.checkElementsInRelationTree(this.relationTree,this.ontoController.getOntoModel());\r\n        }     \r\n\r\n        if (this.elementsWithoutType.length > 0 && this.withoutTypeIndex < this.elementsWithoutType.length)\r\n        {        \r\n            const element = this.getElementByUri(this.elementsWithoutType[this.withoutTypeIndex].uri.value);   \r\n            this.withoutTypeIndex ++;\r\n            this.elementUri = element.uri.value;\r\n            const commonRule = this.ruleController.commonRuleSelection(element, this.ruleKey,this.ontoController.getOntoModel());\r\n            if (commonRule === undefined)\r\n            {   \r\n                alert(\"Common rule is not defined! Check rules.json\");\r\n                window.location.reload();\r\n            }\r\n            else\r\n            {\r\n                return commonRule;\r\n            }\r\n        \r\n        }\r\n\r\n        let unfinishedTypes = this.checkElementsConsistency(this.relation.uri.value, this.ruleKey); \r\n                    \r\n        if (unfinishedTypes.length > 0)\r\n        {              \r\n            for (let exeption of this.consistencyExeption)\r\n            {\r\n                for (let index in unfinishedTypes)\r\n                {\r\n                    if(exeption.uri === unfinishedTypes[index].element && unfinishedTypes[index].types.includes(exeption.ontoType) && exeption.type === unfinishedTypes[index].key)\r\n                    {\r\n                        unfinishedTypes.splice(index, 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n    \r\n            if ((unfinishedTypes.length > 0 && unfinishedTypes[0].types.includes(\"Relator\") && unfinishedTypes[0].types.includes(\"None\")) || (unfinishedTypes.length > 0 && unfinishedTypes[0].types.includes(\"None\") && unfinishedTypes[0].types.length === 1))\r\n            {\r\n                unfinishedTypes.splice(0, 1);  \r\n            }\r\n        }\r\n        \r\n        if (unfinishedTypes.length > 0)\r\n        {\r\n            const question = this.createQuestion(unfinishedTypes[0], this.rulesJson.questions); \r\n            this.elementUri = unfinishedTypes[0].element;\r\n            return this.createButtons(unfinishedTypes[0].types, question, unfinishedTypes[0].key,true);                               \r\n        }\r\n        else if (this.relation.uri.value === null)\r\n        {\r\n            return this.getDefault(); \r\n        }\r\n        else\r\n        {\r\n            \r\n            if (this.relation === null)\r\n            {\r\n                this.getDefault(); \r\n            }\r\n            \r\n            if (this.valuationArr === null && this.relationRuleIndex === 1)\r\n            {\r\n                this.valuationArr = this.getAllTreeValuations(this.ruleKey);\r\n                if (this.valuationArr.length > 0)\r\n                { \r\n                   return this.handleValuation(); \r\n                }\r\n            }\r\n            \r\n            if (this.relation[this.ruleKey].length === this.relationRuleIndex && this.ruleKey !== \"from\")\r\n            {\r\n                const rel = this.ontoController.getOntoElement(this.relation.uri.value);\r\n\r\n                if (rel.to.length < this.relationRuleIndex)\r\n                {\r\n                    const lastEl = this.ontoController.getLastElement(rel.uri,\"to\");\r\n                    this.ontoController.updateOntoModel(rel.uri, \"to\", lastEl.uri);\r\n                    this.lastElInBranch = \"cPhase\";\r\n\r\n                    return this.updateRelationTypes(true); \r\n                }\r\n\r\n\r\n                this.setIndexexToDefault();\r\n                this.relationOrderIndex ++;\r\n                return this.getDefault();\r\n            } \r\n            else\r\n            {\r\n                \r\n                return this.nextTreeBranch(); \r\n            }   \r\n    \r\n        }\r\n    }\r\n\r\n    updateRelationTypes ()\r\n    {\r\n        const ontoRel = this.ontoController.getOntoElement(this.relation.uri.value);\r\n\r\n        if (ontoRel.to.length > 0 && ontoRel.from.length > 0)\r\n        {\r\n           \r\n            if (ontoRel.ontoType === \"Relator\" && ontoRel.fromType.length < ontoRel.from.length)\r\n            {   \r\n                const rule = this.ruleController.getSpecificRule(this.rulesJson[ontoRel.ontoType],\"cardinality\");\r\n                return this.createRelCardinalityBtn(\"ontoRelation-save-bRelation-relator-from\",rule,\"from\",ontoRel.from[ontoRel.fromType.length],ontoRel.uri);\r\n            }\r\n            else if (ontoRel.ontoType === \"Relator\" && ontoRel.toType.length < ontoRel.to.length) \r\n            {\r\n                const rule = this.ruleController.getSpecificRule(this.rulesJson[ontoRel.ontoType],\"cardinality\");\r\n                return this.createRelCardinalityBtn(\"ontoRelation-save-bRelation-relator-to\",rule,\"to\",ontoRel.uri,ontoRel.to[ontoRel.toType.length]);\r\n            }\r\n       /*   else if (ontoRel.ontoType === \"Relator\" && !(\"materialExists\" in ontoRel))\r\n            {\r\n                this.ontoController.addToProperty(ontoRel.uri,\"materialExists\", true); \r\n                return this.createButtons([\"yes\", \"no\"], \"is there material\",\"relator-material\",\"sda\",\"sdsad\"); \r\n            } */\r\n            else if (ontoRel.toType.length < ontoRel.to.length && ontoRel.fromType.length < ontoRel.from.length)\r\n            {\r\n                const rule = this.ruleController.getSpecificRule(this.rulesJson[ontoRel.ontoType],\"cardinality\");\r\n                return this.createRelCardinalityBtn(\"ontoRelation-save-bRelation\",rule,\"to\",ontoRel.from[ontoRel.fromType.length],ontoRel.to[ontoRel.toType.length]);\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    handleValuation () \r\n    {\r\n    \r\n        const question = \"Which Datatype represents \" + this.delUri(this.valuationArr[0].valuation) + \"?\"; \r\n        const buttons = this.createButtons(this.valuationArr[0].el, question, \"dataType\",true); \r\n        this.elementUri = this.valuationArr[0].valuation; \r\n        this.valuationArr.shift();\r\n        return buttons;  \r\n    }\r\n\r\n    nextTreeBranch () \r\n    {\r\n        \r\n        if (this.valuationArr === null && this.relationRuleIndex === 1)\r\n        {\r\n         \r\n            this.valuationArr = this.getAllTreeValuations(this.ruleKey);\r\n            // vrat dotaz na Value\r\n            if (this.valuationArr.length > 0)\r\n            {\r\n                return this.handleValuation();\r\n            \r\n            }\r\n        }\r\n        \r\n\r\n        if (this.ontoController.getOntoElement(this.relation.uri.value).from.length === 0 || (this.relationRuleIndex > 1 && this.ruleKey === \"from\"))\r\n        {\r\n            let lastElUri = this.ontoController.getLastElementUri(this.relation.uri.value, this.ruleKey);\r\n            this.ontoController.updateOntoModel(this.relation.uri.value, this.ruleKey, lastElUri);\r\n        }\r\n        \r\n        \r\n\r\n        let relationTypePromise; \r\n\r\n        //number of branches -> uprav \r\n        if (this.relationTreeIndex === this.relationTreeArr.length)\r\n        {\r\n            if (this.relation[this.ruleKey].length === this.relationRuleIndex)\r\n            {\r\n               this.ruleKey = this.ruleKey === \"from\" ? \"to\": \"from\"; \r\n               this.relationRuleIndex = 0;\r\n            }   \r\n            \r\n            relationTypePromise = this.getRelatedElements(this.relation,this.ruleKey);\r\n            this.relationRuleIndex ++; \r\n        }\r\n        else\r\n        {   \r\n            relationTypePromise = Promise.resolve(this.relationTreeArr);\r\n        }\r\n\r\n        this.additionalRule.key = undefined;\r\n        this.additionalRule.index = 0; \r\n        this.consistencyExeption = [];\r\n\r\n\r\n        return new Promise(resolve => {relationTypePromise.then((results) => {\r\n            this.valuationArr = null;\r\n            resolve (this.handleRelatedElements(results,\"nextElement\",this.ruleKey ))\r\n        });});\r\n    }\r\n\r\n    getAllTreeValuations (ruleKey)\r\n    {\r\n        let valuations = [];\r\n        for(let treeEl of this.relationTree)\r\n        {\r\n          \r\n            let el = this.getElementByUri(treeEl.uri.value);\r\n            if (el.valuation.length > 0)\r\n            {\r\n                let connectElement = el.uri.value; \r\n                if (this.delUri(el.type.value) === \"BObject\" || el.fatherTypeRelation.includes(\"http://lod2-dev.vse.cz/ontology/puro#instanceOf\"))\r\n                {\r\n                    const lastTypes = this.rulesJson[\"lastTypes\"];\r\n                    let lastEl = [];\r\n                    for (let type of lastTypes)\r\n                    {\r\n                      lastEl = lastEl.concat(this.ontoController.getElementsByOntoType(type, this.relation.uri.value));\r\n                    }\r\n                    if (lastEl.length > 0) {\r\n                        connectElement = lastEl[0]; \r\n                    }\r\n                }\r\n\r\n                for (let valuation of el.valuation)\r\n                {\r\n                    valuations.push({el: connectElement, valuation: valuation})\r\n                }\r\n            }\r\n        }\r\n\r\n        if(ruleKey === \"from\")\r\n        {\r\n            for (let valuation of this.relation.valuation)\r\n            {\r\n                valuations.push({el: this.relation.uri.value, valuation: valuation})\r\n            }\r\n        }\r\n\r\n        for (let index in valuations)\r\n        {\r\n            if (this.ontoController.getElementByProperty(\"origUri\",valuations[index].valuation) !== false)\r\n            {\r\n                valuations.splice(index, 1);   \r\n            }\r\n        }\r\n\r\n        \r\n        return valuations; \r\n    }\r\n\r\n\r\n    getGraphSvg  () \r\n    {\r\n        let ontoModel = this.ontoController.getOntoModel();\r\n\r\n        let svg = this.imageController.createGraph(ontoModel);\r\n        return svg; \r\n\r\n    }\r\n    \r\n    createRelCardinalityBtn (type, rule, ruleKey, fromE, toE, relationFlow, elUri) \r\n    {\r\n  \r\n        type += (relationFlow === \"dataType\") ? \"-daType\" : \"\"; \r\n        \r\n        let fromB = rule.fromT.map(ruleClass => {\r\n            return {\"name\": ruleClass, \"uri\":elUri, direction: \"from\"};\r\n            });\r\n        \r\n        let toB = rule.toT.map(ruleClass => {\r\n            return {\"name\": ruleClass, \"uri\":elUri, direction: \"to\"};\r\n        });\r\n\r\n        const  labelFromE = this.selectElementsLabel(fromE);\r\n        const labelToE = this.selectElementsLabel(toE);\r\n        \r\n        return {\"buttons\": toB.concat(fromB) , \"title\": \"Select cardinality between elements\", \"type\": type, \"elName\": [labelFromE, labelToE]};\r\n    }\r\n\r\n    selectElementsLabel(element)\r\n    {\r\n         let ontoEl = this.ontoController.getOntoElement(element);\r\n         let label; \r\n         if (ontoEl === false)\r\n         {\r\n             if (element === this.elSettings.elUri)\r\n             {\r\n                label = this.elSettings.elName === \"\" ? this.delUri(element) : this.elSettings.elName; \r\n             }\r\n             else\r\n             {\r\n                 label = this.delUri(element)\r\n             }\r\n         }\r\n         else\r\n         {\r\n            label = ontoEl.label\r\n         }\r\n\r\n         return label; \r\n    }\r\n   \r\n    getRelationRules  (elements, relType, elUri, ruleKey,ontoType, relOntoType, elRelTypes ) \r\n    {\r\n            \r\n        let fromE;\r\n        let toE;\r\n\r\n        let fromEType;\r\n        let toEType; \r\n\r\n        let relationFlow = relType.replace(\"ontoRelation-\", \"\");\r\n        let rule;\r\n        let relationRules = this.rulesJson.relationRules;  \r\n        \r\n \r\n        if (Array.isArray(elements)) {\r\n           fromE = elements[0];\r\n           toE = elements[1];\r\n           fromEType = this.ontoController.getElementOntoType(fromE);\r\n           toEType = this.ontoController.getElementOntoType(toE);\r\n\r\n           fromEType = fromEType === false ? ontoType : fromEType;\r\n           toEType = toEType === false ? ontoType : toEType; \r\n           rule = this.findRule(relationRules, [\"from\", fromEType, \"to\", toEType]);\r\n            \r\n        }\r\n        else\r\n        {\r\n            return true; \r\n        }\r\n        \r\n        if (relType === \"updated\")\r\n        {\r\n            return true;\r\n        }\r\n        if (rule === false && !relationFlow.includes(\"save\"))\r\n        {\r\n            alert(\"Relation rule is not defined! Check rules.json!\"); \r\n    \r\n        }\r\n        \r\n        if (!relationFlow.includes(\"save\") && (relationFlow === \"cardinality\" || relationFlow === \"dataType\" || rule.offer.length === 1))\r\n        {\r\n           \r\n           \r\n            // Vyhod chybu, že není definované pravidlo pro dva typy!! \r\n            if (\"fromT\" in rule && \"toT\" in rule)\r\n            {\r\n                \r\n                this.elSettings.relType = (rule.offer.length === 1) ? rule.offer[0] : this.elSettings.relType ;   \r\n                return this.createRelCardinalityBtn(\"ontoRelation-save\",rule,ruleKey,fromE,toE,relationFlow,elUri);\r\n            }\r\n            else\r\n            { \r\n                \r\n                relOntoType = (rule.offer.length === 1) ? rule.offer[0] : relOntoType; \r\n                this.ontoController.addRelation(relOntoType, fromE, toE, undefined, \"nazev\", \"\", \"\");\r\n\r\n                return true;\r\n            }\r\n\r\n            \r\n        }\r\n        else if (relationFlow.includes(\"save\"))\r\n        {\r\n            this.ontoController.addRelation(this.elSettings.relType, fromE, toE, undefined, \"nazev\", elRelTypes[0], elRelTypes[1]);\r\n            return true;\r\n        }\r\n        else\r\n        {\r\n\r\n           let result = rule.offer.map((ruleClass) => {\r\n            return {\"name\": ruleClass, \"uri\":elUri,\"origin\":ruleKey};\r\n           });\r\n\r\n           this.elementUri = elUri;\r\n\r\n           return {\"buttons\": result, \"title\": \"Which type of relation is between \"+ this.delUri(fromE) +\" and \" + this.delUri(toE)+\"?\", \"type\": \"ontoRelation-cardinality\"};        \r\n        \r\n        }\r\n\r\n    }\r\n\r\n    findRule (rules, condition) \r\n    {\r\n        let validity = false;  \r\n        for (let rule of rules)\r\n        {\r\n            validity = false;\r\n            for (let index = 0; index < condition.length; index += 2 ) \r\n            {  \r\n                for (let ontoType of rule[condition[index]])\r\n                {\r\n                    if (this.isSameCaseInsensitive(condition[index + 1],ontoType) || ontoType === \"*\")\r\n                    {   \r\n                        if (validity === true)\r\n                        {\r\n                            return rule; \r\n                        } \r\n                        validity = true;\r\n                        break; \r\n                    }\r\n\r\n                }\r\n               \r\n            }\r\n        }\r\n\r\n        return false; \r\n    }\r\n\r\n    relationWasSelected (selectedType) \r\n    {\r\n        \r\n        this.ruleKey = \"from\";\r\n        this.relation = this.relations[this.relationOrderIndex];\r\n        this.relationType = selectedType; \r\n        //selected type do object property\r\n        \r\n        let rule = this.rulesJson[selectedType];\r\n        let relationTreePromise;\r\n        \r\n        if(this.relationTreeArr.length === this.relationTreeIndex)\r\n        {\r\n            relationTreePromise = this.getRelatedElements(this.relation,this.ruleKey);\r\n        }\r\n        else\r\n        {\r\n            relationTreePromise = Promise.resolve(this.relationTreeArr);\r\n        }\r\n        \r\n        \r\n        this.relationRuleIndex ++; \r\n\r\n        this.ontoController.addRelation(selectedType, \"\" , \"\", this.relation.uri.value, this.relation.label.value);\r\n  \r\n        return new Promise(resolve => {relationTreePromise.then(results => {\r\n            resolve (this.handleRelatedElements(results,\"relationWasSelected\", this.ruleKey, rule));\r\n\r\n         });});\r\n    }\r\n\r\n    handleRelatedElements (elements, origin, ruleKey, rule) \r\n    {\r\n\r\n\r\n        rule = rule === undefined ? this.rulesJson[this.relationType] : rule;\r\n        this.relationTreeArr = elements; \r\n        this.relationTree = elements[this.relationTreeIndex];\r\n        this.relationTreeIndex ++; \r\n        this.relationIndex = this.relationTree.length - 1; \r\n        \r\n        if (origin === \"relationWasSelected\" || this.ontoController.getOntoElement(this.relationTree[this.relationIndex].uri.value) !== false)\r\n        {\r\n            \r\n            const nextElement = this.getNextElement();\r\n            \r\n            \r\n            let additionalRule = [];\r\n            let fatherType = \"\"; \r\n            let el = false; \r\n            let bObjectChild = false;\r\n            let prevEl = false; \r\n            let lastEl = null;\r\n            if (Array.isArray(nextElement) && nextElement[1] === false)\r\n            {\r\n               \r\n                prevEl = nextElement[0]; \r\n                fatherType = nextElement[0].ontoType; \r\n                const rdfEl = this.getElementByUri(nextElement[0].uri); \r\n                \r\n                if (rdfEl !== false && rdfEl.child.length > 0)\r\n                {\r\n                    \r\n                    el = this.getElementByUri(rdfEl.child[0]);\r\n                    this.selectedEl = el;\r\n                    bObjectChild = true;\r\n                }\r\n                this.ontoController.updateOntoModel(nextElement[0].uri,\"branchIndex\",this.relationRuleIndex,false);\r\n               \r\n                if ((this.relationRuleIndex > 1 || prevEl.fromRelation.length > 0) && !this.additionalRule.index > 0)\r\n                {\r\n                    this.additionalRule.index ++; \r\n                }\r\n            \r\n            }\r\n            else\r\n            {\r\n                this.selectedEl = nextElement; \r\n                el = this.getElementByUri(this.selectedEl.uri.value);\r\n                if (el.father.length > 0)\r\n                {\r\n                  fatherType = this.ontoController.getElementOntoType(el.father[0]); \r\n                }\r\n            }\r\n    \r\n            if (fatherType !== \"\" && fatherType !== false)\r\n            {                \r\n        \r\n                const elements = this.ontoController.getElementsFromBranch(prevEl.uri);\r\n               \r\n                let addIndex = 1; \r\n                let prevAdd = []; \r\n                for (let index in elements)\r\n                {\r\n                    let node = this.ontoController.getOntoElement(elements[index]);\r\n                    if (node.origUri === \"first\")\r\n                    {\r\n                        elements.length = parseInt(index) + parseInt(1); \r\n                        break;\r\n                    }\r\n                }\r\n\r\n              \r\n                for (let index = elements.length - 1; index >= 0; index--) {\r\n                   \r\n                    let element = this.ontoController.getOntoElement(elements[index])\r\n                    additionalRule = this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,false, this.countBTypesInTree(this.relationTree)),element.ontoType, addIndex);\r\n                 \r\n                    if (additionalRule.length > 0)\r\n                    {\r\n                        prevAdd = additionalRule;\r\n                        this.additionalRule.index ++;\r\n                        addIndex = this.additionalRule.index;\r\n                    }\r\n                    else\r\n                    {   \r\n                      \r\n                        if (prevAdd.includes(element.ontoType))\r\n                        {\r\n                            additionalRule = []; \r\n                            break; \r\n                        }\r\n                        else\r\n                        {\r\n                            lastEl = element; \r\n                            this.additionalRule.key = fatherType;\r\n                            additionalRule = prevAdd; \r\n                            break; \r\n                        }\r\n\r\n                    }\r\n\r\n                    if (index === elements.length - 1)\r\n                    {\r\n                        this.additionalRule.key = fatherType;\r\n                        additionalRule = prevAdd; \r\n                    }\r\n                }\r\n\r\n                if (additionalRule.length > 0)\r\n                {\r\n                    this.additionalRule.rule = this.ruleController.getSpecificRule(rule,ruleKey, this.countBTypesInTree(this.relationTree));\r\n                }\r\n            }\r\n          \r\n            if (additionalRule.length === 0)\r\n            {\r\n                if (el === false && bObjectChild === true) \r\n                {\r\n                    return this.nextTreeBranch();\r\n                }\r\n                if (origin !== \"relationWasSelected\"  && bObjectChild === true)\r\n                {\r\n\r\n                    //uprav vztah\r\n                    //tady uprav poslední node ve větvi! -> vlož seller\r\n      \r\n            \r\n                    this.ontoController.updateOntoModel(this.relation.uri.value,ruleKey, prevEl.uri);\r\n\r\n                    this.elementUri = prevEl.uri; \r\n\r\n                    this.lastElInBranch = \"cPhase\";\r\n\r\n\r\n\r\n                    return this.updateRelationTypes(true); \r\n                    \r\n                }\r\n                else if (origin === \"relationWasSelected\" && (bObjectChild === true || prevEl !== false))\r\n                {\r\n                   // diferent branch f\r\n        \r\n                   this.ontoController.updateOntoModel(this.relation.uri.value,ruleKey, prevEl.uri);\r\n                   return this.nextTreeBranch(); \r\n                }\r\n                else\r\n                {\r\n                    this.elementUri = this.selectedEl.uri.value;\r\n                    return this.ruleController.ruleSelection(rule,ruleKey,el,this.ontoController.getLastElement(this.relation.uri.value, this.ruleKey).label,undefined,this.queryTree, this.relation.label.value);\r\n                }\r\n\r\n            }\r\n            else\r\n            {  \r\n                //selectUridle\r\n                if (el !== false)\r\n                {\r\n                    this.elementUri = this.selectedEl.uri.value;\r\n                }\r\n                else\r\n                {\r\n                    this.elementUri = \"\";\r\n                }\r\n                let lastLabel; \r\n                if (lastEl !== null)\r\n                {\r\n                    this.elementUri = lastEl.uri;\r\n                    lastLabel = lastEl.label;\r\n                }\r\n                else\r\n                {\r\n                    lastLabel = prevEl.label;\r\n                }\r\n\r\n                return  this.ruleController.ruleSelection(undefined,ruleKey,el,lastLabel,additionalRule,this.queryTree, this.relation.label.value);\r\n            }\r\n        }\r\n        else\r\n        {\r\n            const rule = this.rulesJson[this.relationType];\r\n            \r\n            //Zkontroluj zda element useless a jaký typ!!! \r\n            this.selectedEl = this.relationTree[this.relationIndex];\r\n\r\n            // check if\r\n            //podívej se jestli se nachází v onto modelu... \r\n            \r\n            //počítá se dle délky pole +1!!\r\n            this.relationIndex --;\r\n    \r\n            this.elementUri = this.selectedEl.uri.value;\r\n        \r\n            return (this.ruleController.ruleSelection(rule,ruleKey,this.selectedEl, this.ontoController.getLastElement(this.relation.uri.value, this.ruleKey).label,undefined,this.queryTree, this.relation.label.value));\r\n        }\r\n\r\n    }\r\n\r\n    getElementsWithoutType (element, elWithoutType)\r\n    {\r\n        const currEl = this.getElementByUri(element.uri.value);\r\n\r\n        if (currEl.child.length > 0)\r\n        {   \r\n            for (let child of currEl.child)\r\n            {\r\n                const childEl = this.getElementByUri(child); \r\n                if (!this.isElementInstace(childEl) && this.ontoController.getOntoElement(childEl.uri.value) === false)\r\n                { \r\n                    elWithoutType.push(childEl);\r\n\r\n                    elWithoutType = this.getElementsWithoutType(childEl,elWithoutType);\r\n                }\r\n            }\r\n        }\r\n        console.log(elWithoutType)\r\n        return elWithoutType; \r\n    }\r\n\r\n    checkElementsInRelationTree (tree, ontoModel) \r\n    {\r\n        let elementsWithoutType = [];\r\n        // let withoutType = true; \r\n        for (let element of tree)\r\n        {\r\n            //element s definovaným type \r\n            \r\n            elementsWithoutType = this.getElementsWithoutType(element, elementsWithoutType); \r\n            // withoutType = true;\r\n              /*\r\n            for (let node of ontoModel)\r\n            {\r\n                if(element.uri.value === node.uri)\r\n                {\r\n                 \r\n                    withoutType = false;\r\n                }\r\n            }\r\n          \r\n            if (withoutType === true && (!this.isElementUseless(element) || this.relation.uri.value === null) && !this.isElementInstace(element))\r\n            {\r\n                alert(element.uri.value + \" SSSSSS\")\r\n                elementsWithoutType.push(element); \r\n            }\r\n            */\r\n        }\r\n        return elementsWithoutType; \r\n    }\r\n\r\n\r\n    getRelatedElements (relation, key) \r\n    {\r\n\r\n        this.elementConsitencyTree = [];\r\n        this.elementConsistencyIndex = 0;\r\n\r\n        this.relationTreeIndex = 0; \r\n        this.relationTreeArr = [];\r\n\r\n        let promiseArr = [];\r\n        \r\n      \r\n        promiseArr.push(this.rdfController.getRelationBTypes(relation[key][this.relationRuleIndex]));\r\n\r\n\r\n        return Promise.all(promiseArr).then(result => {\r\n            console.log(result)\r\n            for (let i = 0; i < result.length; i++) {\r\n                if (result[i].length > 0)\r\n                {\r\n                    result[i].unshift(this.getElementByUri(relation[key][this.relationRuleIndex-1]));\r\n                    //doplnění prop u elementu\r\n                    result[i] = result[i].map(el => el = this.getElementByUri(el.uri.value));\r\n                }\r\n                else\r\n                {\r\n                  \r\n                   result[i] = [this.getElementByUri(relation[key][i])];\r\n                }\r\n            }\r\n            return result; \r\n        })\r\n   \r\n    }\r\n\r\n    \r\n    getNextElement () \r\n    {\r\n        //koko\r\n \r\n        if(this.relationIndex < 0)\r\n        {\r\n            return false; \r\n        }\r\n\r\n        const ontoModel = this.ontoController.getOntoModel();\r\n        let returnEl;\r\n        if (this.isElementUseless(this.relationTree[this.relationIndex]))\r\n        {\r\n            this.relationIndex --;\r\n        }\r\n         \r\n        //ověření zda už nebyl element určen\r\n    \r\n        for (let index = 0; index < ontoModel.length; index ++) \r\n        {\r\n            if (this.relationTree[this.relationIndex] !== undefined && ontoModel[index].uri === this.relationTree[this.relationIndex].uri.value)\r\n            {\r\n                //Check on another samples \r\n                if (this.areChildrenInBranchUseless(this.relationTree[this.relationIndex]))\r\n                {\r\n                    const lastRel = ontoModel[index].fromRelation[ontoModel[index].fromRelation.length - 1]; \r\n                    const lastDirection = ontoModel[index].direction[ontoModel[index].direction.length - 1]; \r\n                    \r\n                    let lastElement = this.ontoController.getLastElementUri(lastRel,lastDirection);  \r\n                    \r\n\r\n                    while (this.ontoController.getCardinalElement(lastElement, false) !== false)\r\n                    {\r\n                        lastElement = this.ontoController.getCardinalElement(lastElement,false);\r\n                    }\r\n                   \r\n                    lastElement = this.ontoController.getElementInRelRow(lastElement);\r\n            \r\n                    lastElement = this.ontoController.getOntoElement(lastElement);\r\n\r\n\r\n\r\n                    const allBranchBtypes = this.ontoController.getOntoBranch(lastRel, lastDirection); \r\n         \r\n                    //btype může jít do více realtionů\r\n                    for (let el of allBranchBtypes)\r\n                    {\r\n                        this.ontoController.addToProperty(el.uri, \"fromRelation\", this.relation.uri.value);\r\n                        this.ontoController.addToProperty(el.uri, \"direction\", this.ruleKey);\r\n                    }\r\n               \r\n                    return [lastElement, false];  \r\n                }\r\n                this.relationIndex --;\r\n                index = 0;  \r\n            }\r\n            \r\n        }  \r\n      \r\n        returnEl = this.relationTree[this.relationIndex];\r\n        \r\n        returnEl = returnEl === undefined ? false : returnEl;\r\n        this.relationIndex --; \r\n        return returnEl;\r\n    }\r\n\r\n    areChildrenInBranchUseless (element)\r\n    {\r\n        if (element.childRel.includes(\"http://lod2-dev.vse.cz/ontology/puro#subTypeOf\"))\r\n        {\r\n           return false;\r\n        }\r\n\r\n        return true; \r\n    }\r\n\r\n    isElementInstace (element) \r\n    {\r\n        for (let node of this.queryTree)\r\n        {\r\n           \r\n            if (element.uri.value === node.uri.value  )\r\n            {\r\n                for (let type of node.fatherTypeRelation)\r\n                {\r\n                    if (this.delUri(type) === \"instanceOf\")\r\n                    {\r\n                        return true; \r\n                    }\r\n                }\r\n            \r\n            }\r\n        }\r\n        return false; \r\n    } \r\n    \r\n    checkElementsConsistency  (relation,ruleKey) \r\n    {\r\n        //tady se to může projet od začátku do konce zas tolik to nevádí :) \r\n        let ontoModel = this.ontoController.getOntoModel();\r\n        let consistencyIndex = 0; \r\n        const consistencyTree = []; \r\n\r\n        for (let node of ontoModel)\r\n        {\r\n            if (node.fromRelation.includes(relation) && node.direction[node.direction.length - 1] === ruleKey && node.branchIndex.includes(this.relationRuleIndex))\r\n            {\r\n            \r\n                consistencyTree.push(node); \r\n            }\r\n        }\r\n\r\n   \r\n       \r\n        if (consistencyTree.length === 0)\r\n        {\r\n            return consistencyTree; \r\n        }\r\n        \r\n        let elementTypes = this.ruleController.elementConsistencyRules(consistencyTree[consistencyIndex],this.ontoController);\r\n        //nejsem si jist druhou podmínkou ale \r\n        \r\n        consistencyIndex ++;\r\n\r\n\r\n        while (consistencyIndex < consistencyTree.length && elementTypes.length === 0)\r\n        {\r\n            \r\n            elementTypes = this.ruleController.elementConsistencyRules(consistencyTree[consistencyIndex], this.ontoController);\r\n            consistencyIndex ++; \r\n        }\r\n      \r\n\r\n        return elementTypes; \r\n    }\r\n\r\n    // element ve formátu queryTree!!\r\n    isElementUseless (element) \r\n    {\r\n      \r\n        if ('child' in element) {\r\n            if (element.child.length === 0 && element.connect.length === 0 && element.connectFrom.length === 0)\r\n            {       \r\n               \r\n                return true; \r\n            }\r\n        } \r\n        return false; \r\n    }\r\n\r\n    getElementByUri (uri) \r\n    {\r\n        for (let node of this.queryTree)\r\n        {\r\n            if (node.uri.value === uri) {\r\n                return node; \r\n            }\r\n        }\r\n        return false; \r\n    }\r\n\r\n    changeElementsProperty (uri, property, value)\r\n    {\r\n        for (let i = 0; i < this.queryTree.length; i++) {\r\n            if (this.queryTree[i].uri.value === uri)\r\n            {\r\n                this.queryTree[i][property].value = value;\r\n                return true; \r\n            }\r\n        }\r\n        return false; \r\n    }\r\n\r\n    checkDuplicity (elName) \r\n    {\r\n        return this.ontoController.checkDuplicity(elName);\r\n    }\r\n     \r\n    getConnectedElements (rule, elements) \r\n    {\r\n        let result = [];\r\n        for (let element of elements)\r\n        {\r\n            let ontoType = this.ontoController.getElementOntoType(element);\r\n\r\n            if (ontoType === false || rule[this.ruleIndex].connect.includes(ontoType))\r\n            {\r\n                let name = (ontoType !== false) ? this.delUri(element)+ \" [\"+ontoType+\"]\" : this.delUri(element);\r\n                result.push({\"name\": name, \"uri\":element})\r\n            }\r\n            \r\n        }\r\n        return result;\r\n    }\r\n\r\n    setIndexexToDefault  ()  \r\n    {      \r\n        this.valuationArr = null;  \r\n\r\n        this.relationRuleIndex = 0; \r\n\r\n        this.relationTree = {};\r\n        this.relationTreeIndex = 0; \r\n        this.relationTreeArr =[];\r\n        this.elementsWithoutType = [];\r\n        this.withoutTypeIndex = 0; \r\n\r\n        this.elementConsistencyIndex = 0; \r\n        this.elementConsitencyTree = [];\r\n\r\n        this.elementUri = \"\";\r\n        this.ruleKey = \"\";\r\n        this.type = \"\";\r\n\r\n\r\n        this.selectedEl = {};\r\n        this.elSettings = {};\r\n\r\n        this.lastElInBranch = false; \r\n\r\n\r\n        this.additionalRule = {key: undefined, rule: {}, index: 1}; \r\n\r\n\r\n        this.consistencyExeption = []; \r\n        // Nový začátek \r\n\r\n    }\r\n\r\n    saveHistory (record, inputVariables)\r\n    {\r\n        if (this.historyController.propertiesHistory.length === 0)\r\n        {\r\n            let initRec = {};\r\n            for (let key in record) \r\n            {\r\n               \r\n                if (record[key] === \"queryTree\")\r\n                {\r\n                    initRec[key] = JSON.parse(JSON.stringify(this.queryTree));\r\n                }\r\n                else if (typeof record[key] === \"string\")\r\n                {\r\n                    initRec[key] = \"\"; \r\n                }\r\n                else if (typeof record[key] === \"number\") \r\n                {\r\n                    initRec[key] = 0;\r\n                }\r\n                else if (Array.isArray(record[key]))\r\n                {\r\n                    initRec[key] = []\r\n                }\r\n                else if (typeof record[key] === \"object\")\r\n                {\r\n                    initRec[key] = {}\r\n                }\r\n            }\r\n            this.historyController.init(initRec);\r\n        }\r\n\r\n\r\n        this.historyController.saveRecords(record,JSON.parse(JSON.stringify(this.ontoController.getOntoModel())), inputVariables);\r\n    }\r\n  \r\n    undo()\r\n    {\r\n        const history = this.historyController.undo(); \r\n\r\n\r\n        if (history.ontoModel === undefined && history.properties === undefined)\r\n        {\r\n  \r\n            this.historyController.reset();\r\n            this.ontoController.undo([]);\r\n            this.setIndexexToDefault();\r\n            this.elSettings = {};\r\n            this.relationOrderIndex = 0;\r\n            this.relationRuleIndex = 0; \r\n            this.relation = {};\r\n            this.relationIndex = 0; \r\n            this.relationType = \"\"; \r\n            return false; \r\n        }\r\n        this.ontoController.undo(history.ontoModel);\r\n\r\n        console.log(JSON.parse(JSON.stringify(this.additionalRule)))\r\n        for (let prop in history.properties)\r\n        {\r\n            if (typeof history.properties[prop] === \"object\")\r\n            {\r\n                console.log(prop)\r\n                console.log(JSON.parse(JSON.stringify(this[prop])))\r\n                this[prop] = JSON.parse(JSON.stringify(history.properties[prop]))\r\n                \r\n            }\r\n            else\r\n            {\r\n                this[prop] = history.properties[prop]; \r\n            }\r\n            \r\n        }\r\n        console.log(JSON.parse(JSON.stringify(this.additionalRule)))\r\n        return {inputVariables: history.inputVariables};\r\n    }\r\n\r\n    getOntoSchema ()\r\n    {\r\n        return this.ontoSchemaController.transform(this.ontoController.getOntoModel());\r\n    }\r\n\r\n    getIframeURL ()\r\n    {\r\n\r\n        return this.rulesJson[\"iframeURL\"].replace(\"MODELID\",this.modelId); \r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport 'bootstrap/dist/js/bootstrap.bundle.min';\nimport './App.css';\nimport $ from 'jquery';\nimport fileDownload from 'js-file-download';\nimport mermaid from \"mermaid\";\nimport EventController from './controllers/EventController.js';\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\nimport Iframe from 'react-iframe';\n\n\n\n\n\n\n\n//import RdfController from './controllers/RdfController.js';\n//import { thisTypeAnnotation } from \"@babel/types\";\n\n//přiřadit key k talčítkům -> zamyslet se nad využitím \nclass Layout extends React.Component {\n  constructor(props) {\n    super(props);\n\n\n\n    this.eventController = new EventController();\n    this.state = {\n      svg: \"\", iframeURL: this.eventController.getIframeURL()\n    };\n\n    mermaid.initialize({\n      startOnLoad: false,\n      themeCSS: '#extensionEnd { fill: white; } #extensionStart { fill: white; }',\n    });\n  }\n\n  createGraph = (svg) => {\n\n    this.setState({ svg: svg });\n  }\n\n  render() {\n    return (\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"form-group col-md-6\" id=\"puroModelContainer\">\n            <label htmlFor=\"puroModel\">Puro model</label>\n            <div className=\"transformWindow border\" id=\"puroModel\">\n              <Iframe url= {this.state.iframeURL}\n                width=\"607px\"\n                height=\"307px\"\n                id=\"iframePuro\"\n                className=\"myClassname\"\n                display=\"initial\"\n                position=\"relative\"/>\n            </div>\n          </div>\n\n          <div className=\"form-group col-md-6\" id=\"ontoModelContainer\">\n            <TransformWrapper\n              enablePadding={false}>\n              {({ zoomIn, zoomOut, resetTransform, ...rest }) => (\n                <React.Fragment>\n                  <div className=\"tools\">\n                    <label htmlFor=\"ontoModel\">Onto model</label>\n                    <button className=\"toolBtn btn-sm btn-light\" onClick={resetTransform}>Unzoom</button>\n                  </div>\n                  <div className=\"border\">\n                    <TransformComponent>\n                      <div dangerouslySetInnerHTML={{ __html: this.state.svg }} className=\"transformWindow\" id=\"ontoModel\">\n                      </div>\n                    </TransformComponent>\n                  </div>\n                </React.Fragment>\n              )}\n            </TransformWrapper>\n          </div>\n          <QuestionPart graphCreation={this.createGraph} eventController={this.eventController} />\n        </div>\n      </div>\n    );\n  }\n\n}\n\n\n\nclass PuroModel extends React.Component {\n\n  // $(\"#iFrameId\").contents().find(\"#yourDiv\").empty();\n\n\n  render() {\n    return <iframe onLoad={this.loaded} title=\"puro-model\" id=\"iframePuro\" className=\"embed-responsive-item\" src={this.props.iframeURL}></iframe>;\n  }\n\n\n}\n\n\nclass QuestionPart extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      startTransform: true, originalName: \"\", nameWasChange: false,\n      buttons: [], changeName: false, elName: \"\", type: \"\", undoActive: false, svg: \"\"\n    };\n\n    this.eventController = this.props.eventController;\n  }\n\n  handleChange = (event) => {\n    this.setState({ elName: event.target.value });\n  }\n\n  handleSubmit = (event) => {\n    if (event !== undefined) {\n      event.preventDefault();\n    }\n\n    //window.addEventListener('unhandledrejection', function(event) {\n    //alert(\"Rule is not defined!\\nOnly the first answer is correct! \\nRules are not complete yet!\\nPage will be reloaded!\");\n    //window.location.reload(); \n    //});\n\n    this.eventController.getDefault(true).then(results => {\n      this.setState({ undoActive: false, svgUrl: \"\", buttons: results.buttons, title: results.title, originalName: results.originalName, type: results.type, startTransform: false });\n    });\n\n  }\n\n  undoClick = () => {\n\n\n\n  }\n\n  handleClick = (selectedType, selectedUri, type) => {\n    let elName = this.state.elName;\n    let undo = false;\n    let setState = true;\n    let nameWasChange = this.state.nameWasChange;\n\n    if ((elName === \"\" && this.state.changeName === true && type !== \"Undo\") && selectedType.toLowerCase() !== \"none\") {\n      alert(\"Plese write name of the element!\");\n    }\n    else if (elName !== \"\" && !elName.match(/^[A-Za-z0-9-_*<>]+$/)) {\n      alert(\"Please change the name. It contains forbidden characters!\");\n    }\n    else {\n      if (type === \"Undo\") {\n\n        const history = this.eventController.undo();\n        if (history === false) {\n          this.handleSubmit();\n          setState = false;\n        }\n        else {\n          const inputVariables = history.inputVariables;\n          selectedType = inputVariables[0];\n          selectedUri = inputVariables[1];\n          type = inputVariables[2];\n          elName = inputVariables[3];\n          nameWasChange = inputVariables[4];\n\n          undo = true;\n        }\n\n      }\n      elName = elName.replace(/\\s/g, '_');\n\n      if (elName !== \"\" && this.state.changeName === true && !this.eventController.checkDuplicity(elName)) {\n        alert(\"Element already exists! Please choose different name.\")\n      }\n      else if (setState === true) {\n\n        this.eventController.nextElement(selectedType, selectedUri, type, elName, nameWasChange).then(results => {\n\n          if (undo === false) {\n            let properties = (Object.getOwnPropertyNames(this.eventController));\n            let historyRecord = {};\n            for (let prop of properties) {\n              if (!prop.includes(\"Controller\") && prop !== \"rulesJson\" && prop !== \"relations\") {\n                if (typeof prop !== 'function') {\n                  historyRecord[prop] = this.assignProp(this.eventController[prop])\n                }\n              }\n            }\n\n            this.eventController.saveHistory(historyRecord, [selectedType, selectedUri, type, elName, this.state.nameWasChange]);\n          }\n\n          let svg = this.eventController.getGraphSvg();\n\n          this.setState({ buttons: results.buttons, type: results.type, title: results.title, undoActive: true, elName: \"\", changeName: results.elName, originalName: results.originalName, nameWasChange: false });\n\n          if (svg !== false) {\n            this.createGraph(svg);\n          }\n\n          if (this.state.type.includes(\"end\")) {\n            this.handleDownloadImage();\n          }\n\n        });\n      }\n    }\n  }\n\n\n\n  assignProp = (prop) => {\n\n    if (Array.isArray(prop) || typeof prop === 'object') {\n      //how to \n      return JSON.parse(JSON.stringify(prop));\n    }\n    else {\n      return prop;\n    }\n\n  }\n\n  createGraph = (chart) => {\n\n    const cb = svg => {\n      this.setState({ svg: svg });\n      this.props.graphCreation(svg);\n    };\n    mermaid.render('id1', chart, cb);\n  }\n\n  handleChangeName = () => {\n\n\n    this.setState({ changeName: !this.state.changeName });\n    if (this.state.changeName === true) {\n      this.setState({ elName: \"\", nameWasChange: false });\n      $(\".changeAlert\").fadeTo(1400, 500).slideUp(500, function () {\n        $(\".changeAlert\").alert('fade');\n      });\n    }\n    else {\n      this.setState({ elName: \"\", nameWasChange: true });\n\n    }\n  }\n\n  handleDownloadImage = () => {\n    const svgBlob = new Blob([this.state.svg], { type: \"image/svg+xml;charset=utf-8\" });\n    const svgUrl = URL.createObjectURL(svgBlob);\n    this.setState({ svgUrl: svgUrl });\n\n  }\n\n  handleDownloadSchema = () => {\n    const ontoSchema = JSON.stringify(this.eventController.getOntoSchema());\n    fileDownload(ontoSchema, 'ontoSchema.json');\n  }\n\n  render() {\n    return (\n      <div className=\"container-fluid text-center questionPart\">\n\n        <button type=\"Submint\" className={this.state.startTransform ? \"btn btn-primary\" : \"d-none\"} data-toggle=\"modal\" data-target=\"#exampleModal\" onClick={this.handleSubmit}>\n          Start transformation\n          </button>\n        <div className={this.state.startTransform ? \"d-none\" : \"\"}>\n          <h3 className=\"questionTitle\">{this.state.title}</h3>\n          <div className=\"optionButtons d-none d-md-block\">\n            <div className=\"btn-group-vertical text-right\">\n              <button type=\"button\" className=\"btn btn-primary btnModal\" onClick={this.handleChangeName} disabled={this.state.originalName === \"\" || this.state.type.includes(\"ontoRelation\") || this.state.type.includes(\"end\") || this.state.type === \"nextBranchElements\"}>{this.state.changeName === true && this.state.originalName !== \"\" ? \"Set original name\" : \"Change name\"}</button>\n              <button type=\"button\" className=\"btn btn-primary btnModal\" onClick={() => this.handleClick(undefined, undefined, \"Undo\")} disabled={!this.state.undoActive}>Undo</button>\n              <button type=\"button\" className=\"btn btn-secondary btnModal\" data-dismiss=\"modal\" onClick={(e) => { if (window.confirm('Are you sure you want to cancel the transformation?')) window.location.reload(); }}>Cancel</button>\n            </div>\n          </div>\n          <div className={this.state.changeName === true ? 'col-md-6 mx-auto' : 'd-none'}>\n            <div className=\"input-group inputName\">\n              <div className=\"input-group-prepend\">\n                <span className=\"input-group-text\" id=\"\">Name of the element:</span>\n              </div>\n              <input placeholder={this.state.originalName === \"\" ? \"Write name of the element!\" : this.state.originalName} type=\"text\" className=\"form-control\" onChange={this.handleChange} value={this.state.elName}></input>\n            </div>\n            <h5 className={this.state.buttons.lenght > 1 ? \"text-center inputName\" : \"d-none\"}>Select element's class:</h5>\n          </div>\n          <div className=\"divButtons text-center\">\n            <TypeButtons buttons={this.state.buttons} title = {this.state.title} onClickDownloadSchema={this.handleDownloadSchema} svgUrl={this.state.svgUrl} onClick={this.handleClick} type={this.state.type} elNames={this.state.changeName} originalName={this.state.originalName} />\n          </div>\n          <div class=\"alert alert-success col-md-6 mx-auto changeAlert\" role=\"alert\">\n            Original name of the element was set!\n        </div>\n        </div>\n      </div>\n    );\n  }\n\n}\n\nclass TypeButtons extends React.Component {\n  constructor(props) {\n    super(props);\n    this.refs = React.createRef();\n  }\n\n\n  render() {\n    if (this.props.type.includes(\"ontoRelation-save\")) {\n      return (\n        <div className=\"row col-md-5 mx-auto\">\n          <label className=\"label label-default col-md-6 mx-auto form-control\">{this.props.elNames[0]}</label>\n          <label className=\"label label-default col-md-6 mx-auto form-control\">{this.props.elNames[1]}</label>\n          <select ref=\"relFrom\" className=\"col-md-6 mx-auto form-control cardinalitySelect\">\n            {this.props.buttons.filter((val) => {\n              return val.direction === \"from\";\n            }).map((rel) => {\n              return <option value={rel.name}>{rel.name}</option>\n            })}\n          </select>\n\n          <select ref=\"relTo\" className=\"col-md-6 mx-auto form-control cardinalitySelect\">\n            {this.props.buttons.filter((val) => {\n              return val.direction === \"to\";\n            }).map((rel) => {\n              return <option value={rel.name}>{rel.name}</option>\n            })}\n          </select>\n\n          <button className=\"btn btn-success mx-auto questionPart\" onClick={() => this.props.onClick([this.refs.relFrom.value, this.refs.relTo.value], null, this.props.type)}>Next</button>\n        </div>\n      )\n    }\n    else if (this.props.type.includes(\"end\")) {\n      return (\n        <div className=\"col-md-8 mx-auto\">\n          <a className=\"btn btn-success btnEnd\" href={this.props.svgUrl} download=\"ontoUml-graph.svg\">Download Onto-UML graph</a>\n          <button type=\"button\" className=\"btn btn-success btnEnd\" onClick={() => this.props.onClickDownloadSchema()}>Download Onto-Schema</button>\n        </div>\n      );\n    }\n    else {\n      return (\n        <div className=\"row col-md-6 mx-auto\">\n          {this.props.buttons.map((value) => {\n            return <div className=\"col-md-4 mx-auto\">\n              <button key={this.props.uri} type=\"button\" className={value.name.toLowerCase() === \"none\" ? \" btn btn-secondary btnModal\" : \"btn btn-success btnModal\"} onClick={() => this.props.onClick(value.name, value.uri, this.props.type, value.origin)} >{(this.props.type.includes(\"dataType\") || \n              this.props.title.includes(value.name) || (this.props.originalName === \"\" && this.props.buttons.length === 1) || (value.name.toLowerCase() === \"relator\" && this.props.buttons.length === 1)) ? \"Next\" : value.name}</button>\n            </div>\n          })}\n        </div>\n      )\n    }\n\n  }\n}\n\nclass App extends React.Component {\n\n  render() {\n    return [<Layout />]\n\n  }\n}\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}