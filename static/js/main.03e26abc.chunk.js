(this["webpackJsonppuro-onto"]=this["webpackJsonppuro-onto"]||[]).push([[0],{381:function(e,t,n){e.exports=n(869)},388:function(e,t,n){},393:function(e,t){},395:function(e,t){},428:function(e,t){},429:function(e,t){},659:function(e,t,n){var r={"./locale":305,"./locale.js":305};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=659},677:function(e,t){},683:function(e,t){},696:function(e,t){},697:function(e,t){},710:function(e,t){},712:function(e,t){},754:function(e,t){},756:function(e,t){},795:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=795},823:function(e,t,n){var r={"./N3Lexer":197,"./N3Lexer.js":197,"./N3Parser":198,"./N3Parser.js":198,"./N3Store":360,"./N3Store.js":360,"./N3StreamParser":361,"./N3StreamParser.js":361,"./N3StreamWriter":362,"./N3StreamWriter.js":362,"./N3Util":199,"./N3Util.js":199,"./N3Writer":200,"./N3Writer.js":200};function o(e){var t=i(e);return n(t)}function i(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=823},826:function(e,t){},869:function(e,t,n){"use strict";n.r(t);var r=n(379),o=n(0),i=n(1),l=n(5),a=n(6),s=n(7),u=n(2),h=n.n(u),c=n(374),d=n.n(c),f=(n(386),n(387),n(388),n(50)),y=n.n(f),p=n(375),v=n.n(p),m=n(205),g=n.n(m),T=n(17),b=n.n(T),E=n(88),O=function(){function e(){var t;Object(o.a)(this,e),this.ontologyURL="http://lod2-dev.vse.cz/ontology/puro#",this.ontoUri="http://lod2-dev.vse.cz/data/ontomodels#",y.a.ajax({type:"GET",url:"rules.json",async:!1,cache:!1,dataType:"json",success:function(e){t=e}}),this.rulesJson=JSON.parse(JSON.stringify(t));var n=new URL(window.location.href);this.modelId=n.searchParams.get("model")}return Object(i.a)(e,[{key:"createButtons",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=(e=Array.isArray(e)?e:[e]).map((function(e){return{name:e}}));return Promise.resolve({buttons:i,title:t,type:n,elName:r,originalName:o})}},{key:"getQuestion",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,l=this.rulesJson.questions[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if(a.type===t){var s="string"===typeof e?e:e.label;return a.question.replace("VAL",s)}}}catch(u){r=!0,o=u}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}}},{key:"createQuestion",value:function(e,t){var n="";if("question"in e.rule){var r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;if(s.type===e.rule.question){n=s.question;break}}}catch(c){o=!0,i=c}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}console.log(e),n=""===n?e.rule.question:n;var u=e.key in e.rule?e.rule[e.key][0]:e.rule.type[0];return n.replace("VAL",e.elLabel).replace("TYPE",u)}var h=this.isSameCaseInsensitive(e.key,"connect")?" to ":" of ";return"What is "+e.key+h+e.elLabel+"?"}},{key:"countBTypesInTree",value:function(e){var t=0,n=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;"BType"!==this.delUri(a.type.value)||a.fatherTypeRelation.includes("http://lod2-dev.vse.cz/ontology/puro#instanceOf")||t++}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return t}},{key:"delUri",value:function(e){var t=[];if("string"===typeof e)return e.split("#")[1];if(Array.isArray(e)){var n=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;t.push(a.split("#")[1])}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return t}return""}},{key:"getKeyByValue",value:function(e,t){return Object.keys(e).find((function(n){return e[n]===t}))}},{key:"isSameCaseInsensitive",value:function(e,t){return 0===e.localeCompare(t,void 0,{sensitivity:"base"})}},{key:"getOpositeDirection",value:function(e){return"from"===e?"to":"from"}}]),e}(),R=function(e){function t(){var e,r;Object(o.a)(this,t),(e=Object(l.a)(this,Object(a.a)(t).call(this))).rdf=n(868);var i=e.rulesJson.modelURL.replace("MODELID",e.modelId);return y.a.ajax({type:"GET",url:i,async:!1,cache:!1,dataType:"xml",success:function(e){this.puroXML=e,console.log(this.puroXML),r=e},error:function(e,t,n){alert("There is the problem to load serialized PURO model! \n"+n)}}),e.puroXML=r,e}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getRelatorBtype",value:function(e,t){var n=this,r="\n            PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n            SELECT ?element ?valuation ?elementLabel ?type ?father ?fatherLabel ?elementType ?fatherType WHERE \n            {\n                {<"+e+"> puro:linkedTo ?element . <"+t+"> puro:linkedTo <"+e+">} \n                UNION\n                {?element puro:linkedTo <"+e+"> . <"+e+"> puro:linkedTo <"+t+">}    \n                {?element a puro:BObject}\n                UNION\n                {?element a puro:BType}\n                ?element rdfs:label ?elementLabel .\n                ?element a ?elementType .  \n                OPTIONAL {?element puro:instanceOf ?father}\n                OPTIONAL {?father rdfs:label ?fatherLabel}\n                OPTIONAL {?father a ?fatherType}\n                OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n               \n               \n            }";return new Promise((function(t){n.sparqlQuery(r,(function(n){(n=this.deleteDuplicity(n,["valuation"])).relationName=e,t(n)}))}))}},{key:"findBTypeRelation",value:function(e,t,n){var r=e.uri.value,o="\n             PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n             PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n             SELECT ?uri ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \n             {\n                 {<"+r+"> puro:instanceOf ?uri }\n                 UNION\n                 {<"+r+"> puro:subTypeOf  ?uri }\n                 ?uri a ?type . \n                 ?uri rdfs:label ?label .         \n             }";this.sparqlQuery(o,function(e){if(console.log(JSON.parse(JSON.stringify(e))),!((e=this.deleteDuplicity(e,["connect","connectFrom","father","fatherType","fatherTypeRelation","child","childType","childRel"])).length>0))return n(t),t;for(var r in e)t.push(e[r]),this.findBTypeRelation(e[r],t,n)}.bind(this))}},{key:"findBTypeChild",value:function(e,t,n){var r=this,o=e.uri.value,i="\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT ?uri ?valuation ?valuationLabel ?label ?father ?fatherType ?type ?fatherTypeRelation ?connect ?connectFrom ?child ?childType ?childRel WHERE \n                 {\n                     {?uri puro:instanceOf <"+o+">}\n                     UNION\n                     {?uri puro:subTypeOf <"+o+">}\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri}}\n                     OPTIONAL {?child a ?childType}\n                     OPTIONAL {{?child ?childRel ?uri} UNION {?child ?childRel ?uri}}\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n                     ?uri ?fatherTypeRelation <"+o+"> .\n                     ?uri rdfs:label ?label .\n                     ?uri a ?type . \n                     <"+o+"> a ?fatherType\n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\n                     OPTIONAL {?connectFrom puro:linkedTo ?uri. ?connectFrom a puro:BRelaion}\n                     BIND ( <"+o+">  AS ?father)\n                 }";this.sparqlQuery(i,(function(e){if(!((e=r.deleteDuplicity(e,["connect","connectFrom","father","fatherType","fatherTypeRelation","child","childType","childRel","valuation"])).length>0))return n(t),t;for(var o in e)t.push(e[o]),r.findBTypeChild(e[o],t,n)}))}},{key:"getFullPath",value:function(){var e=this;return new Promise((function(t){e.sparqlQuery("\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT ?uri ?valuation ?label ?type ?connect ?child ?fatherType ?father ?fatherTypeRelation ?childType ?childRel WHERE \n                 {\n                     ?uri rdfs:label ?label .\n                     ?uri a puro:BType . \n                     ?uri a ?type\n                     OPTIONAL {{?child puro:instanceOf ?uri} UNION {?child puro:subTypeOf ?uri} ?child a ?childType . ?child ?childRel ?uri . } \n                     OPTIONAL {?uri puro:linkedTo ?connect. ?connect a puro:BRelation}\n                     OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation}\n                     FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                     FILTER NOT EXISTS {?uri puro:instanceOf ?object}\n                 }",(function(n){n.forEach((function(e){e.father=[],e.fatherType=[],e.fatherTypeRelation=[],e.connectFrom=[]})),e.deleteDuplicity(n,["valuation","connect","childType","child","childRel"]),e.recursiveFindChild(0,n,[],(function(n){n=e.deleteDuplicityInFinal(n),t(n)}))}))}))}},{key:"deleteDuplicityInFinal",value:function(e){for(var t=function(t){for(var n=0;n<e.length;n++)if(e[t].uri.value===e[n].uri.value&&t!==n){var r=function(r){Array.isArray(e[t][r])&&(e[n][r]=e[n][r].filter((function(n){return n!==e[t][r]})),e[t][r]=e[t][r].concat(e[n][r]))};for(var o in e[t])r(o);e.splice(n,1)}},n=0;n<e.length;n++)t(n);return e}},{key:"recursiveFindChild",value:function(e,t,n,r,o){var i=this;if(e>=t.length)return r(n),n;n.push(t[e]),"relation"===o?this.findBTypeRelation(t[e],n,(function(o){e++,i.recursiveFindChild(e++,t,n,r,"relation")})):this.findBTypeChild(t[e],n,(function(l){e++,i.recursiveFindChild(e++,t,n,r,o)}))}},{key:"sparqlQuery",value:function(e,t){var r,o=(new XMLSerializer).serializeToString(this.puroXML),i=this.rdf.graph();this.rdf.parse(o,i,"http://lod2-dev.vse.cz/","application/rdf+xml"),this.rdf.serialize(void 0,i,"http://www.w3sds.org/1999/02/22-rdf-syntax-ns#type","text/turtle",(function(e,t){r=t})),n(815).create((function(n,o){o.load("text/turtle",r,(function(n,r){o.execute(e,(function(e,n){t(n)}))}))}))}},{key:"getRelationBTypes",value:function(e){var t=this,n="\n                 PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                 PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                 SELECT  ?uri ?type ?label  WHERE \n                 {\n                     {<"+e+"> puro:instanceOf ?uri}\n                     UNION\n                     {<"+e+"> puro:subTypeOf ?uri}\n                     ?uri a ?type .\n                     ?uri rdfs:label ?label\n                 }";return new Promise((function(e){t.sparqlQuery(n,(function(n){console.log(n),t.recursiveFindChild(0,n,[],(function(t){e(t)}),"relation")}))}))}},{key:"getRelations",value:function(){var e=this;return new Promise((function(t){e.sparqlQuery("\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?valuation ?from ?to ?toType ?fromType ?label ?type  WHERE \n                {\n                  ?uri a puro:BRelation . \n                  ?from puro:linkedTo ?uri .\n                  ?uri puro:linkedTo ?to .\n                  ?uri rdfs:label ?label . \n                  ?uri a ?type .\n                  OPTIONAL {?uri puro:linkedTo ?valuation. ?valuation a puro:BValuation} \n                  FILTER NOT EXISTS{?to a puro:BAttribute}\n                  FILTER NOT EXISTS{?from a puro:BAttribute}\n                  FILTER NOT EXISTS{?to a puro:BValuation}\n                  FILTER NOT EXISTS{?from a puro:BValuation}\n                  ?to a ?toType . \n                  ?from a ?fromType .\n                }",function(e){e=this.deleteDuplicity(e,["from","to","toType","fromType","valuation"]),console.log(e),t(e)}.bind(e))}))}},{key:"findRelation",value:function(e){var t=this,n="\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label  WHERE \n                {\n                  <"+e+"> puro:linkedTo ?uri . \n                }";return new Promise((function(e){t.sparqlQuery(n,(function(t){e(t)}))}))}},{key:"firstFind",value:function(){var e=Object(E.a)(b.a.mark((function e(){var t=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label ?child WHERE \n                {\n                    {?child puro:instanceOf ?uri}\n                     UNION\n                    {?child puro:subTypeOf ?uri}\n                    ?uri rdfs:label ?label. asfadf\n                    ?uri a puro:BType\n                    FILTER NOT EXISTS {?uri puro:linkedTo ?obj}\n                    FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                }",e.abrupt("return",new Promise((function(e){t.sparqlQuery("\n                PREFIX puro: <http://lod2-dev.vse.cz/ontology/puro#>\n                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n                SELECT ?uri ?label ?child WHERE \n                {\n                    {?child puro:instanceOf ?uri}\n                     UNION\n                    {?child puro:subTypeOf ?uri}\n                    ?uri rdfs:label ?label. asfadf\n                    ?uri a puro:BType\n                    FILTER NOT EXISTS {?uri puro:linkedTo ?obj}\n                    FILTER NOT EXISTS {?uri puro:subTypeOf ?object}\n                }",(function(t){e(t)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDuplicity",value:function(e,t){var n,r=[],o=!0,i=!1,l=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value,h=!0,c=!1,d=void 0;try{for(var f,y=t[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var p=f.value;null===u[p]?u[p]=[]:u[p]=[u[p].value]}}catch(R){c=!0,d=R}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}}catch(R){i=!0,l=R}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}for(var v=e.length-1;v>=0;v--)if(r.includes(e[v].uri.value)){var m=!0,g=!1,T=void 0;try{for(var b,E=function(){for(var t=b.value,r=function(r){if(n=e[v][t],e[r].uri.value===e[v].uri.value){if(!n.some((function(n){return e[r][t].includes(n)})))return e[r][t]=e[r][t].concat(n),"break";if(t.includes("Type")&&e[r][t.split("Type")[0]].length!==e[r][t].length)return e[r][t]=e[r][t].concat(n),"break"}},o=e.length-1;o>=0;o--){if("break"===r(o))break}},O=t[Symbol.iterator]();!(m=(b=O.next()).done);m=!0)E()}catch(R){g=!0,T=R}finally{try{m||null==O.return||O.return()}finally{if(g)throw T}}e.splice(v,1)}else r.push(e[v].uri.value);return e}}]),t}(O),C=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(a.a)(t).call(this))).addToOntoModel=function(t,n,r,o,i,l,a,s,u,h,c){var d,f,y;!1===e.getOntoElement(e.ontoUri+a)?(s=void 0!==s&&s,c=void 0===c?"":c,""!==a&&void 0!==a&&!1===s?(d=!1,f=a,y=e.ontoUri+a):(d=o,f=s?a:n,y=t),!1===e.getOntoElement(y)&&e.ontoModel.push({uri:y,label:f,ontoType:r,puroType:d,fromRelation:[i],direction:[l],from:[void 0],to:[void 0],type:"Class",branchIndex:[h],origUri:c})):(t=u+a,e.updateOntoModel(t,"fromRelation",i),e.updateOntoModel(t,"direction",l),e.updateOntoModel(t,"branchIndex",h));return console.log(e.ontoModel),e.ontoModel},e.addRelation=function(t,n,r,o,i,l,a){o=void 0===o?e.ontoUri.slice(0,-1)+"/relation/"+t+"/"+e.delUri(n)+e.delUri(r):o,l=void 0===l?[]:[l],a=void 0===a?[]:[a],n=void 0===n||0===n.length?[]:[n],r=void 0===r||0===r.length?[]:[r];var s=!0,u=!1,h=void 0;try{for(var c,d=e.ontoModel[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var f=c.value;if("relation"===f.type&&f.from.includes(n)&&f.to.includes(r))return e.ontoModel}}catch(y){u=!0,h=y}finally{try{s||null==d.return||d.return()}finally{if(u)throw h}}return e.ontoModel.push({type:"relation",ontoType:t,from:n,to:r,uri:o,label:i,fromType:l,toType:a,fromRelation:[]}),e.ontoModel},e.updateOntoModel=function(t,n,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!0,l=!1,a=void 0;try{for(var s,u=e.ontoModel[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value;if(h.uri===t)return Array.isArray(h[n])?!0!==o&&h[n].includes(r)||h[n].push(r):!0!==o&&h[n]===r||(h[n]=r),e.ontoModel}}catch(c){l=!0,a=c}finally{try{i||null==u.return||u.return()}finally{if(l)throw a}}return!1},e.getOntoModel=function(){return e.ontoModel},e.getElementsRelation=function(t,n){var r=[],o=!0,i=!1,l=void 0;try{for(var a,s=e.ontoModel[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value,h=!1;Array.isArray(u[n])&&(h=!!u[n].includes(t)),"relation"===u.type&&!0===h?r.push(u):"connect"===n&&(u.from.includes(t)||u.to.includes(t))&&r.push(u)}}catch(c){i=!0,l=c}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}return r},e.getElementOntoType=function(t){var n=e.getOntoElement(t);return!1!==n&&n.ontoType},e.getElementsByOntoType=function(t,n){var r=[],o=!0,i=!1,l=void 0;try{for(var a,s=e.ontoModel[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;t!==u.ontoType||void 0!==n&&!u.fromRelation.includes(n)||r.push(u.uri)}}catch(h){i=!0,l=h}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}return r},e.getOntoElement=function(t){var n=!0,r=!1,o=void 0;try{for(var i,l=e.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if(a.uri===t)return a}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return!1},e.changeOrigin=function(t,n){for(var r=0;r<e.ontoModel.length;r++)if(e.ontoModel[r].uri===t)return e.ontoModel[r].origin=n,!0;return!1},e.getLastElementUri=function(t,n,r){for(var o=e.ontoModel.length-1;o>=0;o--)for(var i=0;i<e.ontoModel[o].fromRelation.length;i++){if(e.ontoModel[o].fromRelation[i]===t&&e.ontoModel[o].branchIndex.includes(r)&&e.ontoModel[o].direction[i]===n&&"Datatype"!==e.ontoModel[o].ontoType)return e.ontoModel[o].uri;if(e.ontoModel[o].fromRelation[i]===t&&e.ontoModel[o].direction[i]===n&&"Datatype"!==e.ontoModel[o].ontoType&&void 0===r)return e.ontoModel[o].uri;if(e.ontoModel[o].fromRelation[i]===t&&void 0===n&&void 0===r)return e.ontoModel[o].uri;if(void 0===t&&void 0===n&&void 0===r)return e.ontoModel[o].uri}return!1},e.getLastElement=function(t,n){var r=e.getLastElementUri(t,n);return e.getOntoElement(r)},e.getFatherOntoType=function(t){var n=[];if("father"in t){var r=!0,o=!1,i=void 0;try{for(var l,a=e.ontoModel[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;t.father.includes(s.uri)&&n.push(s.ontoType)}}catch(u){o=!0,i=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}}return 0===n.length&&(n=[""]),n},e.getRelationElements=function(t,n,r,o,i,l,a,s,u,h,c){var d,f,y=e.getOntoElement(r);if(""!==t&&"dataType"!==a&&!1===h&&!1===s&&(!1!==n||!1!==y))return"superType"===a?(d=e.ontoUri+t,f=!1!==y?y.uri:n.uri.value):"subType"===a?(f=e.ontoUri+t,d=!1!==y?y.uri:n.uri.value):(d=!1!==n?void 0===n.father[0]?n.uri.value:n.father[0]:y.uri,f=e.ontoUri+t),[d,f];if(null===o)return n.father.length>0&&[n.father[0],n.uri.value];if(a.includes("elementSelection")||!1!==n&&!1!==e.getOntoElement(n.father[0])){var p="foundFather"in n?n.foundFather:e.getOntoElement(n.father[0]);return a.includes("invert")||!a.includes("elementSelection")?[n.uri.value,p.uri]:[p.uri,n.uri.value]}if(0===i&&!0===l||!1===n||!0===s){var v=e.getLastElement(o);v=e.getOntoElement(e.getElementInRelRow(v.uri));var m=!1===n||!0===s?e.ontoUri+t:r,g=e.getLastElementUri(o,u,c);if(g=e.getElementInRelRow(g),!1!==v&&(v.direction[v.direction.length-1]!==u||c>1)&&0===i)return!1!==g&&!e.isRelationExist(g,m)&&e.getOntoBranch(o,u).length>1?[g,m]:(e.updateOntoModel(o,u,m,!1),o);if(!1===n||!1!==v||!0===s)return[v.uri,m]}},e.ontoModel=[],e}return Object(s.a)(t,e),Object(i.a)(t,[{key:"isRelationComplete",value:function(e){return"relation"===e.type&&e.from.length>0&&e.to.length>0}},{key:"getCardinalElement",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,l=this.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if("relation"===a.type&&"generalization"===a.ontoType.toLowerCase()&&a.from[0]===e&&!1===t)return a.to[0];if("relation"===a.type&&"generalization"===a.ontoType.toLowerCase()&&a.to[0]===e&&!0===t)return a.from[0]}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return!1}},{key:"getElementByProperty",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,l=this.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if(a[e]===t)return a}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return!1}},{key:"getReletadELement",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,l=this.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if("relation"===a.type&&(a.from.includes(e.uri)||a.to.includes(e.uri))&&this.isRelationComplete(a)){var s=void 0;if(s=a.from.includes(e.uri)?a.to[0]:a.from[0],(s=this.getOntoElement(s)).fromRelation.includes(t))return s}}}catch(u){r=!0,o=u}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return!1}},{key:"addToProperty",value:function(e,t,n){var r=!0,o=!1,i=void 0;try{for(var l,a=this.ontoModel[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;if(s.uri===e&&Array.isArray(s[t]))return s[t].push(n),!0}}catch(u){o=!0,i=u}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return!1}},{key:"getElementInRelRow",value:function(e){var t=this.getElementInRelation(e,"*","from",!1);if(0===t.length)return e;console.log(t);var n=this.getElementInRelation(t[0].element.uri,"*","to",this.getOntoElement(e).ontoType);return console.log(n),console.log(n[0].element.uri),n[0].element.uri}},{key:"checkDuplicity",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.ontoModel[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){if(o.value.label===e)return!1}}catch(l){n=!0,r=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return!0}},{key:"getRelatedTypes",value:function(e,t,n){var r=this.getElementsRelation(e,t),o=[],i=[],l=!0,a=!1,s=void 0;try{for(var u,h=r[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var c=u.value;if(c.ontoType===n||"Generalization"===n&&c.ontoType.includes("memberOf")){var d=c.to.includes(e)?c.from[c.to.indexOf(e)]:c.to[c.from.indexOf(e)];o.push(d),i.push(this.getElementOntoType(d))}else if(!1===n&&"Relator"===c.ontoType)i.push(c.ontoType);else if(!1===n){var f=c.to.includes(e)?c.from[c.to.indexOf(e)]:c.to[c.from.indexOf(e)];o.push(f),i.push(this.getElementOntoType(f))}}}catch(y){a=!0,s=y}finally{try{l||null==h.return||h.return()}finally{if(a)throw s}}return i}},{key:"getElementsFromBranch",value:function(e){for(var t=[e],n=e;!1!==this.getCardinalElement(n,!0);)n=this.getCardinalElement(n,!0),t.push(n);return t}},{key:"getElementInRelation",value:function(e,t,n,r){var o=[],i="*"===t;r=void 0!==r&&r;var l=!0,a=!1,s=void 0;try{for(var u,h=this.ontoModel[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var c=u.value;if("relation"===c.type&&(c.ontoType===t||i)&&c[this.getOpositeDirection(n)].includes(e)){var d=this.getOntoElement(c[n][0]);!1!==r&&r!==d.ontoType||o.push({element:d,relationType:c.ontoType})}}}catch(f){a=!0,s=f}finally{try{l||null==h.return||h.return()}finally{if(a)throw s}}return o}},{key:"isRelationExist",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,l=this.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if("relation"===a.type&&a.from===e&&a.to===t||a.from===t&&a.to===e)return!0}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return!1}},{key:"getOntoBranch",value:function(e,t,n){var r=[];n=void 0!==n&&n;var o=!0,i=!1,l=void 0;try{for(var a,s=this.ontoModel[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;for(var h in u.fromRelation)u.fromRelation[h]!==e||u.direction[h]!==t||!1!==n&&!u.branchIndex.includes(n)||r.push(u)}}catch(c){i=!0,l=c}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}return r}},{key:"connectToBranchElement",value:function(e,t,n){var r="To which element is the "+this.delUri(n.uri.value)+" connected?",o=this.getOntoBranch(e,t)[0],i=this.getLastElement(e,t);return void 0!==o&&!1!==i&&this.createButtons([o.label,i.label],r,"nextBranchElements",!1,"")}},{key:"undo",value:function(e){this.ontoModel=JSON.parse(JSON.stringify(e))}}]),t}(O),S=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(a.a)(t).call(this))).ontoModel=[],e}return Object(s.a)(t,e),Object(i.a)(t,[{key:"createGraph",value:function(e){this.ontoModel=e;var t="classDiagram\n",n=!0,r=!1,o=void 0;try{for(var i,l=this.ontoModel[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;if("relation"===a.type&&!1!==this.findLabel(a.to[0])&&!1!==this.findLabel(a.from[0]))if("Relator"===a.ontoType){if(a.from.length>0&&a.to.length>0){for(var s in t+="class "+a.label+"{\n                                <<"+a.ontoType+">>\n                        }\n",a.from)t+=this.findLabel(a.from[s])+" "+(a.fromType[s]?'"'+a.fromType[s][0]+'"':"")+" .. "+(a.toType[s]?'"'+a.fromType[s][1]+'"':"")+" "+a.label+" : <<Mediation>>\n";for(var u in a.to)t+=a.label+" "+(a.toType[u]?'"'+a.toType[u][0]+'"':"")+" .. "+(a.toType[u]?'"'+a.toType[u][1]+'"':"")+" "+this.findLabel(a.to[u])+" : <<Mediation>>\n"}}else{var h=this.getRelationSpec(a.ontoType);if(a.from.length===a.to.length)for(var c in a.from)t+=this.findLabel(a.from[c])+" "+(a.fromType[c]?'"'+a.fromType[c]+'"':"")+h[0]+(a.toType[c]?'"'+a.toType[c]+'"':"")+" "+this.findLabel(a.to[c])+(!0===h[1]?" : <<"+a.ontoType.split("-")[0]+">>":"")+"\n";else for(var d in a.from){var f=this.findLabel(a.from[d])+" "+(a.fromType[d]?'"'+a.fromType[d]+'"':"")+h[0];for(var y in a.to)t+=f+(a.toType[y]?'"'+a.toType[y]+'"':"")+" "+this.findLabel(a.to[y])+(!0===h[1]?" : <<"+a.ontoType.split("-")[0]+">>":"")+"\n"}}else"relation"!==a.type&&(t+="class "+a.label+"{\n                    <<"+a.ontoType+">>\n                }\n")}}catch(p){r=!0,o=p}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return"classDiagram"!==t.trim()&&t}},{key:"getRelationSpec",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.rulesJson.relations[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=o.value;if(e in l){var a=l[e],s="showType"in l&&!0===l.showType,u=void 0;switch(a.toLowerCase()){case"arrowline":u=" <|-- ";break;case"simpleline":u=" -- ";break;case"dashedline":u=" .. ";break;case"composition":u=" *-- ";break;case"aggregation":u=" o-- ";break;default:u=" -- "}return[u,s]}}}catch(h){n=!0,r=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"findLabel",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.ontoModel[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=o.value;if(l.uri===e)return l.label}}catch(a){n=!0,r=a}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return!1}}]),t}(O),x=function(e){function t(){var e,n;Object(o.a)(this,t);for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(a.a)(t)).call.apply(e,[this].concat(i)))).ruleSelection=function(e,t,r,o,i,l,a){var s,u,h,c="";if(s=i||n.getSpecificRule(e,t).offer,!1!==r){var d="";r.connect.length>1&&(d="\n "+n.getQuestion(a,"relSpecific")),n.isElementInstace(r,l)?(h=!0,r.uri.value,u=n.rulesJson.questions[1].question.replace("VAL",r.label.value)+d):(h=!1,r.uri.value,u=n.rulesJson.questions[0].question.replace("VAL",r.label.value)+d,c=r.label.value)}else{h=!0;var f=!0,y=!1,p=void 0;try{for(var v,m=n.rulesJson.questions[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var g=v.value;if("bTypeChild"===g.type){u=g.question.replace("VAL",o);break}}}catch(T){y=!0,p=T}finally{try{f||null==m.return||m.return()}finally{if(y)throw p}}}return n.createButtons(s,u,"classSelection",h,c)},n.isElementInstace=function(e,t){var r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;if(e.uri.value===s.uri.value){var u=!0,h=!1,c=void 0;try{for(var d,f=s.fatherTypeRelation[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;if("instanceOf"===n.delUri(y))return!0}}catch(p){h=!0,c=p}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}}catch(p){o=!0,i=p}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return!1},n.elementConsistencyRules=function(e,t){var r=n.rulesJson[e.ontoType],o=[],i={superType:t.getRelatedTypes(e.uri,"to","Generalization"),subType:t.getRelatedTypes(e.uri,"from","Generalization"),connect:t.getRelatedTypes(e.uri,"connect",!1)};console.log(i.connect);var l=!0,a=!1,s=void 0;try{for(var u,h=r[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var c=u.value;o=n.elementConsistencySelection(c,i.connect,"connect",e,o,r,i,t),o=n.elementConsistencySelection(c,i.superType,"superType",e,o,r,i,t),o=n.elementConsistencySelection(c,i.subType,"subType",e,o,r,i,t),"moreThanOne"===c.key&&(o=n.moreThanOneRule(t,e,c.minCount,c.maxCount,o))}}catch(f){a=!0,s=f}finally{try{l||null==h.return||h.return()}finally{if(a)throw s}}o.length>0&&o[0].types.includes("Relator")&&o[0].types.includes("None")&&o.splice(0,1);for(var d=0;d<o.length;d++)o[d].elLabel=t.getOntoElement(o[d].element).label;return o},n.elementConsistencySelection=function(e,t,r,o,i,l,a,s){if(e.key===r){var u="e"===r[r.length-1]?"d":"ed",h=n.getSpecificRule(l,r+u,!0);if(!e.type.some((function(e){return t.includes(e)}))&&e.type.length>0)i.push({key:r,types:e.type,element:o.uri,rule:e});else if(!1!==h){var c=!0,d=!1,f=void 0;try{for(var y,p=h[Symbol.iterator]();!(c=(y=p.next()).done);c=!0){var v=y.value;console.log(JSON.parse(JSON.stringify(v))),v.type.some((function(e){return t.includes(e)}))&&(i=n.elementConsAddSelection("superType",v,t,i,o,a),i=n.elementConsAddSelection("subType",v,t,i,o,a),i=n.elementConsAddSelection("connect",v,t,i,o,a),"moreThanOne"in v&&!0===v.moreThanOne&&t.length<2&&(i=n.moreThanOneRule(s,o,v.mincCountount,v.maxCount,i)))}}catch(m){d=!0,f=m}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}}return i},n.getSpecificRule=function(e,t,n,r){var o=[];if(n=void 0!==n&&n,!1!==(r=void 0!==r&&r)){var i=!0,l=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value;if(h.key===t&&"bTypeNumber"in h&&h.bTypeNumber.includes(r)){if(!0!==n)return h;o.push(h)}}}catch(m){l=!0,a=m}finally{try{i||null==u.return||u.return()}finally{if(l)throw a}}}var c=!0,d=!1,f=void 0;try{for(var y,p=e[Symbol.iterator]();!(c=(y=p.next()).done);c=!0){var v=y.value;if(v.key===t){if(!0!==n)return v;o.push(v)}}}catch(m){d=!0,f=m}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}return o.length>0&&e},n.getAdditionalRule=function(e,t,n){return!1!==e&&n.toString()in e&&t in e[n]?(console.log(e[n][t]),e[n][t]):[]},n.commonRuleSelection=function(e,t,r,o,i,l){var a=[],s=[],u="elementSelection",h=!0,c=!1,d=void 0;try{for(var f,y=e.childType[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var p=f.value;s.push(n.delUri(p))}}catch(I){c=!0,d=I}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}if(i)a.push(e.foundFather.ontoType);else{var v=!0,m=!1,g=void 0;try{for(var T,b=o[Symbol.iterator]();!(v=(T=b.next()).done);v=!0){var E=T.value;t.includes(E.uri)&&a.push(E.ontoType)}}catch(I){m=!0,g=I}finally{try{v||null==b.return||b.return()}finally{if(m)throw g}}}var O=!0,R=!1,C=void 0;try{for(var S,x=function(){var t=S.value;if(console.log(!0===r),console.log("NoRelation"===t.fatherOnto),console.log(t.fatherOnto),!0===r&&"NoRelation"===t.fatherOnto[0]){var o="Which type is "+e.label.value+"?";return{v:n.createButtons(t.offer,o,u,!1,e.label.value)}}if(a.some((function(e){return t.fatherOnto.includes(e)}))||t.fatherOnto.includes("none")){"invert"in t&&!0===t.invert&&(u+="-invert");var i=JSON.parse(JSON.stringify(t.offer));!0!==l||i.includes("None")||i.push("None");var s="Which type is "+e.label.value+"?";return{v:n.createButtons(t.offer,s,u,!1,e.label.value)}}},k=n.rulesJson.commonRules[Symbol.iterator]();!(O=(S=k.next()).done);O=!0){var N=x();if("object"===typeof N)return N.v}}catch(I){R=!0,C=I}finally{try{O||null==k.return||k.return()}finally{if(R)throw C}}},n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"moreThanOneRule",value:function(e,t,n,r,o){var i=e.getElementInRelation(t.uri,"*","from",!1)[0],l=e.getElementInRelation(i.element.uri,i.relationType,"to",t.ontoType).length;if(l<r){var a=l<n?[t.ontoType]:[t.ontoType,"None"];o.push({key:"subType",types:a,element:i.element.uri,rule:{type:[t.ontoType],question:this.getQuestion(i.element,"moreThanOne")}})}return o}},{key:"elementConsAddSelection",value:function(e,t,n,r,o,i){if(e in t)if(!t[e].some((function(t){return i[e].includes(t)}))&&t[e].length>0){for(var l in r)r[l].key===e&&r[l].element===o.uri&&r.splice(l,1);r.push({key:e,types:t[e],element:o.uri,rule:t})}else"moreThanOne"in t&&t.moreThanOne;return r}},{key:"numberOfRuleStep",value:function(e,t,n){var r=this.getSpecificRule(this.rulesJson[e],t,!1,n),o=0;for(var i in r)isNaN(i)||o++;return o}}]),t}(O),k=function(){function e(){Object(o.a)(this,e),this.ontoModelHistory=[],this.propertiesHistory=[],this.inputVariables=[]}return Object(i.a)(e,[{key:"init",value:function(e){this.propertiesHistory.push(e),this.ontoModelHistory.push([])}},{key:"reset",value:function(){this.ontoModelHistory=[],this.propertiesHistory=[],this.inputVariables=[]}},{key:"saveRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;this.propertiesHistory.push(e),this.ontoModelHistory.push(t),this.inputVariables.push(n)}},{key:"undo",value:function(){this.ontoModelHistory.pop();var e=this.propertiesHistory.pop();return this.inputVariables.pop(),void 0!==this.propertiesHistory[this.propertiesHistory.length-2]&&0===this.propertiesHistory[this.propertiesHistory.length-2].queryTree.length&&(this.propertiesHistory[this.propertiesHistory.length-2].queryTree=JSON.parse(JSON.stringify(e.queryTree))),console.log(this.propertiesHistory),console.log(this.inputVariables),console.log(this.ontoModelHistory),{ontoModel:this.ontoModelHistory[this.ontoModelHistory.length-2],properties:this.propertiesHistory[this.propertiesHistory.length-2],inputVariables:this.inputVariables[this.inputVariables.length-1]}}}]),e}(),N=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"transform",value:function(e){var t=this.schemaInit(),r=0,o=!0,i=!1,l=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done);o=!0){var u=a.value;"Class"!==u.type&&"relator"!==u.ontoType.toLowerCase()||t.contents.push(this.ontoClassTransformation(u))}}catch(k){i=!0,l=k}finally{try{o||null==s.return||s.return()}finally{if(i)throw l}}console.log(t);var h=!0,c=!1,d=void 0;try{for(var f,y=e[Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var p=f.value;if("relation"===p.type&&"relator"!==p.ontoType.toLowerCase()){var v=void 0;v=p.from.length>=p.to.length?"from":"to";var m=0;for(var g in p[v]){var T="from"===v?g:m,b="to"===v?g:m;t.contents.push(this.relationTransformation(p,r,T,b)),r+=2,g<=p[v].length&&(m=g)}}else if("relator"===p.ontoType.toLowerCase()){var E=void 0;E=p.from.length>=p.to.length?"from":"to";var O=0;for(var R in p[E]){var C=JSON.parse(JSON.stringify(p)),S=JSON.parse(JSON.stringify(p));C.uri+="rel1",S.uri+="rel2",C.ontoType="mediation",S.ontoType="mediation","from"===E?(C.fromType=p.fromType[R][0],C.toType=p.fromType[R][1],!1!==O&&(S.fromType=p.toType[O][0],S.toType=p.toType[O][1],S.to=[C.to[O]]),C.from=[C.from[R]]):(!1!==O&&(C.fromType=p.fromType[O][0],C.toType=p.fromType[O][1],C.from=[C.from[O]]),S.fromType=p.toType[R][0],S.toType=p.toType[R][1],S.to=[C.to[R]]),C.to=[p.uri],S.from=[p.uri],console.log(JSON.parse(JSON.stringify(C))),console.log(JSON.parse(JSON.stringify(S))),"to"===E&&!1===O||(t.contents.push(this.relationTransformation(C,r,0,0)),r+=2),"from"===E&&!1===O||(t.contents.push(this.relationTransformation(S,r,0,0)),r+=2),O=R<p[this.getOpositeDirection(E)].length-1&&R}}}}catch(k){c=!0,d=k}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}var x=n(832);return(new(n(834))).compile(x.getSchema(x.ONTOUML_2))(t)?t:(alert("Model is not valid! Check OntoSchemaCotroller!"),{})}},{key:"schemaInit",value:function(){return{type:"Package",id:"puroConversion",name:null,description:null,contents:[],propertyAssignments:null}}},{key:"ontoClassTransformation",value:function(e){return{type:"Class",id:e.uri,name:e.label,description:null,properties:null,literals:null,propertyAssignments:null,stereotypes:[e.ontoType.toLowerCase()],isAbstract:null,isDerived:null}}},{key:"relationTransformation",value:function(e,t,n,r){return"Generalization"===e.ontoType?{type:"Generalization",id:e.uri,name:null,description:null,general:{type:"Class",id:e.from[n]},specific:{type:"Class",id:e.to[r]},propertyAssignments:{nonStandardProperty:null}}:{type:"Relation",id:e.uri,name:null,description:null,properties:[{type:"Property",id:"prop"+t,name:null,description:null,propertyType:{type:"Class",id:e.from[n]},cardinality:""===e.fromType[n]?null:e.fromType[n],isDerived:null,isOrdered:null,isReadOnly:null,stereotypes:null,propertyAssignments:null,subsettedProperties:null,redefinedProperties:null,aggregationKind:null},{type:"Property",id:"prop"+(parseInt(t)+1),name:null,description:null,propertyType:{type:"Class",id:e.to[r]},cardinality:""===e.toType[r]?null:e.toType[r],isDerived:null,isOrdered:null,isReadOnly:null,stereotypes:null,propertyAssignments:null,subsettedProperties:null,redefinedProperties:null,aggregationKind:null}],propertyAssignments:{nonStandardProperty:null},stereotypes:[e.ontoType.toLowerCase()],isAbstract:!0,isDerived:!1}}}]),t}(O),I=n(204),w=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(a.a)(t).call(this))).rdfController=new R,e.ontoController=new C,e.imageController=new S,e.ruleController=new x,e.historyController=new k,e.ontoSchemaController=new N,e.rdfController.getFullPath().then((function(t){e.queryTree=t,console.log(t)})),e.rdfController.getRelations().then((function(t){e.relations=t})),e.elSettings={},e.relationOrderIndex=0,e.relation={},e.relationIndex=0,e.relationType="",e.setIndexexToDefault(),e}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getDefault",value:function(e){if(this.relationOrderIndex===this.relations.length||0===this.relations.length)return!0===e?(this.relationTree=this.queryTree,this.ruleKey="from",this.elementUri=this.relationTree[this.relationOrderIndex].uri.value,this.relation={uri:{value:null}},this.ruleController.commonRuleSelection(this.relationTree[this.relationOrderIndex],!0,this.ontoController.getOntoModel())):(alert("Transformation is comlete!!!"),{buttons:[],title:"The End",type:"end"});var t=this.relations[this.relationOrderIndex];if(this.relation=t,this.ruleKey="from",this.relation.valuation.length>0){var n=t.label.value.charAt(0).toUpperCase()+t.label.value.slice(1)+" was typed as a Relator.";return this.createButtons("Relator",n,this.delUri(t.type.value),!1,t.label.value)}this.elementUri=t.uri.value;var r=this.getQuestion(t.label.value,"bRelation");return this.createButtons(this.rulesJson.bRelationRules,r,this.delUri(t.type.value),!1,t.label.value)}},{key:"nextElement",value:function(){var e=Object(E.a)(b.a.mark((function e(t,n,r,o,i){var l,a,s,u,h,c,d,f,y,p,v,m,g,T,E,O,R,C,S;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==o&&!0===i&&this.changeElementsProperty(this.elementUri,"label",o),"BRelation"!==r){e.next=5;break}return e.abrupt("return",this.relationWasSelected(t,o));case 5:if("needFather"!==r){e.next=10;break}return"none"===t.toLowerCase()?this.selectedEl.foundFather=t.toLowerCase():this.selectedEl.foundFather=this.ontoController.getElementByProperty("label",t),e.abrupt("return",this.consistencyCheck());case 10:if(s=[],u=r,!r.includes("ontoRelation-save-bRelation")&&!r.includes("material")){e.next=30;break}if(r.includes("relator")?"from"===(c=r.replace("ontoRelation-save-bRelation-relator-",""))?(this.ontoController.updateOntoModel(this.relation.uri.value,"fromType",t),u="last"===this.additionalRule.key?"updated":u):"to"===c&&(this.ontoController.updateOntoModel(this.relation.uri.value,"toType",t),u="last"===this.additionalRule.key?"updated":u):(this.ontoController.updateOntoModel(this.relation.uri.value,"fromType",t[0]),this.ontoController.updateOntoModel(this.relation.uri.value,"toType",t[1]),u="last"===this.additionalRule.key?"updated":u),"cPhase-next"!==this.lastElInBranch){e.next=24;break}if(!(this.relation[this.ruleKey].length<=this.relationRuleIndex)){e.next=21;break}return this.relationOrderIndex++,this.setIndexexToDefault(),e.abrupt("return",this.getDefault());case 21:return e.abrupt("return",this.nextTreeBranch());case 22:e.next=30;break;case 24:t=this.elSettings.selectedType,r=this.elSettings.puroType,o=this.elSettings.elName,a=this.elSettings.relationEl,s=this.elSettings.additionalRule,i=this.elSettings.nameWasChange;case 30:if(Array.isArray(t)||"none"!==t.toLowerCase()){e.next=40;break}if(this.elSettings.selectedType=t,d=this.ontoController.getOntoElement(this.relation.uri.value),this.additionalRule.key="stop",d[this.ruleKey].length!==this.relationRuleIndex&&(f=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(d.uri,this.ruleKey,f)),!1===(y=this.updateRelationTypes())){e.next=38;break}return e.abrupt("return",y);case 38:return this.consistencyExeption.push({uri:this.elementUri,ontoType:t,type:r}),e.abrupt("return",this.consistencyCheck());case 40:if(r.includes("ontoRelation")||"dataType"===r){e.next=53;break}if("stop"!==this.additionalRule.key&&void 0===this.additionalRule.key&&(this.additionalRule.index>1||0===this.ontoController.getOntoBranch(this.relation.uri.value,this.ruleKey,this.relationRuleIndex).length)&&null!==this.relation.uri.value?(s=this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),t,1)).length>0&&(this.additionalRule.index=2,this.additionalRule.rule=this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),this.additionalRule.key=t):this.additionalRule.index>1&&"stop"!==this.additionalRule.key&&((s=this.ruleController.getAdditionalRule(this.additionalRule.rule,t,this.additionalRule.index)).length>0?this.additionalRule.index++:this.additionalRule.key="last"),p=this.getElementByUri(this.elementUri),v=!1!==p&&p.father.length>0&&this.isElementInstace(this.getElementByUri(p.father[0])),a=this.ontoController.getRelationElements(o,p,this.elementUri,this.relation.uri.value,s.length,0===s.length,r,v,this.ruleKey,i,this.relationRuleIndex),this.elSettings={selectedType:t,nameWasChange:i,puroType:r,ruleKey:this.ruleKey,elName:o,relationEl:a,additionalRule:s,relType:"",elUri:this.elementUri},a!==this.relation.uri.value&&"cPhase"!==this.lastElInBranch){e.next=51;break}if(!1===(m=this.updateRelationTypes())){e.next=51;break}return this.lastElInBranch+="-next",e.abrupt("return",m);case 51:e.next=54;break;case 53:"dataType"===r?(a=[t,this.ontoUri+o],this.elSettings.relationEl=a,this.elSettings.relType="connect",this.ontoController.addToOntoModel(this.ontoUri+o,o,"Datatype","BValue",this.relation.uri,this.ruleKey,void 0,void 0,void 0,void 0,this.elementUri)):(r.includes("ontoRelation-cardinality")?this.elSettings.relType=t:r.includes("ontoRelation-save")&&(h=t),t=this.elSettings.selectedType,r=this.elSettings.puroType,o=this.elSettings.elName,a=this.elSettings.relationEl,s=this.elSettings.additionalRule,i=this.elSettings.nameWasChange,this.elementUri=this.elSettings.elUri);case 54:if(!0===(l=this.getRelationRules(a,u,n,this.ruleKey,this.elSettings.selectedType,this.elSettings.relType,h))){e.next=57;break}return e.abrupt("return",Promise.resolve(l));case 57:if(null===this.valuationArr){e.next=72;break}if(!(this.valuationArr.length>0)){e.next=62;break}return e.abrupt("return",this.handleValuation());case 62:if(0!==this.valuationArr.length){e.next=72;break}if("to"!==this.ruleKey||this.relation.to.length!==this.relationRuleIndex){e.next=71;break}return g=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(this.relation.uri.value,"to",g),this.elementUri=g,this.lastElInBranch="cPhase",e.abrupt("return",this.updateRelationTypes());case 71:return e.abrupt("return",this.nextTreeBranch());case 72:if(T=!1!==this.selectedEl&&"type"in this.selectedEl&&this.delUri(this.selectedEl.type.value),E=void 0,this.relationTree[this.relationTree.length-1].uri.value===this.elementUri&&!1===this.ontoController.getOntoElement(this.elementUri)&&(E="first"),this.ontoController.addToOntoModel(this.elementUri,this.delUri(this.elementUri),t,T,this.relation.uri.value,this.ruleKey,o,i,this.ontoUri,this.relationRuleIndex,E),!(s.length>0)){e.next=83;break}return this.selectedEl=this.getNextElement(),this.elementUri=!1===this.selectedEl||Array.isArray(this.selectedEl)?"":this.selectedEl.uri.value,this.selectedEl=""!==this.elementUri&&this.selectedEl,e.abrupt("return",this.ruleController.ruleSelection(void 0,this.ruleKey,this.selectedEl,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,s,this.queryTree,this.relation.label.value));case 83:if("last"!==this.additionalRule.key){e.next=95;break}if((O=this.ontoController.getOntoElement(this.relation.uri.value))[this.ruleKey].length!==this.relationRuleIndex&&(R=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(O.uri,this.ruleKey,R)),!1===(C=this.updateRelationTypes())){e.next=91;break}return e.abrupt("return",C);case 91:return this.additionalRule.key="stop",e.abrupt("return",this.consistencyCheck());case 93:e.next=98;break;case 95:return this.additionalRule.key="stop",null!==this.relation.uri.value&&0===this.ontoController.getOntoElement(this.relation.uri.value).from.length&&(S=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey),this.ontoController.updateOntoModel(this.relation.uri.value,this.ruleKey,S)),e.abrupt("return",this.consistencyCheck());case 98:case"end":return e.stop()}}),e,this)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}()},{key:"consistencyCheck",value:function(){var e=!1!==this.selectedEl&&"foundFather"in this.selectedEl,t=!1;if(0!==this.elementsWithoutType.length&&e||(this.elementsWithoutType=this.checkElementsInRelationTree(this.relationTree,this.ontoController.getOntoModel())),this.elementsWithoutType.length>0&&this.withoutTypeIndex<this.elementsWithoutType.length||e){!0===e&&"None"===this.selectedEl.foundFather&&this.withoutTypeIndex++;var n=e?this.selectedEl:this.getElementByUri(this.elementsWithoutType[this.withoutTypeIndex].uri.value);if("needToFindFather"in n&&!e){var r=this.ontoController.getOntoBranch(this.relation.uri.value,this.ruleKey,this.relationRuleIndex);if(!(r.length<2)){var o=[],i="To which element is "+n.label.value+" connected?";this.selectedEl=n;var l=!0,a=!1,s=void 0;try{for(var u,h=r[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var c=u.value;o.includes(c.label)||o.push(c.label)}}catch(C){a=!0,s=C}finally{try{l||null==h.return||h.return()}finally{if(a)throw s}}return o.push("None"),this.createButtons(o,i,"needFather",!1,"")}n.foundFather=r[0],e=!0,t=!0}var d=!1;if(!1!==n&&(this.withoutTypeIndex++,this.elementUri=n.uri.value,d=this.ruleController.commonRuleSelection(n,this.getUsableFather(n),this.ruleKey,this.ontoController.getOntoModel(),e,t)),void 0===d)alert("Common rule is not defined! Check rules.json");else if(!1!==d)return this.selectedEl={},d}var f=this.checkElementsConsistency(this.relation.uri.value,this.ruleKey);if(f.length>0){var y=!0,p=!1,v=void 0;try{for(var m,g=this.consistencyExeption[Symbol.iterator]();!(y=(m=g.next()).done);y=!0){var T=m.value;for(var b in f)T.uri===f[b].element&&f[b].types.includes(T.ontoType)&&T.type===f[b].key&&f.splice(b,1)}}catch(C){p=!0,v=C}finally{try{y||null==g.return||g.return()}finally{if(p)throw v}}(f.length>0&&f[0].types.includes("Relator")&&f[0].types.includes("None")||f.length>0&&f[0].types.includes("None")&&1===f[0].types.length)&&f.splice(0,1)}if(f.length>0){var E=this.createQuestion(f[0],this.rulesJson.questions);return this.elementUri=f[0].element,this.createButtons(f[0].types,E,f[0].key,!0)}if(null===this.relation.uri.value)return this.getDefault();if(null===this.relation&&this.getDefault(),null===this.valuationArr&&1===this.relationRuleIndex&&(this.valuationArr=this.getAllTreeValuations(this.ruleKey),this.valuationArr.length>0))return this.handleValuation();if(this.relation[this.ruleKey].length===this.relationRuleIndex&&"from"!==this.ruleKey){var O=this.ontoController.getOntoElement(this.relation.uri.value);if(O.to.length<this.relationRuleIndex){var R=this.ontoController.getLastElement(O.uri,"to");return this.ontoController.updateOntoModel(O.uri,"to",R.uri),this.lastElInBranch="cPhase",this.updateRelationTypes(!0)}return this.setIndexexToDefault(),this.relationOrderIndex++,this.getDefault()}return this.nextTreeBranch()}},{key:"updateRelationTypes",value:function(){var e=this.ontoController.getOntoElement(this.relation.uri.value);if(e.to.length>0&&e.from.length>0){if("Relator"===e.ontoType&&e.fromType.length<e.from.length){var t=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality");return this.createRelCardinalityBtn("ontoRelation-save-bRelation-relator-from",t,"from",e.from[e.fromType.length],e.uri)}if("Relator"===e.ontoType&&e.toType.length<e.to.length){var n=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality");return this.createRelCardinalityBtn("ontoRelation-save-bRelation-relator-to",n,"to",e.uri,e.to[e.toType.length])}if(e.toType.length<e.to.length||e.fromType.length<e.from.length){var r=this.ruleController.getSpecificRule(this.rulesJson[e.ontoType],"cardinality"),o=e.from.length<=e.fromType.length?e.from.length-1:e.fromType.length,i=e.to.length<=e.toType.length?e.to.length-1:e.toType.length;return this.createRelCardinalityBtn("ontoRelation-save-bRelation",r,"to",e.from[o],e.to[i])}}return!1}},{key:"handleValuation",value:function(){var e=this.getQuestion(this.delUri(this.valuationArr[0].valuation),"valuations"),t=this.createButtons(this.valuationArr[0].el,e,"dataType",!0);return this.elementUri=this.valuationArr[0].valuation,this.valuationArr.shift(),t}},{key:"nextTreeBranch",value:function(){var e,t=this;if(null===this.valuationArr&&1===this.relationRuleIndex&&(this.valuationArr=this.getAllTreeValuations(this.ruleKey),this.valuationArr.length>0))return this.handleValuation();if(0===this.ontoController.getOntoElement(this.relation.uri.value).from.length||this.relationRuleIndex>1&&"from"===this.ruleKey){var n=this.ontoController.getLastElementUri(this.relation.uri.value,this.ruleKey);this.ontoController.updateOntoModel(this.relation.uri.value,this.ruleKey,n)}return this.relationTreeIndex===this.relationTreeArr.length?(this.relation[this.ruleKey].length===this.relationRuleIndex&&(this.ruleKey="from"===this.ruleKey?"to":"from",this.relationRuleIndex=0),e=this.getRelatedElements(this.relation,this.ruleKey),this.relationRuleIndex++):e=Promise.resolve(this.relationTreeArr),this.additionalRule.key=void 0,this.additionalRule.index=0,this.consistencyExeption=[],new Promise((function(n){e.then((function(e){t.valuationArr=null,console.log(e),n(t.handleRelatedElements(e,"nextElement",t.ruleKey))}))}))}},{key:"getAllTreeValuations",value:function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,l=this.relationTree[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value,s=this.getElementByUri(a.uri.value);if(s.valuation.length>0){var u=s.uri.value;if("BObject"===this.delUri(s.type.value)||s.fatherTypeRelation.includes("http://lod2-dev.vse.cz/ontology/puro#instanceOf")){var h=this.rulesJson.lastTypes,c=[],d=!0,f=!1,y=void 0;try{for(var p,v=h[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){var m=p.value;c=c.concat(this.ontoController.getElementsByOntoType(m,this.relation.uri.value))}}catch(U){f=!0,y=U}finally{try{d||null==v.return||v.return()}finally{if(f)throw y}}c.length>0&&(u=c[0])}var g=!0,T=!1,b=void 0;try{for(var E,O=s.valuation[Symbol.iterator]();!(g=(E=O.next()).done);g=!0){var R=E.value;t.push({el:u,valuation:R})}}catch(U){T=!0,b=U}finally{try{g||null==O.return||O.return()}finally{if(T)throw b}}}}}catch(U){r=!0,o=U}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}if("from"===e){var C=!0,S=!1,x=void 0;try{for(var k,N=this.relation.valuation[Symbol.iterator]();!(C=(k=N.next()).done);C=!0){var I=k.value;t.push({el:this.relation.uri.value,valuation:I})}}catch(U){S=!0,x=U}finally{try{C||null==N.return||N.return()}finally{if(S)throw x}}}for(var w in t)!1!==this.ontoController.getElementByProperty("origUri",t[w].valuation)&&t.splice(w,1);return t}},{key:"getGraphSvg",value:function(){var e=this.ontoController.getOntoModel();return this.imageController.createGraph(e)}},{key:"createRelCardinalityBtn",value:function(e,t,n,r,o,i,l){e+="dataType"===i?"-daType":"";var a=t.fromT.map((function(e){return{name:e,uri:l,direction:"from"}})),s=t.toT.map((function(e){return{name:e,uri:l,direction:"to"}})),u=this.selectElementsLabel(r),h=this.selectElementsLabel(o);return{buttons:s.concat(a),title:"Select cardinality between elements",type:e,elName:[u,h]}}},{key:"selectElementsLabel",value:function(e){var t=this.ontoController.getOntoElement(e);return!1===t?e===this.elSettings.elUri?""===this.elSettings.elName?this.delUri(e):this.elSettings.elName:this.delUri(e):t.label}},{key:"getRelationRules",value:function(e,t,n,r,o,i,l){var a,s,u,h,c,d=t.replace("ontoRelation-",""),f=this.rulesJson.relationRules;if(!Array.isArray(e))return!0;if(a=e[0],s=e[1],u=!1===(u=this.ontoController.getElementOntoType(a))?o:u,h=!1===(h=this.ontoController.getElementOntoType(s))?o:h,c=this.findRule(f,["from",u,"to",h]),"updated"===t)return!0;if(!1!==c||d.includes("save")||alert("Relation rule is not defined! Check rules.json!"),d.includes("save")||"cardinality"!==d&&"dataType"!==d&&1!==c.offer.length){if(d.includes("save"))return this.ontoController.addRelation(this.elSettings.relType,a,s,void 0,"nazev",l[0],l[1]),!0;var y=c.offer.map((function(e){return{name:e,uri:n,origin:r}}));return this.elementUri=n,{buttons:y,title:"Which type of relation is between "+this.delUri(a)+" and "+this.delUri(s)+"?",type:"ontoRelation-cardinality"}}return"fromT"in c&&"toT"in c?(this.elSettings.relType=1===c.offer.length?c.offer[0]:this.elSettings.relType,this.createRelCardinalityBtn("ontoRelation-save",c,r,a,s,d,n)):(i=1===c.offer.length?c.offer[0]:i,this.ontoController.addRelation(i,a,s,void 0,"nazev","",""),!0)}},{key:"findRule",value:function(e,t){var n=!1,r=!0,o=!1,i=void 0;try{for(var l,a=e[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;n=!1;for(var u=0;u<t.length;u+=2){var h=!0,c=!1,d=void 0;try{for(var f,y=s[t[u]][Symbol.iterator]();!(h=(f=y.next()).done);h=!0){var p=f.value;if(this.isSameCaseInsensitive(t[u+1],p)||"*"===p){if(!0===n)return s;n=!0;break}}}catch(v){c=!0,d=v}finally{try{h||null==y.return||y.return()}finally{if(c)throw d}}}}}catch(v){o=!0,i=v}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return!1}},{key:"relationWasSelected",value:function(e,t){var n=this;this.ruleKey="from",this.relation=this.relations[this.relationOrderIndex],this.relationType=e,t=""===t?this.relation.label.value:t;var r,o=this.rulesJson[e];return r=this.relationTreeArr.length===this.relationTreeIndex?this.getRelatedElements(this.relation,this.ruleKey):Promise.resolve(this.relationTreeArr),this.relationRuleIndex++,this.ontoController.addRelation(e,"","",this.relation.uri.value,t),new Promise((function(e){r.then((function(t){e(n.handleRelatedElements(t,"relationWasSelected",n.ruleKey,o))}))}))}},{key:"handleRelatedElements",value:function(e,t,n,r){if(r=void 0===r?this.rulesJson[this.relationType]:r,this.relationTreeArr=e,this.relationTree=e[this.relationTreeIndex],this.relationTreeIndex++,this.relationIndex=this.relationTree.length-1,"relationWasSelected"===t||!1!==this.ontoController.getOntoElement(this.relationTree[this.relationIndex].uri.value)){var o,i=this.getNextElement(),l=[],a="",s=!1,u=!1,h=!1,c=null;if(Array.isArray(i)&&!1===i[1]){h=i[0],a=i[0].ontoType;var d=this.getElementByUri(i[0].uri);!1!==d&&d.child.length>0&&(s=this.getElementByUri(d.child[0]),this.selectedEl=s,u=!0),this.ontoController.updateOntoModel(i[0].uri,"branchIndex",this.relationRuleIndex,!1),(this.relationRuleIndex>1||h.fromRelation.length>0)&&!this.additionalRule.index>0&&this.additionalRule.index++}else this.selectedEl=i,(s=this.getElementByUri(this.selectedEl.uri.value)).father.length>0&&(a=this.ontoController.getElementOntoType(s.father[0]));if(""!==a&&!1!==a){var f=this.ontoController.getElementsFromBranch(h.uri),y=1,p=[];for(var v in f){if("first"===this.ontoController.getOntoElement(f[v]).origUri){f.length=parseInt(v)+parseInt(1);break}}for(var m=f.length-1;m>=0;m--){var g=this.ontoController.getOntoElement(f[m]);if(!((l=this.ruleController.getAdditionalRule(this.ruleController.getSpecificRule(this.rulesJson[this.relationType],this.ruleKey,!1,this.countBTypesInTree(this.relationTree)),g.ontoType,y)).length>0)){if(p.includes(g.ontoType)){l=[];break}c=g,this.additionalRule.key=a,l=p;break}p=l,this.additionalRule.index++,y=this.additionalRule.index,m===f.length-1&&(this.additionalRule.key=a,l=p)}l.length>0&&(this.additionalRule.rule=this.ruleController.getSpecificRule(r,n,this.countBTypesInTree(this.relationTree)))}return 0===l.length?!1===s&&!0===u?this.nextTreeBranch():"relationWasSelected"!==t&&!0===u?(this.ontoController.updateOntoModel(this.relation.uri.value,n,h.uri),this.elementUri=h.uri,this.lastElInBranch="cPhase",this.updateRelationTypes(!0)):"relationWasSelected"!==t||!0!==u&&!1===h?(this.elementUri=this.selectedEl.uri.value,this.ruleController.ruleSelection(r,n,s,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,void 0,this.queryTree,this.relation.label.value)):(this.ontoController.updateOntoModel(this.relation.uri.value,n,h.uri),this.nextTreeBranch()):(this.elementUri=!1!==s?this.selectedEl.uri.value:"",null!==c?(this.elementUri=c.uri,o=c.label):o=h.label,this.ruleController.ruleSelection(void 0,n,s,o,l,this.queryTree,this.relation.label.value))}var T=this.rulesJson[this.relationType];return this.selectedEl=this.relationTree[this.relationIndex],this.relationIndex--,this.elementUri=this.selectedEl.uri.value,this.ruleController.ruleSelection(T,n,this.selectedEl,this.ontoController.getLastElement(this.relation.uri.value,this.ruleKey).label,void 0,this.queryTree,this.relation.label.value)}},{key:"deleteDuplicityInRelTree",value:function(e){var t=e,n=!0,r=!1,o=void 0;try{for(var i,l=this.relationTree[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value,s=!0,u=!1,h=void 0;try{for(var c,d=function(){var e=c.value;a.uri.value===e&&(t=t.filter((function(t){return t!==e})))},f=e[Symbol.iterator]();!(s=(c=f.next()).done);s=!0)d()}catch(y){u=!0,h=y}finally{try{s||null==f.return||f.return()}finally{if(u)throw h}}}}catch(y){r=!0,o=y}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return t}},{key:"getElementsWithoutType",value:function(e,t){var n=this.getElementByUri(e.uri.value);if(n.child.length>0){var r=!0,o=!1,i=void 0;try{for(var l,a=n.child[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value,u=this.getElementByUri(s);if((!this.isElementInstace(u)||u.child.length>1)&&!1===this.ontoController.getOntoElement(u.uri.value)){if(u.fatherTypeRelation.includes("http://lod2-dev.vse.cz/ontology/puro#instanceOf")){var h=this.deleteDuplicityInRelTree(u.child);if(h.length>0){var c=!0,d=!1,f=void 0;try{for(var y,p=h[Symbol.iterator]();!(c=(y=p.next()).done);c=!0){var v=y.value,m=this.getElementByUri(v),g=this.getUsableFather(m);for(var T in g=this.deleteDuplicityInRelTree(g))g[T]=this.getElementByUri(g[T]),g[T].needToFindFather=!0;t=t.concat(g)}}catch(b){d=!0,f=b}finally{try{c||null==p.return||p.return()}finally{if(d)throw f}}}}else t.push(u);t=this.getElementsWithoutType(u,t)}}}catch(b){o=!0,i=b}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}}return t}},{key:"checkElementsInRelationTree",value:function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value;t=this.getElementsWithoutType(a,t)}}catch(s){r=!0,o=s}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return t}},{key:"getRelatedElements",value:function(e,t){var n=this;this.elementConsitencyTree=[],this.elementConsistencyIndex=0,this.relationTreeIndex=0,this.relationTreeArr=[];var r=[];return r.push(this.rdfController.getRelationBTypes(e[t][this.relationRuleIndex])),Promise.all(r).then((function(r){console.log(r);for(var o=0;o<r.length;o++)r[o].length>0?(r[o].unshift(n.getElementByUri(e[t][n.relationRuleIndex-1])),r[o]=r[o].map((function(e){return n.getElementByUri(e.uri.value)}))):r[o]=[n.getElementByUri(e[t][o])];return r}))}},{key:"getNextElement",value:function(){if(this.relationIndex<0)return!1;var e,t=this.ontoController.getOntoModel();this.isElementUseless(this.relationTree[this.relationIndex])&&this.relationIndex--;for(var n=0;n<t.length;n++)if(void 0!==this.relationTree[this.relationIndex]&&t[n].uri===this.relationTree[this.relationIndex].uri.value){if(this.areChildrenInBranchUseless(this.relationTree[this.relationIndex])){for(var r=t[n].fromRelation[t[n].fromRelation.length-1],o=t[n].direction[t[n].direction.length-1],i=this.ontoController.getLastElementUri(r,o);!1!==this.ontoController.getCardinalElement(i,!1);)i=this.ontoController.getCardinalElement(i,!1);i=this.ontoController.getElementInRelRow(i),i=this.ontoController.getOntoElement(i);var l=this.ontoController.getOntoBranch(r,o),a=!0,s=!1,u=void 0;try{for(var h,c=l[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;this.ontoController.addToProperty(d.uri,"fromRelation",this.relation.uri.value),this.ontoController.addToProperty(d.uri,"direction",this.ruleKey)}}catch(f){s=!0,u=f}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return[i,!1]}this.relationIndex--,n=0}return e=void 0!==(e=this.relationTree[this.relationIndex])&&e,this.relationIndex--,e}},{key:"areChildrenInBranchUseless",value:function(e){return!e.childRel.includes("http://lod2-dev.vse.cz/ontology/puro#subTypeOf")}},{key:"isElementInstace",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.queryTree[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=o.value;if(e.uri.value===l.uri.value){var a=!0,s=!1,u=void 0;try{for(var h,c=l.fatherTypeRelation[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var d=h.value;if("instanceOf"===this.delUri(d)||"Some_objects"===this.delUri(d))return!0}}catch(f){s=!0,u=f}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}}}}catch(f){n=!0,r=f}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return!1}},{key:"checkElementsConsistency",value:function(e,t){var n=this.ontoController.getOntoModel(),r=0,o=[],i=!0,l=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value;h.fromRelation.includes(e)&&h.direction[h.direction.length-1]===t&&h.branchIndex.includes(this.relationRuleIndex)&&o.push(h)}}catch(d){l=!0,a=d}finally{try{i||null==u.return||u.return()}finally{if(l)throw a}}if(0===o.length)return o;var c=this.ruleController.elementConsistencyRules(o[r],this.ontoController);for(r++;r<o.length&&0===c.length;)c=this.ruleController.elementConsistencyRules(o[r],this.ontoController),r++;return c}},{key:"isElementUseless",value:function(e){return"child"in e&&0===e.child.length&&0===e.connect.length&&0===e.connectFrom.length}},{key:"getElementByUri",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=this.queryTree[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var l=o.value;if(l.uri.value===e)return l}}catch(a){n=!0,r=a}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return!1}},{key:"changeElementsProperty",value:function(e,t,n){for(var r=0;r<this.queryTree.length;r++)if(this.queryTree[r].uri.value===e)return this.queryTree[r][t].value=n,!0;return!1}},{key:"checkDuplicity",value:function(e){return this.ontoController.checkDuplicity(e)}},{key:"getConnectedElements",value:function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value,u=this.ontoController.getElementOntoType(s);if(!1===u||e[this.ruleIndex].connect.includes(u)){var h=!1!==u?this.delUri(s)+" ["+u+"]":this.delUri(s);n.push({name:h,uri:s})}}}catch(c){o=!0,i=c}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}},{key:"setIndexexToDefault",value:function(){this.valuationArr=null,this.relationRuleIndex=0,this.relationTree={},this.relationTreeIndex=0,this.relationTreeArr=[],this.elementsWithoutType=[],this.withoutTypeIndex=0,this.elementConsistencyIndex=0,this.elementConsitencyTree=[],this.elementUri="",this.ruleKey="",this.type="",this.selectedEl={},this.elSettings={},this.lastElInBranch=!1,this.additionalRule={key:void 0,rule:{},index:1},this.consistencyExeption=[]}},{key:"saveHistory",value:function(e,t){if(0===this.historyController.propertiesHistory.length){var n={};for(var r in e)"queryTree"===e[r]?n[r]=JSON.parse(JSON.stringify(this.queryTree)):"string"===typeof e[r]?n[r]="":"number"===typeof e[r]?n[r]=0:Array.isArray(e[r])?n[r]=[]:"object"===typeof e[r]&&(n[r]={});this.historyController.init(n)}this.historyController.saveRecords(e,JSON.parse(JSON.stringify(this.ontoController.getOntoModel())),t)}},{key:"undo",value:function(){var e=this.historyController.undo();if(void 0===e.ontoModel&&void 0===e.properties)return this.historyController.reset(),this.ontoController.undo([]),this.setIndexexToDefault(),this.elSettings={},this.relationOrderIndex=0,this.relationRuleIndex=0,this.relation={},this.relationIndex=0,this.relationType="",!1;for(var t in this.ontoController.undo(e.ontoModel),console.log(JSON.parse(JSON.stringify(this.additionalRule))),e.properties)"object"===typeof e.properties[t]?(console.log(t),console.log(JSON.parse(JSON.stringify(this[t]))),this[t]=JSON.parse(JSON.stringify(e.properties[t]))):this[t]=e.properties[t];return console.log(JSON.parse(JSON.stringify(this.additionalRule))),{inputVariables:e.inputVariables}}},{key:"getOntoSchema",value:function(){return this.ontoSchemaController.transform(this.ontoController.getOntoModel())}},{key:"getIframeURL",value:function(){return this.rulesJson.iframeURL.replace("MODELID",this.modelId)}},{key:"fullSizeSvg",value:function(){var e=0,t=!0,n=!1,r=void 0;try{for(var o,i=this.ontoController.getOntoModel()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){if("Class"===o.value.type&&e++,4===e)return!0}}catch(l){n=!0,r=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return!1}},{key:"getUsableFather",value:function(e){var t=[],n=!0,r=!1,o=void 0;try{for(var i,l=e.father[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var a=i.value,s=this.getElementByUri(a);for(!1===this.isElementInstace(s)&&t.push(s.uri.value);this.isElementInstace(s);){var u=!0,h=!1,c=void 0;try{for(var d,f=s.father[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;s=this.getElementByUri(y),!1===this.isElementInstace(s)&&t.push(s.uri.value)}}catch(p){h=!0,c=p}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}if(t.length>0)break}}}catch(p){r=!0,o=p}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return e.father=t,t}}]),t}(O),U=n(206),L=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(a.a)(t).call(this,e))).createGraph=function(e){n.setState({svg:e})},n.eventController=new w,n.state={svg:"",iframeURL:n.eventController.getIframeURL(),fullSize:!1},g.a.initialize({startOnLoad:!1,themeCSS:"#extensionEnd { fill: white; } #extensionStart { fill: white; } "}),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"container"},h.a.createElement("div",{className:"row"},h.a.createElement("div",{className:"form-group col-md-6",id:"puroModelContainer"},h.a.createElement("label",{htmlFor:"puroModel"},"Puro model"),h.a.createElement("div",{className:"transformWindow border",id:"puroModel"},h.a.createElement(I.a,{url:this.state.iframeURL,width:"607px",height:"307px",id:"iframePuro",className:"myClassname",display:"initial",position:"relative"}))),h.a.createElement("div",{className:"form-group col-md-6",id:"ontoModelContainer"},h.a.createElement(U.b,{enablePadding:!1},(function(t){t.zoomIn,t.zoomOut;var n=t.resetTransform;Object(r.a)(t,["zoomIn","zoomOut","resetTransform"]);return h.a.createElement(h.a.Fragment,null,h.a.createElement("div",{className:"tools"},h.a.createElement("label",{htmlFor:"ontoModel"},"Onto model"),h.a.createElement("button",{className:"toolBtn btn-sm btn-light",onClick:n},"Unzoom")),h.a.createElement("div",{className:"border"},h.a.createElement(U.a,null,h.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.state.svg},className:"transformWindow",id:"ontoModel"}))))}))),h.a.createElement(M,{graphCreation:this.createGraph,eventController:this.eventController})))}}]),t}(h.a.Component),M=(h.a.Component,function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(a.a)(t).call(this,e))).handleChange=function(e){n.setState({elName:e.target.value})},n.handleSubmit=function(e){void 0!==e&&e.preventDefault(),n.eventController.getDefault(!0).then((function(e){n.setState({undoActive:!1,svgUrl:"",buttons:e.buttons,title:e.title,originalName:e.originalName,type:e.type,startTransform:!1})}))},n.undoClick=function(){},n.handleClick=function(e,t,r){var o=n.state.elName,i=!1,l=!0,a=n.state.nameWasChange;if(""===(o=(o=o.trim()).replace(/ /g,"_"))&&!0===n.state.changeName&&"Undo"!==r&&"none"!==e.toLowerCase())alert("Plese write name of the element!");else if(""===o||o.match(/^[A-Za-z0-9-_*<>]+$/)){if("Undo"===r){var s=n.eventController.undo();if(!1===s)n.handleSubmit(),l=!1;else{var u=s.inputVariables;e=u[0],t=u[1],r=u[2],o=u[3],a=u[4],i=!0}}""===(o=o.replace(/\s/g,"_"))||!0!==n.state.changeName||n.eventController.checkDuplicity(o)?!0===l&&n.eventController.nextElement(e,t,r,o,a).then((function(l){if(!1===i){var a=Object.getOwnPropertyNames(n.eventController),s={},u=!0,h=!1,c=void 0;try{for(var d,f=a[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var y=d.value;y.includes("Controller")||"rulesJson"===y||"relations"===y||"function"!==typeof y&&(s[y]=n.assignProp(n.eventController[y]))}}catch(v){h=!0,c=v}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}n.eventController.saveHistory(s,[e,t,r,o,n.state.nameWasChange])}var p=n.eventController.getGraphSvg();n.setState({buttons:l.buttons,type:l.type,title:l.title,undoActive:!0,elName:"",changeName:l.elName,originalName:l.originalName,nameWasChange:!1}),!1!==p&&n.createGraph(p),n.state.type.includes("end")&&n.handleDownloadImage()})):alert("Element already exists! Please choose different name.")}else alert("Please change the name. It contains forbidden characters!")},n.assignProp=function(e){return Array.isArray(e)||"object"===typeof e?JSON.parse(JSON.stringify(e)):e},n.createGraph=function(e){g.a.render("id1",e,(function(e){n.setState({svg:e}),n.props.graphCreation(e),n.eventController.fullSizeSvg()?y()("#id1").addClass("fullSize"):y()("#id1").removeClass("fullSize")}))},n.handleChangeName=function(){n.setState({changeName:!n.state.changeName}),!0===n.state.changeName?(n.setState({elName:"",nameWasChange:!1}),y()(".changeAlert").fadeTo(1400,500).slideUp(500,(function(){y()(".changeAlert").alert("fade")}))):n.setState({elName:"",nameWasChange:!0})},n.handleDownloadImage=function(){var e=new Blob([n.state.svg],{type:"image/svg+xml;charset=utf-8"}),t=URL.createObjectURL(e);n.setState({svgUrl:t})},n.handleDownloadSchema=function(){var e=JSON.stringify(n.eventController.getOntoSchema());v()(e,"ontoSchema.json")},n.state={startTransform:!0,originalName:"",nameWasChange:!1,buttons:[],changeName:!1,elName:"",type:"",undoActive:!1,svg:""},n.eventController=n.props.eventController,n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return h.a.createElement("div",{className:"container-fluid text-center questionPart"},h.a.createElement("button",{type:"Submint",className:this.state.startTransform?"btn btn-primary":"d-none","data-toggle":"modal","data-target":"#exampleModal",onClick:this.handleSubmit},"Start transformation"),h.a.createElement("div",{className:this.state.startTransform?"d-none":""},h.a.createElement("h3",{className:"questionTitle"},this.state.title),h.a.createElement("div",{className:"optionButtons d-none d-md-block"},h.a.createElement("div",{className:"btn-group-vertical text-right"},h.a.createElement("button",{type:"button",className:"btn btn-primary btnModal",onClick:this.handleChangeName,disabled:""===this.state.originalName||this.state.type.includes("ontoRelation")||this.state.type.includes("end")||"nextBranchElements"===this.state.type||"needFather"===this.state.type},!0===this.state.changeName&&""!==this.state.originalName?"Set original name":"Change name"),h.a.createElement("button",{type:"button",className:"btn btn-primary btnModal",onClick:function(){return e.handleClick(void 0,void 0,"Undo")},disabled:!this.state.undoActive},"Undo"),h.a.createElement("button",{type:"button",className:"btn btn-secondary btnModal","data-dismiss":"modal",onClick:function(e){window.confirm("Are you sure you want to cancel the transformation?")&&window.location.reload()}},"Cancel"))),h.a.createElement("div",{className:!0===this.state.changeName?"col-md-6 mx-auto":"d-none"},h.a.createElement("div",{className:"input-group inputName"},h.a.createElement("div",{className:"input-group-prepend"},h.a.createElement("span",{className:"input-group-text",id:""},"Name of the element:")),h.a.createElement("input",{placeholder:""===this.state.originalName?"Write name of the element!":this.state.originalName,type:"text",className:"form-control",onChange:this.handleChange,value:this.state.elName})),h.a.createElement("h5",{className:this.state.buttons.lenght>1?"text-center inputName":"d-none"},"Select element's class:")),h.a.createElement("div",{className:"divButtons text-center"},h.a.createElement(B,{buttons:this.state.buttons,title:this.state.title,onClickDownloadSchema:this.handleDownloadSchema,svgUrl:this.state.svgUrl,onClick:this.handleClick,type:this.state.type,elNames:this.state.changeName,originalName:this.state.originalName})),h.a.createElement("div",{class:"alert alert-success col-md-6 mx-auto changeAlert",role:"alert"},"Original name of the element was set!")))}}]),t}(h.a.Component)),B=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(a.a)(t).call(this,e))).refs=h.a.createRef(),n}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this;return this.props.type.includes("ontoRelation-save")?h.a.createElement("div",{className:"row col-md-5 mx-auto"},h.a.createElement("label",{className:"label label-default col-md-6 mx-auto form-control"},this.props.elNames[0]),h.a.createElement("label",{className:"label label-default col-md-6 mx-auto form-control"},this.props.elNames[1]),h.a.createElement("select",{ref:"relFrom",className:"col-md-6 mx-auto form-control cardinalitySelect"},this.props.buttons.filter((function(e){return"from"===e.direction})).map((function(e){return h.a.createElement("option",{value:e.name},e.name)}))),h.a.createElement("select",{ref:"relTo",className:"col-md-6 mx-auto form-control cardinalitySelect"},this.props.buttons.filter((function(e){return"to"===e.direction})).map((function(e){return h.a.createElement("option",{value:e.name},e.name)}))),h.a.createElement("button",{className:"btn btn-success mx-auto questionPart",onClick:function(){return e.props.onClick([e.refs.relFrom.value,e.refs.relTo.value],null,e.props.type)}},"Next")):this.props.type.includes("end")?h.a.createElement("div",{className:"col-md-8 mx-auto"},h.a.createElement("a",{className:"btn btn-success btnEnd",href:this.props.svgUrl,download:"ontoUml-graph.svg"},"Download Onto-UML graph"),h.a.createElement("button",{type:"button",className:"btn btn-success btnEnd",onClick:function(){return e.props.onClickDownloadSchema()}},"Download Onto-Schema")):h.a.createElement("div",{className:"row col-md-6 mx-auto"},this.props.buttons.map((function(t){return h.a.createElement("div",{className:"col-md-4 mx-auto"},h.a.createElement("button",{key:e.props.uri,type:"button",className:"none"===t.name.toLowerCase()?" btn btn-secondary btnModal":"btn btn-success btnModal",onClick:function(){return e.props.onClick(t.name,t.uri,e.props.type,t.origin)}},e.props.type.includes("dataType")||e.props.title.split(" ").includes(t.name)||""===e.props.originalName&&1===e.props.buttons.length||"relator"===t.name.toLowerCase()&&1===e.props.buttons.length?"Next":t.name))})))}}]),t}(h.a.Component),A=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return[h.a.createElement(L,null)]}}]),t}(h.a.Component);d.a.render(h.a.createElement(A,null),document.getElementById("root"))}},[[381,1,2]]]);
//# sourceMappingURL=main.03e26abc.chunk.js.map